<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="Android Developer">
<meta property="og:type" content="website">
<meta property="og:title" content="孔庆威的博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="孔庆威的博客">
<meta property="og:description" content="Android Developer">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="孔庆威的博客">
<meta name="twitter:description" content="Android Developer">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>孔庆威的博客</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?e8ad05f02e13a412b09b2e8a632634af";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>











  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">孔庆威的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">精于心，简于形</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/02/2017-03-02-Gradle常用技巧/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/02/2017-03-02-Gradle常用技巧/" itemprop="url">Gradle常用技巧</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-02T14:46:09+08:00">
                2017-03-02
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/02/2017-03-02-Gradle常用技巧/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/03/02/2017-03-02-Gradle常用技巧/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.com/2017/03/02/2017-03-02-Gradle常用技巧/" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/article/details/59486052" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h1><p><a href="http://google.github.io/android-gradle-dsl/current/index.html" target="_blank" rel="external">http://google.github.io/android-gradle-dsl/current/index.html</a></p>
<p><a href="https://docs.gradle.org/current/userguide/java_plugin.html" target="_blank" rel="external">https://docs.gradle.org/current/userguide/java_plugin.html</a></p>
<h2 id="打包多个版本"><a href="#打包多个版本" class="headerlink" title="打包多个版本"></a>打包多个版本</h2><p>开发过程中我们经常需要打包多个版本的apk，最为常见的，一个是release版本，一个是debug版本，他们可能使用的api也有所区别，手动改起来总是很麻烦。<br>我们可以通过Gradle，配置多个版本，他们有各自的参数来区分不同的版本。如下，在 <code>app/build.gradle</code> 系统默认会给我生成release版本，我们可以手动自己添加一个版本，我这里命名为<code>debug</code>，分别添加了三种类型的参数。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">apply plugin: <span class="string">'com.android.application'</span></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    ……</div><div class="line">    buildTypes &#123;</div><div class="line">        release &#123;</div><div class="line">            ……</div><div class="line">            buildConfigField(<span class="string">"boolean"</span>, <span class="string">"isDebug"</span>, <span class="string">"false"</span>)</div><div class="line">        &#125;</div><div class="line">        debug &#123;</div><div class="line">            <span class="comment">// 添加了boolean类型的参数</span></div><div class="line">            buildConfigField(<span class="string">"boolean"</span>, <span class="string">"isDebug"</span>, <span class="string">"true"</span>)</div><div class="line">            <span class="comment">// 添加了String类型的参数</span></div><div class="line">            buildConfigField(<span class="string">"String"</span>, <span class="string">"coder"</span>, <span class="string">"\"kongqw\""</span>)</div><div class="line">            <span class="comment">// 添加了int类型的参数</span></div><div class="line">            buildConfigField(<span class="string">"int"</span>, <span class="string">"age"</span>, <span class="string">"26"</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">……</div><div class="line"></div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">   ……</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>添加完成后Rebuild，会在 <code>BuildConfig</code> 下看到我们添加的参数</p>
<p><img src="http://img.blog.csdn.net/20170302112738333?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="P1"></p>
<p>因为是静态变量，取值时直接用类名点变量名即可</p>
<p><img src="http://img.blog.csdn.net/20170302112754865?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="P2"></p>
<p>上述属于在Java代码中添加字段，同样的，Gradle也支持添加xml属性，类似这样</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">apply plugin: <span class="string">'com.android.application'</span></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    ……</div><div class="line">    defaultConfig &#123;</div><div class="line">        ……</div><div class="line">    &#125;</div><div class="line">    buildTypes &#123;</div><div class="line">        release &#123;</div><div class="line">            ……</div><div class="line">        &#125;</div><div class="line">        debug &#123;</div><div class="line">            ……</div><div class="line">            resValue(<span class="string">"bool"</span>, <span class="string">"is_debug"</span>, <span class="string">"true"</span>)</div><div class="line">            resValue(<span class="string">"string"</span>, <span class="string">"coder"</span>, <span class="string">"\"kongqw\""</span>)</div><div class="line">            resValue(<span class="string">"integer"</span>, <span class="string">"age"</span>, <span class="string">"26"</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    ……</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>添加完以后Rebuild，会在<code>generated.xml</code> 下生产如下字段</p>
<p><img src="http://img.blog.csdn.net/20170302112812772?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="P3"></p>
<p>但是要避免和<code>string.xml</code>文件里的字段重复</p>
<p>在xml中使用<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android:text="@string/coder"</div></pre></td></tr></table></figure></p>
<p>或者再Java中使用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String coder = getString(R.string.coder);</div></pre></td></tr></table></figure></p>
<h2 id="添加工程build时间"><a href="#添加工程build时间" class="headerlink" title="添加工程build时间"></a>添加工程build时间</h2><p>有时候，测试和产品总是会拿着手机跑过来问你，“有没有更新？”、“帮我看一下我装的是不是最新的版本？”，总是很烦，我们可以利用Gradle，获取到工程的Build时间，在测试版本打印出来，可以为工程师节省不少时间。</p>
<p>Gradle支持直接添加方法</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">apply plugin: <span class="string">'com.android.application'</span></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    ……</div><div class="line">    defaultConfig &#123;</div><div class="line">        ……</div><div class="line">        resValue(<span class="string">"string"</span>, <span class="string">"build_time"</span>, getDate())</div><div class="line">        <span class="comment">// BuildTime</span></div><div class="line">        buildConfigField(<span class="string">"String"</span>, <span class="string">"buildTime"</span>, <span class="string">"\""</span> + getDate() + <span class="string">"\""</span>)</div><div class="line">    &#125;</div><div class="line">    buildTypes &#123;</div><div class="line">        release &#123;</div><div class="line">            ……</div><div class="line">        &#125;</div><div class="line">        debug &#123;</div><div class="line">            ……</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">def</span> getDate() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Date().format(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    ……</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>判断的时候调用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">BuildConfig.buildTime</div></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">getString(R.string.build_time)</div></pre></td></tr></table></figure></p>
<p><img src="http://img.blog.csdn.net/20170302112832366?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="P4"></p>
<h2 id="不同版本包名不同"><a href="#不同版本包名不同" class="headerlink" title="不同版本包名不同"></a>不同版本包名不同</h2><p>我们都知道，相同包名，不同签名，在一台手机上是无法同时安装的。前面我们配置了两个不同的版本，release版本肯定是用正式签名，debug版本我们通常都会使用测试签名。那么问题来了，测试人员如果已经在手机上安装了上线的版本，再装测试版，就会有冲突，必须要卸载一个，那么最好的办法就是修改测试版包名。这样包名不同，两个版本同时安装，也不会有冲突。</p>
<p>同样的，Gradle依然可以轻松的帮我们做到。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">apply plugin: <span class="string">'com.android.application'</span></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    ……</div><div class="line">    defaultConfig &#123;</div><div class="line">        ……</div><div class="line">    &#125;</div><div class="line">    buildTypes &#123;</div><div class="line">        release &#123;</div><div class="line">            ……</div><div class="line">        &#125;</div><div class="line">        debug &#123;</div><div class="line">            ……</div><div class="line">            applicationIdSuffix <span class="string">".debug"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    ……</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看到我们在 debug 版本添加了<code>applicationIdSuffix</code>，其值为 <code>.debug</code>，顾名思义，是debug版本在包名后面添加<code>.debug</code>后缀。</p>
<h2 id="多渠道打包"><a href="#多渠道打包" class="headerlink" title="多渠道打包"></a>多渠道打包</h2><p>多渠道打包，打包多个市场的apk，用来统计。</p>
<p>首先在<code>AndroidManifest</code>文件添加<code>meta-data</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">manifest</span> ……&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">application</span></span></div><div class="line"><span class="tag">        ……&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">meta-data</span></span></div><div class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">"PRODUCT"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:value</span>=<span class="string">"$&#123;CHANNEL_VALUE&#125;"</span>/&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">activity</span> ……&gt;</span></div><div class="line">            ……</div><div class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div></pre></td></tr></table></figure>
<p>在<code>app/build.gradle</code>添加<code>productFlavors</code>，如下所示，添加 <code>XIAO_MI</code>和<code>GOOGLE_PLAY</code>两个渠道</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">apply plugin: <span class="string">'com.android.application'</span></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    ……</div><div class="line">    defaultConfig &#123;</div><div class="line">        ……</div><div class="line">    &#125;</div><div class="line">    buildTypes &#123;</div><div class="line">        release &#123;</div><div class="line">            ……</div><div class="line">        &#125;</div><div class="line">        debug &#123;</div><div class="line">            ……</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    productFlavors &#123;</div><div class="line">        xiaomi &#123;</div><div class="line">            manifestPlaceholders = [CHANNEL_VALUE: <span class="string">"XIAO_MI"</span>]</div><div class="line">        &#125;</div><div class="line">        googlePlay &#123;</div><div class="line">            manifestPlaceholders = [CHANNEL_VALUE: <span class="string">"GOOGLE_PLAY"</span>]</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    ……</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>获取渠道</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    ApplicationInfo applicationInfo = getPackageManager().getApplicationInfo(getPackageName(), PackageManager.GET_META_DATA);</div><div class="line">    String channel = applicationInfo.metaData.getString(<span class="string">"PRODUCT"</span>);</div><div class="line">    Log.i(TAG, <span class="string">"onCreate: 渠道 ："</span> + channel);</div><div class="line">&#125; <span class="keyword">catch</span> (PackageManager.NameNotFoundException e) &#123;</div><div class="line">    e.printStackTrace();</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/16/2017-02-16-打造简洁高效的动态权限管理器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/16/2017-02-16-打造简洁高效的动态权限管理器/" itemprop="url">打造简洁高效的动态权限管理器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-16T10:50:45+08:00">
                2017-02-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/开源/" itemprop="url" rel="index">
                    <span itemprop="name">开源</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/16/2017-02-16-打造简洁高效的动态权限管理器/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/02/16/2017-02-16-打造简洁高效的动态权限管理器/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.com/2017/02/16/2017-02-16-打造简洁高效的动态权限管理器/" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/article/details/55254158" target="_blank" rel="external">CSDN</a></p>
<hr>
<p>效果图</p>
<p><img src="http://img.blog.csdn.net/20170216120006799?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>GitHub地址：<a href="https://github.com/kongqw/PermissionsManager" target="_blank" rel="external">PermissionsManager</a> </p>
<p>随着Android 6.0的普及，动态权限的重要性也开始时慢慢体现出来。为了更好的保护用户隐私，Android 6.0要求在进行敏感操作之前，必须要向用户请示申请权限。</p>
<p>如何使用，在之前的文章里也已经介绍过了，但是用起来比较麻烦。<a href="http://blog.csdn.net/q4878802/article/details/50419004?locationNum=1&amp;fps=1" target="_blank" rel="external">Android6.0动态获取权限</a> </p>
<p>我希望可以封装一下，使用之前创建一个动态权限的管理对象，他有两个回调来告诉我权限申请成功或者失败，像这样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">mPermissionsManager = <span class="keyword">new</span> PermissionsManager(<span class="keyword">this</span>) &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">authorized</span><span class="params">(<span class="keyword">int</span> requestCode)</span> </span>&#123;</div><div class="line">        <span class="comment">// TODO 权限通过</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">noAuthorization</span><span class="params">(<span class="keyword">int</span> requestCode, String[] lacksPermissions)</span> </span>&#123;</div><div class="line">        <span class="comment">// TODO 有权限没有通过</span></div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>使用的时候，可以直接调用一个方法，把要请示的权限传进去就可以进行校验，像这样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 检查权限</span></div><div class="line">mPermissionsManager.checkPermissions(<span class="string">"请求码"</span>, <span class="string">"要校验的权限"</span>);</div></pre></td></tr></table></figure>
<p>于是乎，下面封装的动态权限管理器就来了：</p>
<h2 id="动态权限管理器"><a href="#动态权限管理器" class="headerlink" title="动态权限管理器"></a>动态权限管理器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.kongqw.permissionslibrary;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Activity;</div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.content.Intent;</div><div class="line"><span class="keyword">import</span> android.content.pm.PackageManager;</div><div class="line"><span class="keyword">import</span> android.net.Uri;</div><div class="line"><span class="keyword">import</span> android.provider.Settings;</div><div class="line"><span class="keyword">import</span> android.support.annotation.NonNull;</div><div class="line"><span class="keyword">import</span> android.support.v4.app.ActivityCompat;</div><div class="line"><span class="keyword">import</span> android.support.v4.content.ContextCompat;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Created by kongqingwei on 2017/2/15.</span></div><div class="line"><span class="comment"> * 检查权限的类</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">PermissionsManager</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PACKAGE_URL_SCHEME = <span class="string">"package:"</span>;</div><div class="line">    <span class="keyword">private</span> Activity mTargetActivity;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">authorized</span><span class="params">(<span class="keyword">int</span> requestCode)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">noAuthorization</span><span class="params">(<span class="keyword">int</span> requestCode, String[] lacksPermissions)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PermissionsManager</span><span class="params">(Activity targetActivity)</span> </span>&#123;</div><div class="line">        mTargetActivity = targetActivity;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 检查权限</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> requestCode 请求码</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> permissions 准备校验的权限</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkPermissions</span><span class="params">(<span class="keyword">int</span> requestCode, String... permissions)</span> </span>&#123;</div><div class="line"></div><div class="line">        ArrayList&lt;String&gt; lacks = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">for</span> (String permission : permissions) &#123;</div><div class="line">            <span class="keyword">if</span> (ContextCompat.checkSelfPermission(mTargetActivity.getApplicationContext(), permission) == PackageManager.PERMISSION_DENIED) &#123;</div><div class="line">                lacks.add(permission);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!lacks.isEmpty()) &#123;</div><div class="line">            <span class="comment">// 有权限没有授权</span></div><div class="line">            String[] lacksPermissions = <span class="keyword">new</span> String[lacks.size()];</div><div class="line">            lacksPermissions = lacks.toArray(lacksPermissions);</div><div class="line">            <span class="comment">//申请CAMERA权限</span></div><div class="line">            ActivityCompat.requestPermissions(mTargetActivity, lacksPermissions, requestCode);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// 授权</span></div><div class="line">            authorized(requestCode);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 复查权限</span></div><div class="line"><span class="comment">     * &lt;p&gt;</span></div><div class="line"><span class="comment">     * 调用checkPermissions方法后，会提示用户对权限的申请做出选择，选择以后（同意或拒绝）</span></div><div class="line"><span class="comment">     * TargetActivity会回调onRequestPermissionsResult方法，</span></div><div class="line"><span class="comment">     * 在onRequestPermissionsResult回调方法里，我们调用此方法来复查权限，检查用户的选择是否通过了权限申请</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> requestCode  请求码</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> permissions  权限</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> grantResults 授权结果</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">recheckPermissions</span><span class="params">(<span class="keyword">int</span> requestCode, @NonNull String[] permissions, @NonNull <span class="keyword">int</span>[] grantResults)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> grantResult : grantResults) &#123;</div><div class="line">            <span class="keyword">if</span> (grantResult == PackageManager.PERMISSION_DENIED) &#123;</div><div class="line">                <span class="comment">// 未授权</span></div><div class="line">                noAuthorization(requestCode, permissions);</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 授权</span></div><div class="line">        authorized(requestCode);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 进入应用设置</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> context context</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startAppSettings</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        Intent intent = <span class="keyword">new</span> Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);</div><div class="line">        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</div><div class="line">        intent.setData(Uri.parse(PACKAGE_URL_SCHEME + context.getPackageName()));</div><div class="line">        context.startActivity(intent);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>使用起来的逻辑也比较清晰简单，一共3步：</p>
<h3 id="1-初始化权限管理器"><a href="#1-初始化权限管理器" class="headerlink" title="1. 初始化权限管理器"></a>1. 初始化权限管理器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 初始化</span></div><div class="line">mPermissionsManager = <span class="keyword">new</span> PermissionsManager(<span class="keyword">this</span>) &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">authorized</span><span class="params">(<span class="keyword">int</span> requestCode)</span> </span>&#123;</div><div class="line">        Toast.makeText(getApplicationContext(), requestCode + <span class="string">" ： 全部权限通过"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">noAuthorization</span><span class="params">(<span class="keyword">int</span> requestCode, String[] lacksPermissions)</span> </span>&#123;</div><div class="line">        Toast.makeText(getApplicationContext(), requestCode + <span class="string">" ： 有权限没有通过！需要授权"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">        <span class="keyword">for</span> (String permission : lacksPermissions) &#123;</div><div class="line">            Log.i(TAG, <span class="string">"noAuthorization: "</span> + permission);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="2-检查权限"><a href="#2-检查权限" class="headerlink" title="2. 检查权限"></a>2. 检查权限</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 要校验的权限</span></div><div class="line">String[] PERMISSIONS = <span class="keyword">new</span> String[]&#123;Manifest.permission.RECORD_AUDIO, Manifest.permission.CAMERA&#125;;</div><div class="line"><span class="comment">// 检查权限</span></div><div class="line">mPermissionsManager.checkPermissions(<span class="number">0</span>, PERMISSIONS);</div></pre></td></tr></table></figure>
<h3 id="3-复查权限"><a href="#3-复查权限" class="headerlink" title="3. 复查权限"></a>3. 复查权限</h3><p>用户对权限申请的提示做出选择以后，要重写TargetActivity的<code>onRequestPermissionsResult</code>方法来复查权限，检查权限是否通过。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestPermissionsResult</span><span class="params">(<span class="keyword">int</span> requestCode, @NonNull String[] permissions, @NonNull <span class="keyword">int</span>[] grantResults)</span> </span>&#123;</div><div class="line">    <span class="comment">// 用户做出选择以后复查权限，判断是否通过了权限申请</span></div><div class="line">    mPermissionsManager.recheckPermissions(requestCode, permissions, grantResults);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>进入应用设置页面</p>
<p>最后，权限没有通过，是不能使用的，如果一定要用，一般要提示用户缺少权限，到应用设置页面去吧权限打开，再回来使用。<br>对话框就不写了，进入到应用的设置页面可以直接调用<code>PermissionsManager</code>里的<code>startAppSettings</code>方法，进入到该应用的设置页面，修改权限</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">PermissionsManager.startAppSettings(getApplicationContext());</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/13/2016-12-13-Android自定义View绘图基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/13/2016-12-13-Android自定义View绘图基础/" itemprop="url">Android自定义View绘图基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-13T16:16:52+08:00">
                2016-12-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/13/2016-12-13-Android自定义View绘图基础/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/12/13/2016-12-13-Android自定义View绘图基础/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.com/2016/12/13/2016-12-13-Android%E8%87%AA%E5%AE%9A%E4%B9%89View%E7%BB%98%E5%9B%BE%E5%9F%BA%E7%A1%80/" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/article/details/53610590" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="Android自定义View绘图基础"><a href="#Android自定义View绘图基础" class="headerlink" title="Android自定义View绘图基础"></a>Android自定义View绘图基础</h1><h2 id="View的测量"><a href="#View的测量" class="headerlink" title="View的测量"></a>View的测量</h2><p> 控件的测量可以说是固定写法，原生的View只支持<code>EXACTLY</code>的测量模式，我们自定义的控件可以重写<code>onMeasure</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</div><div class="line">    setMeasuredDimension(getMeasuredSize(widthMeasureSpec), getMeasuredSize(heightMeasureSpec));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>onMeasure方法给我们返回的<code>widthMeasureSpec</code>和<code>heightMeasureSpec</code>，我们并不能直接拿过来使用，需要使用<code>MeasureSpec</code>类进行解析，来获取测量后的具体值。<br>首先需要获取测量模式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">MeasureSpec.getMode(measureSpec)</div><div class="line">``` </div><div class="line"></div><div class="line">getMode方法返回是测量的模式，有以下<span class="number">3</span>种类型：</div><div class="line">- MeasureSpec.EXACTLY : 精确值模式（指定值/match_parent）</div><div class="line">- MeasureSpec.AT_MOST : 最大值模式（wrap_content）</div><div class="line">- MeasureSpec.UNSPECIFIED : 不指定大小的测量模式（一般用不上）</div><div class="line"></div><div class="line">获取到了测量模式以后，获取测量后的大小</div><div class="line"></div><div class="line">``` java</div><div class="line">MeasureSpec.getSize(measureSpec)</div></pre></td></tr></table></figure>
<p>根据上面的意思，可以封装我们的<code>getMeasuredSize</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 默认大小</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_SIZE = <span class="number">200</span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 获取测量后的大小</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> measureSpec measureSpec</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span> measuredSize</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getMeasuredSize</span><span class="params">(<span class="keyword">int</span> measureSpec)</span> </span>&#123;</div><div class="line">    <span class="keyword">switch</span> (MeasureSpec.getMode(measureSpec)) &#123;</div><div class="line">        <span class="keyword">case</span> MeasureSpec.EXACTLY: <span class="comment">// 精确值模式（指定值/match_parent）</span></div><div class="line">            Log.i(TAG, <span class="string">"getMeasuredSize: 精确值模式"</span>);</div><div class="line">            <span class="keyword">return</span> MeasureSpec.getSize(measureSpec);</div><div class="line">        <span class="keyword">case</span> MeasureSpec.AT_MOST: <span class="comment">// 最大值模式（wrap_content）</span></div><div class="line">            Log.i(TAG, <span class="string">"getMeasuredSize: 最大值模式"</span>);</div><div class="line">            <span class="keyword">return</span> Math.min(DEFAULT_SIZE, MeasureSpec.getSize(measureSpec));</div><div class="line">        <span class="keyword">case</span> MeasureSpec.UNSPECIFIED: <span class="comment">// 不指定大小的测量模式</span></div><div class="line">            <span class="keyword">return</span> DEFAULT_SIZE;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> DEFAULT_SIZE;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在我们自定义的View就支持自定义的大小了，包括<code>match_parent</code>、<code>wrap_content</code>、<code>具体值</code>。</p>
<h2 id="View的绘制"><a href="#View的绘制" class="headerlink" title="View的绘制"></a>View的绘制</h2><h3 id="画笔属性"><a href="#画笔属性" class="headerlink" title="画笔属性"></a>画笔属性</h3><p>创建画笔<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Paint paint = <span class="keyword">new</span> Paint();</div></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
<th>举例</th>
</tr>
</thead>
<tbody>
<tr>
<td>public void setAntiAlias(boolean aa)</td>
<td>设置画笔锯齿效果</td>
<td>true 无锯齿效果</td>
</tr>
<tr>
<td>public void setColor(@ColorInt int color)</td>
<td>设置画笔颜色</td>
<td></td>
</tr>
<tr>
<td>public void setARGB(int a, int r, int g, int b)</td>
<td>设置画笔的A、R、G、B值</td>
<td></td>
</tr>
<tr>
<td>public void setAlpha(int a)</td>
<td>设置画笔的Alpha值</td>
<td></td>
</tr>
<tr>
<td>public void setTextSize(float textSize)</td>
<td>设置字体的尺寸</td>
<td></td>
</tr>
<tr>
<td>public void setStyle(Style style)</td>
<td>设置画笔的风格（空心或实心）</td>
<td>paint.setStyle(Paint.Style.STROKE);// 空心    paint.setStyle(Paint.Style.FILL); // 实心</td>
</tr>
<tr>
<td>public void setStrokeWidth(float width)</td>
<td>设置空心边框的宽度</td>
</tr>
</tbody>
</table>
<h3 id="Shader"><a href="#Shader" class="headerlink" title="Shader"></a>Shader</h3><p>BitmapShader, ComposeShader, LinearGradient, RadialGradient, SweepGradient</p>
<h3 id="点"><a href="#点" class="headerlink" title="点"></a>点</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Helper for drawPoints() for drawing a single point.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawPoint</span><span class="params">(<span class="keyword">float</span> x, <span class="keyword">float</span> y, @NonNull Paint paint)</span></span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">canvas.drawPoint(<span class="number">10</span>, <span class="number">10</span>, paint);</div></pre></td></tr></table></figure>
<h3 id="直线"><a href="#直线" class="headerlink" title="直线"></a>直线</h3><p>绘制一条直线<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Draw a line segment with the specified start and stop x,y coordinates,</span></div><div class="line"><span class="comment"> * using the specified paint.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * &lt;p&gt;Note that since a line is always "framed", the Style is ignored in the paint.&lt;/p&gt;</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * &lt;p&gt;Degenerate lines (length is 0) will not be drawn.&lt;/p&gt;</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> startX The x-coordinate of the start point of the line</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> startY The y-coordinate of the start point of the line</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> paint  The paint used to draw the line</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawLine</span><span class="params">(<span class="keyword">float</span> startX, <span class="keyword">float</span> startY, <span class="keyword">float</span> stopX, <span class="keyword">float</span> stopY, @NonNull Paint paint)</span></span></div></pre></td></tr></table></figure></p>
<p>绘制多条直线<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawLines</span><span class="params">(@Size(multiple=<span class="number">4</span>)</span> @NonNull <span class="keyword">float</span>[] pts, @NonNull Paint paint)</span></div></pre></td></tr></table></figure></p>
<h3 id="矩形"><a href="#矩形" class="headerlink" title="矩形"></a>矩形</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Draw the specified Rect using the specified paint. The rectangle will</span></div><div class="line"><span class="comment"> * be filled or framed based on the Style in the paint.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> left   The left side of the rectangle to be drawn</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> top    The top side of the rectangle to be drawn</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> right  The right side of the rectangle to be drawn</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> bottom The bottom side of the rectangle to be drawn</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> paint  The paint used to draw the rect</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawRect</span><span class="params">(<span class="keyword">float</span> left, <span class="keyword">float</span> top, <span class="keyword">float</span> right, <span class="keyword">float</span> bottom, @NonNull Paint paint)</span></span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">canvas.drawRect(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">200</span>, paint);</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20161213155250067?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="圆角矩形"><a href="#圆角矩形" class="headerlink" title="圆角矩形"></a>圆角矩形</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Draw the specified round-rect using the specified paint. The roundrect</span></div><div class="line"><span class="comment"> * will be filled or framed based on the Style in the paint.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> rx    The x-radius of the oval used to round the corners</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> ry    The y-radius of the oval used to round the corners</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> paint The paint used to draw the roundRect</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawRoundRect</span><span class="params">(<span class="keyword">float</span> left, <span class="keyword">float</span> top, <span class="keyword">float</span> right, <span class="keyword">float</span> bottom, <span class="keyword">float</span> rx, <span class="keyword">float</span> ry, @NonNull Paint paint)</span></span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">canvas.drawRoundRect(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">200</span>, <span class="number">20</span>, <span class="number">20</span>, paint);</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20161213155334255?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="圆"><a href="#圆" class="headerlink" title="圆"></a>圆</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Draw the specified circle using the specified paint. If radius is &lt;= 0,</span></div><div class="line"><span class="comment"> * then nothing will be drawn. The circle will be filled or framed based</span></div><div class="line"><span class="comment"> * on the Style in the paint.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> cx     The x-coordinate of the center of the cirle to be drawn</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> cy     The y-coordinate of the center of the cirle to be drawn</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> radius The radius of the cirle to be drawn</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> paint  The paint used to draw the circle</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawCircle</span><span class="params">(<span class="keyword">float</span> cx, <span class="keyword">float</span> cy, <span class="keyword">float</span> radius, @NonNull Paint paint)</span></span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 画圆</span></div><div class="line">canvas.drawCircle(<span class="number">200</span>, <span class="number">200</span>, <span class="number">100</span>, paint);</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20161213160033632?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="扇形"><a href="#扇形" class="headerlink" title="扇形"></a>扇形</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * &lt;p&gt;Draw the specified arc, which will be scaled to fit inside the</span></div><div class="line"><span class="comment"> * specified oval.&lt;/p&gt;</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * &lt;p&gt;If the start angle is negative or &gt;= 360, the start angle is treated</span></div><div class="line"><span class="comment"> * as start angle modulo 360.&lt;/p&gt;</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * &lt;p&gt;If the sweep angle is &gt;= 360, then the oval is drawn</span></div><div class="line"><span class="comment"> * completely. Note that this differs slightly from SkPath::arcTo, which</span></div><div class="line"><span class="comment"> * treats the sweep angle modulo 360. If the sweep angle is negative,</span></div><div class="line"><span class="comment"> * the sweep angle is treated as sweep angle modulo 360&lt;/p&gt;</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * &lt;p&gt;The arc is drawn clockwise. An angle of 0 degrees correspond to the</span></div><div class="line"><span class="comment"> * geometric angle of 0 degrees (3 o'clock on a watch.)&lt;/p&gt;</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> startAngle Starting angle (in degrees) where the arc begins</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> sweepAngle Sweep angle (in degrees) measured clockwise</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> useCenter If true, include the center of the oval in the arc, and</span></div><div class="line"><span class="comment">                    close it if it is being stroked. This will draw a wedge</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> paint      The paint used to draw the arc</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawArc</span><span class="params">(<span class="keyword">float</span> left, <span class="keyword">float</span> top, <span class="keyword">float</span> right, <span class="keyword">float</span> bottom, <span class="keyword">float</span> startAngle, <span class="keyword">float</span> sweepAngle, <span class="keyword">boolean</span> useCenter, @NonNull Paint paint)</span></span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 扇形 起始角度0度 旋转角度120度</span></div><div class="line">canvas.drawArc(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">200</span>, <span class="number">0</span>, <span class="number">120</span>, <span class="keyword">true</span>, paint);</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20161213160316574?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="弧形"><a href="#弧形" class="headerlink" title="弧形"></a>弧形</h3><p>扇形通过调整属性，可以实现弧形的效果，首先画笔设置成空心</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 空心</span></div><div class="line">paint.setStyle(Paint.Style.STROKE);</div></pre></td></tr></table></figure>
<p>设置画扇形的<code>useCenter</code>参数为<code>false</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 弧形 起始角度0度 旋转角度120度</span></div><div class="line">canvas.drawArc(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">200</span>, <span class="number">0</span>, <span class="number">120</span>, <span class="keyword">false</span>, paint);</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20161213160433902?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="椭圆"><a href="#椭圆" class="headerlink" title="椭圆"></a>椭圆</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Draw the specified oval using the specified paint. The oval will be</span></div><div class="line"><span class="comment"> * filled or framed based on the Style in the paint.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawOval</span><span class="params">(<span class="keyword">float</span> left, <span class="keyword">float</span> top, <span class="keyword">float</span> right, <span class="keyword">float</span> bottom, @NonNull Paint paint)</span></span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 椭圆</span></div><div class="line">canvas.drawOval(<span class="number">100</span>, <span class="number">100</span>, <span class="number">500</span>, <span class="number">300</span>, paint);</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20161213160532467?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="文字"><a href="#文字" class="headerlink" title="文字"></a>文字</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Draw the text, with origin at (x,y), using the specified paint. The</span></div><div class="line"><span class="comment"> * origin is interpreted based on the Align setting in the paint.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> text  The text to be drawn</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> x     The x-coordinate of the origin of the text being drawn</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> y     The y-coordinate of the baseline of the text being drawn</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> paint The paint used for the text (e.g. color, size, style)</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawText</span><span class="params">(@NonNull String text, <span class="keyword">float</span> x, <span class="keyword">float</span> y, @NonNull Paint paint)</span></span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 文字</span></div><div class="line">paint.setTextSize(<span class="number">30</span>);</div><div class="line">paint.setColor(Color.BLACK);</div><div class="line">canvas.drawText(<span class="string">"KongQingwei"</span>, <span class="number">100</span>, <span class="number">100</span>, paint);</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20161213160730434?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>在指定位置显示每个字符</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Draw the text in the array, with each character's origin specified by</span></div><div class="line"><span class="comment"> * the pos array.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> text  The text to be drawn</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> pos   Array of [x,y] positions, used to position each character</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> paint The paint used for the text (e.g. color, size, style)</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@deprecated</span> This method does not support glyph composition and decomposition and</span></div><div class="line"><span class="comment"> * should therefore not be used to render complex scripts. It also doesn't</span></div><div class="line"><span class="comment"> * handle supplementary characters (eg emoji).</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@Deprecated</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawPosText</span><span class="params">(@NonNull String text, @NonNull @Size(multiple=<span class="number">2</span>)</span> <span class="keyword">float</span>[] pos, @NonNull Paint paint)</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">canvas.drawPosText(<span class="string">"KongQingwei"</span>, <span class="keyword">new</span> <span class="keyword">float</span>[]&#123;</div><div class="line">        <span class="number">30</span>,<span class="number">30</span>,</div><div class="line">        <span class="number">60</span>,<span class="number">60</span>,</div><div class="line">        <span class="number">90</span>,<span class="number">90</span>,</div><div class="line">        <span class="number">120</span>,<span class="number">120</span>,</div><div class="line">        <span class="number">150</span>,<span class="number">150</span>,</div><div class="line">        <span class="number">180</span>,<span class="number">180</span>,</div><div class="line">        <span class="number">210</span>,<span class="number">210</span>,</div><div class="line">        <span class="number">240</span>,<span class="number">240</span>,</div><div class="line">        <span class="number">270</span>,<span class="number">270</span>,</div><div class="line">        <span class="number">300</span>,<span class="number">300</span>,</div><div class="line">        <span class="number">330</span>,<span class="number">330</span></div><div class="line">&#125;, paint);</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20161213160854809?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="绘制路径"><a href="#绘制路径" class="headerlink" title="绘制路径"></a>绘制路径</h3><p>可以自定义画出想要的任意图形</p>
<p>五角星</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Draw the specified path using the specified paint. The path will be</span></div><div class="line"><span class="comment"> * filled or framed based on the Style in the paint.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> path  The path to be drawn</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> paint The paint used to draw the path</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawPath</span><span class="params">(@NonNull Path path, @NonNull Paint paint)</span></span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Path path = <span class="keyword">new</span> Path();</div><div class="line">path.moveTo(<span class="number">0</span>,<span class="number">100</span>);</div><div class="line">path.lineTo(<span class="number">250</span>,<span class="number">300</span>);</div><div class="line">path.lineTo(<span class="number">150</span>,<span class="number">0</span>);</div><div class="line">path.lineTo(<span class="number">50</span>,<span class="number">300</span>);</div><div class="line">path.lineTo(<span class="number">300</span>,<span class="number">100</span>);</div><div class="line">path.lineTo(<span class="number">0</span>,<span class="number">100</span>);</div><div class="line">canvas.drawPath(path,paint);</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20161213161030317?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>空心</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">paint.setStyle(Paint.Style.STROKE);</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20161213161158686?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="图形裁剪"><a href="#图形裁剪" class="headerlink" title="图形裁剪"></a>图形裁剪</h3><p>以上面的实心五角星为例，以五角星的中心为圆心，裁剪出一个半径为100的圆形</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">    * Modify the current clip with the specified path.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> path The path to operate on the current clip</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> op   How the clip is modified</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span>     true if the resulting is non-empty</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">clipPath</span><span class="params">(@NonNull Path path, @NonNull Region.Op op)</span></span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 裁剪一个圆形</span></div><div class="line">Path path = <span class="keyword">new</span> Path();</div><div class="line">path.reset();</div><div class="line">path.addCircle(<span class="number">150</span>, <span class="number">150</span>, <span class="number">100</span>, Path.Direction.CCW);</div><div class="line">canvas.clipPath(path, Region.Op.INTERSECT);</div><div class="line"><span class="comment">// canvas.save();</span></div><div class="line"><span class="comment">// 画五角星</span></div><div class="line">path.reset();</div><div class="line">path.moveTo(<span class="number">0</span>,<span class="number">100</span>);</div><div class="line">path.lineTo(<span class="number">250</span>,<span class="number">300</span>);</div><div class="line">path.lineTo(<span class="number">150</span>,<span class="number">0</span>);</div><div class="line">path.lineTo(<span class="number">50</span>,<span class="number">300</span>);</div><div class="line">path.lineTo(<span class="number">300</span>,<span class="number">100</span>);</div><div class="line">path.lineTo(<span class="number">0</span>,<span class="number">100</span>);</div><div class="line">canvas.drawPath(path,paint);</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20161213161327462?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<table>
<thead>
<tr>
<th>Region.Op</th>
<th>描述</th>
<th>样式</th>
</tr>
</thead>
<tbody>
<tr>
<td>INTERSECT</td>
<td>裁剪内部交集</td>
<td><img src="http://img.blog.csdn.net/20161213161327462?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></td>
</tr>
<tr>
<td>DIFFERENCE</td>
<td>外部</td>
<td><img src="http://img.blog.csdn.net/20161213161401588?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTQ4Nzg4MDI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></td>
</tr>
</tbody>
</table>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/16/2016-11-16-Android与Javascript交互/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/16/2016-11-16-Android与Javascript交互/" itemprop="url">Android与Javascript交互</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-16T17:59:39+08:00">
                2016-11-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/16/2016-11-16-Android与Javascript交互/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/11/16/2016-11-16-Android与Javascript交互/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.com/2016/11/16/2016-11-16-Android%E4%B8%8EJavascript%E4%BA%A4%E4%BA%92/" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/article/details/53189882" target="_blank" rel="external">CSDN</a></p>
<hr>
<p>本篇参考<a href="http://blog.csdn.net/leejizhou/article/details/50894531" target="_blank" rel="external">Android与HTML+JS交互入门</a></p>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20161116184229121" alt="效果图"></p>
<h1 id="加载本地Html"><a href="#加载本地Html" class="headerlink" title="加载本地Html"></a>加载本地Html</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">contentWebView = (WebView) findViewById(R.id.webview);</div><div class="line"><span class="comment">// 加载Assets下的Html</span></div><div class="line">contentWebView.loadUrl(<span class="string">"file:///android_asset/html/test.html"</span>);</div></pre></td></tr></table></figure>
<h1 id="启用Javascript"><a href="#启用Javascript" class="headerlink" title="启用Javascript"></a>启用Javascript</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">contentWebView.getSettings().setJavaScriptEnabled(<span class="keyword">true</span>);</div><div class="line">contentWebView.addJavascriptInterface(<span class="keyword">this</span>, <span class="string">"android"</span>);</div></pre></td></tr></table></figure>
<h1 id="Android调用Javascript的方法"><a href="#Android调用Javascript的方法" class="headerlink" title="Android调用Javascript的方法"></a>Android调用Javascript的方法</h1><p>Javascript写法</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="undefined">    function jsFunction()&#123;</span></div><div class="line"><span class="undefined">         document.getElementById("content").innerHTML = "JS方法被调用";</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined">    function jsFunctionArg(arg)&#123;</span></div><div class="line"><span class="xml">         document.getElementById("content").innerHTML = "JS方法被调用并收到参数：<span class="tag">&lt;<span class="name">br</span>/&gt;</span>" + arg;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Android写法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 调用JS的jsFunction方法</span></div><div class="line">contentWebView.loadUrl(<span class="string">"javascript:jsFunction()"</span>);</div><div class="line"><span class="comment">// 调用JS的jsFunctionArg方法</span></div><div class="line">contentWebView.loadUrl(<span class="string">"javascript:jsFunctionArg('[Android传递过来的数据]')"</span>);</div></pre></td></tr></table></figure>
<h1 id="Javascript调用Android的方法"><a href="#Javascript调用Android的方法" class="headerlink" title="Javascript调用Android的方法"></a>Javascript调用Android的方法</h1><p>Android方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@JavascriptInterface</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">androidFunction</span><span class="params">()</span> </span>&#123;</div><div class="line">    Snackbar.make(contentWebView, <span class="string">"Android的方法被调用"</span>, Snackbar.LENGTH_SHORT).show();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@JavascriptInterface</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">androidFunction</span><span class="params">(String text)</span> </span>&#123;</div><div class="line">    Snackbar.make(contentWebView, <span class="string">"Android的方法被调用并收到参数 : \n"</span> + text, Snackbar.LENGTH_SHORT).show();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Javascript调用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">style</span>=<span class="string">"width:300px;height:50px;"</span> <span class="attr">value</span>=<span class="string">"JS调用Android方法"</span> <span class="attr">onclick</span>=<span class="string">"window.android.androidFunction()"</span> /&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">style</span>=<span class="string">"width:300px;height:50px;"</span> <span class="attr">value</span>=<span class="string">"JS调用Android带有参数的方法"</span> <span class="attr">onclick</span>=<span class="string">"window.android.androidFunction('[JS传递过来的数据]')"</span> /&gt;</span></div></pre></td></tr></table></figure>
<hr>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><p><img src="http://img.blog.csdn.net/20161116184259654" alt="XML"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=gb2312"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="undefined">            function jsFunction()&#123;</span></div><div class="line"><span class="undefined">                 document.getElementById("content").innerHTML = "JS方法被调用";</span></div><div class="line"><span class="undefined">            &#125;</span></div><div class="line"><span class="undefined">            function jsFunctionArg(arg)&#123;</span></div><div class="line"><span class="xml">                 document.getElementById("content").innerHTML = "JS方法被调用并收到参数：<span class="tag">&lt;<span class="name">br</span>/&gt;</span>" + arg;</span></div><div class="line"><span class="undefined">            &#125;</span></div><div class="line"><span class="undefined">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>HTML页面<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span>|<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">style</span>=<span class="string">"width:300px;height:50px;"</span> <span class="attr">value</span>=<span class="string">"JS调用Android方法"</span> <span class="attr">onclick</span>=<span class="string">"window.android.androidFunction()"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">style</span>=<span class="string">"width:300px;height:50px;"</span> <span class="attr">value</span>=<span class="string">"JS调用Android带有参数的方法"</span> <span class="attr">onclick</span>=<span class="string">"window.android.androidFunction('[JS传递过来的数据]')"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.kongqw.kqwandroidjsdemo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.annotation.SuppressLint;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.design.widget.Snackbar;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.Toolbar;</div><div class="line"><span class="keyword">import</span> android.view.Menu;</div><div class="line"><span class="keyword">import</span> android.view.MenuItem;</div><div class="line"><span class="keyword">import</span> android.webkit.JavascriptInterface;</div><div class="line"><span class="keyword">import</span> android.webkit.WebView;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> WebView contentWebView;</div><div class="line"></div><div class="line">    <span class="meta">@SuppressLint</span>(&#123;<span class="string">"JavascriptInterface"</span>, <span class="string">"SetJavaScriptEnabled"</span>, <span class="string">"AddJavascriptInterface"</span>&#125;)</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);</div><div class="line">        setSupportActionBar(toolbar);</div><div class="line"></div><div class="line">        contentWebView = (WebView) findViewById(R.id.webview);</div><div class="line">        <span class="comment">// 加载Assets下的Html</span></div><div class="line">        contentWebView.loadUrl(<span class="string">"file:///android_asset/html/test.html"</span>);</div><div class="line">        <span class="comment">// 启用Javascript</span></div><div class="line">        contentWebView.getSettings().setJavaScriptEnabled(<span class="keyword">true</span>);</div><div class="line">        contentWebView.addJavascriptInterface(<span class="keyword">this</span>, <span class="string">"android"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@JavascriptInterface</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">androidFunction</span><span class="params">()</span> </span>&#123;</div><div class="line">        Snackbar.make(contentWebView, <span class="string">"Android的方法被调用"</span>, Snackbar.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@JavascriptInterface</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">androidFunction</span><span class="params">(String text)</span> </span>&#123;</div><div class="line">        Snackbar.make(contentWebView, <span class="string">"Android的方法被调用并收到参数 : \n"</span> + text, Snackbar.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</div><div class="line">        getMenuInflater().inflate(R.menu.menu_main, menu);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> id = item.getItemId();</div><div class="line">        <span class="keyword">if</span> (id == R.id.action_js_function1) &#123;</div><div class="line">            <span class="comment">// 调用JS的jsFunction方法</span></div><div class="line">            contentWebView.loadUrl(<span class="string">"javascript:jsFunction()"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (id == R.id.action_js_function2) &#123;</div><div class="line">            <span class="comment">// 调用JS的jsFunctionArg方法</span></div><div class="line">            contentWebView.loadUrl(<span class="string">"javascript:jsFunctionArg('[Android传递过来的数据]')"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onOptionsItemSelected(item);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/16/2016-11-16-Android播放音效/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/16/2016-11-16-Android播放音效/" itemprop="url">Android播放音效</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-16T10:56:36+08:00">
                2016-11-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/16/2016-11-16-Android播放音效/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/11/16/2016-11-16-Android播放音效/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.com/2016/11/16/2016-11-16-Android%E6%92%AD%E6%94%BE%E9%9F%B3%E6%95%88/" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/article/details/53184654" target="_blank" rel="external">CSDN</a></p>
<hr>
<p>有些时候程序需要播放几个很短的低延迟的音效来响应与用户的交互。</p>
<p>Android通过<code>SoundPool</code>将文件音频缓存加载到内存中，然后在响应用户操作的时候快速地播放。<br>Android框架低通了SoundPool来解码小音频文件，并在内存中操作它们来进行音频快速和重复的播放。SoundPool还有一些其他特性，比如可以在运行时控制音量和播放速度。</p>
<p>播放音效也很简单，总共分5步</p>
<h1 id="准备音频文件"><a href="#准备音频文件" class="headerlink" title="准备音频文件"></a>准备音频文件</h1><p>将音频文件放置在assets目录下</p>
<p><img src="http://img.blog.csdn.net/20161116111440550" alt="准备音频文件"></p>
<h1 id="初始化SoundPool"><a href="#初始化SoundPool" class="headerlink" title="初始化SoundPool"></a>初始化SoundPool</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SoundPool mSoundPool = <span class="keyword">new</span> SoundPool(<span class="number">1</span>, AudioManager.STREAM_MUSIC, <span class="number">0</span>);</div></pre></td></tr></table></figure>
<h1 id="加载音频文件"><a href="#加载音频文件" class="headerlink" title="加载音频文件"></a>加载音频文件</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> streamID = mSoundPool.load(getApplicationContext().getAssets().openFd(<span class="string">"beep/beep1.mp3"</span>), <span class="number">1</span>);</div></pre></td></tr></table></figure>
<h1 id="播放音频文件"><a href="#播放音频文件" class="headerlink" title="播放音频文件"></a>播放音频文件</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mSoundPool.play(streamID, <span class="number">10</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1.0f</span>);</div></pre></td></tr></table></figure>
<h1 id="释放SoundPool"><a href="#释放SoundPool" class="headerlink" title="释放SoundPool"></a>释放SoundPool</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mSoundPool.release();</div><div class="line">mSoundPool = <span class="keyword">null</span>;</div></pre></td></tr></table></figure>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.kongqw.kqwplaybeepdemo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.media.AudioManager;</div><div class="line"><span class="keyword">import</span> android.media.SoundPool;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MainActivity"</span>;</div><div class="line">    <span class="keyword">private</span> SoundPool mSoundPool;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> streamID;</div><div class="line">    <span class="keyword">private</span> HashMap&lt;String, Integer&gt; mSoundMap;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        findViewById(R.id.button_beep1).setOnClickListener(<span class="keyword">this</span>);</div><div class="line">        findViewById(R.id.button_beep2).setOnClickListener(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">        mSoundPool = <span class="keyword">new</span> SoundPool(<span class="number">1</span>, AudioManager.STREAM_MUSIC, <span class="number">0</span>);</div><div class="line">        mSoundMap = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            streamID = mSoundPool.load(getApplicationContext().getAssets().openFd(<span class="string">"beep/beep1.mp3"</span>), <span class="number">1</span>);</div><div class="line">            mSoundMap.put(<span class="string">"beep1.mp3"</span>, streamID);</div><div class="line">            streamID = mSoundPool.load(getApplicationContext().getAssets().openFd(<span class="string">"beep/beep2.mp3"</span>), <span class="number">1</span>);</div><div class="line">            mSoundMap.put(<span class="string">"beep2.mp3"</span>, streamID);</div><div class="line">            Log.i(TAG, <span class="string">"onCreate: streamID = "</span> + streamID);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">        mSoundPool.release();</div><div class="line">        mSoundPool = <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (view.getId()) &#123;</div><div class="line">            <span class="keyword">case</span> R.id.button_beep1:</div><div class="line">                streamID = mSoundMap.get(<span class="string">"beep1.mp3"</span>);</div><div class="line">                mSoundPool.play(streamID, <span class="number">10</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1.0f</span>);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> R.id.button_beep2:</div><div class="line">                streamID = mSoundMap.get(<span class="string">"beep2.mp3"</span>);</div><div class="line">                mSoundPool.play(streamID, <span class="number">10</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1.0f</span>);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/14/2016-11-14-App启动优化最佳实践/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/14/2016-11-14-App启动优化最佳实践/" itemprop="url">App启动优化最佳实践</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-14T17:43:17+08:00">
                2016-11-14
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/14/2016-11-14-App启动优化最佳实践/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/11/14/2016-11-14-App启动优化最佳实践/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.com/2016/11/14/2016-11-14-App%E5%90%AF%E5%8A%A8%E4%BC%98%E5%8C%96%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/article/details/53162188" target="_blank" rel="external">CSDN</a></p>
<hr>
<blockquote>
<p>看了医生写的文章<a href="http://mp.weixin.qq.com/s?__biz=MzAxNzMxNzk5OQ==&amp;mid=2649484847&amp;idx=1&amp;sn=39ebb7b2444bee53224246d8f26dce36&amp;chksm=83f8272fb48fae392300dbe011f624a0981286b66c9a7b9508e49b95eee80b2ea86568366564&amp;scene=4#wechat_redirect" target="_blank" rel="external">一触即发——App启动优化最佳实践</a>，收获是有的。</p>
</blockquote>
<p>做Android开发，一定写给过启动页，在这里做一些初始化的操作，还有就是显示推广信息。</p>
<p>很普通的一个页面，以前测试也给我提出过bug，应用在启动的时候，有时候有白屏/黑屏。当时能做的就是尽量较少耗时操作，上面医生的文章里也有提到，但是通过主题的方式优化这个问题之前还真是不知道的。</p>
<p>下面主要总结一下通过主题的方式优化启动页（医生还提到了在子线程初始化和使用IntentService初始化，都是属于异步初始化，还有延迟初始化，就不说了）</p>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20161114183258615" alt="优化前"></p>
<p><img src="http://img.blog.csdn.net/20161114183329516" alt="优化后"></p>
<h1 id="通过修改主题优化启动时白屏-黑屏"><a href="#通过修改主题优化启动时白屏-黑屏" class="headerlink" title="通过修改主题优化启动时白屏/黑屏"></a>通过修改主题优化启动时白屏/黑屏</h1><blockquote>
<p>原理请移步到医生的文章，我就不复述了，之所以会看到白屏或者黑屏，是和我们的主题有关系的，因为系统默认使用的主题，背景色就是白色/黑色。那么我们自定义一个主题，让默认的样式就是我们想要的，就优化了白屏/黑屏的问题。</p>
</blockquote>
<p>首先，我们自定义一个主题,设置一个我们想要的背景</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 启动页主题 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"SplashTheme"</span> <span class="attr">parent</span>=<span class="string">"@style/Theme.AppCompat.Light.NoActionBar"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="xml">	<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowBackground"</span>&gt;</span>@drawable/start_window<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<p>自定义背景<code>start_window.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">layer-list</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:opacity</span>=<span class="string">"opaque"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- The background color, preferably the same as your normal theme --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@android:color/holo_blue_dark"</span> /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- Your product logo - 144dp color version of your app icon --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">bitmap</span></span></div><div class="line"><span class="tag">            <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">"@mipmap/ic_launcher"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></div></pre></td></tr></table></figure>
<p>最后，在清单文件设置启动页使用我们自定义的主题</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">package</span>=<span class="string">"com.bitmain.launchtimedemo"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">application</span></span></div><div class="line"><span class="tag">        <span class="attr">android:allowBackup</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:supportsRtl</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 启动页 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">activity</span></span></div><div class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">".SplashActivity"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:theme</span>=<span class="string">"@style/SplashTheme"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span> /&gt;</span></div><div class="line"></div><div class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 主页 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".MainActivity"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div></pre></td></tr></table></figure>
<p>到此大功告成，为了体现出效果，在启动页加载之前，我们模拟一个白屏/黑屏的延时操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SplashActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        <span class="comment">// 模拟系统初始化  白屏、黑屏</span></div><div class="line">        SystemClock.sleep(<span class="number">1000</span>);</div><div class="line">        setContentView(R.layout.activity_splash);</div><div class="line">		<span class="comment">// 启动后 停留2秒进入到主页面</span></div><div class="line">        <span class="keyword">new</span> Handler().postDelayed(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                Intent intent = <span class="keyword">new</span> Intent(SplashActivity.<span class="keyword">this</span>, MainActivity.class);</div><div class="line">                startActivity(intent);</div><div class="line">                finish();</div><div class="line">            &#125;</div><div class="line">        &#125;, <span class="number">2000</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/01/2016-11-01-Android串口通信/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/01/2016-11-01-Android串口通信/" itemprop="url">Android串口通信</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-01T15:40:53+08:00">
                2016-11-01
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/01/2016-11-01-Android串口通信/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/11/01/2016-11-01-Android串口通信/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.com/2016/11/01/2016-11-01-Android%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1/" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/article/details/52996548" target="_blank" rel="external">CSDN</a></p>
<hr>
<blockquote>
<p>串口通信偏向嵌入式一点，是Android设备通过串口与其他设备进行通信的一种方式，本文介绍的Android纯串口的通信，并不是手机上的USB串口通信。</p>
</blockquote>
<p><img src="http://img.blog.csdn.net/20161101153352899" alt="P1"></p>
<blockquote>
<p>手机上是没有这个串口的哦。</p>
</blockquote>
<p>关于串口通信，Google已经给出了源码，地址在GitHub <a href="https://github.com/cepr/android-serialport-api" target="_blank" rel="external">android-serialport-api</a></p>
<p>四年前的代码，还是Eclipse工程，本文主要介绍如何在Android Studio中使用。</p>
<p>源码地址在 <a href="https://github.com/kongqw/KqwSerialPortDemo" target="_blank" rel="external">KqwSerialPortDemo</a> </p>
<h1 id="集成"><a href="#集成" class="headerlink" title="集成"></a>集成</h1><p>Java层的代码，Google已经给封装在 <a href="https://github.com/kongqw/KqwSerialPortDemo/blob/master/SerialPortLibrary/src/main/java/qingwei/kong/serialportlibrary/SerialPort.java" target="_blank" rel="external">SerialPort.java</a></p>
<h2 id="导入-so"><a href="#导入-so" class="headerlink" title="导入.so"></a>导入.so</h2><p>没有什么难度了，将so导入到项目</p>
<p><img src="http://img.blog.csdn.net/20161101153618510" alt="P1"></p>
<h2 id="导入jni文件"><a href="#导入jni文件" class="headerlink" title="导入jni文件"></a>导入jni文件</h2><p>在<code>main</code>目录下创建<code>cpp</code>文件夹，并将jni源文件和CMakeLists.txt导入</p>
<p><img src="http://img.blog.csdn.net/20161101153635136" alt="P2"></p>
<p>在<code>build.gradle</code>配置<code>cmake</code>路径。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    ……</div><div class="line">    externalNativeBuild &#123;</div><div class="line">        cmake &#123;</div><div class="line">            path <span class="string">"src/main/cpp/CMakeLists.txt"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">	……</div><div class="line">｝</div></pre></td></tr></table></figure>
<h2 id="修改jni源文件"><a href="#修改jni源文件" class="headerlink" title="修改jni源文件"></a>修改jni源文件</h2><p>这里要注意jni文件函数名的写法：<code>Java_包名_类名_方法名</code></p>
<p><img src="http://img.blog.csdn.net/20161101153707996" alt="P3"></p>
<p>在将源码里的jni导入过来的时候，包名是源码Demo的包名，我们在自己的工程里要换成自己的包名、类名，源文件和头文件都要记得改。</p>
<h2 id="修改CMakeLists-txt与SerialPort-java"><a href="#修改CMakeLists-txt与SerialPort-java" class="headerlink" title="修改CMakeLists.txt与SerialPort.java"></a>修改CMakeLists.txt与SerialPort.java</h2><p>CMakeLists.txt</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">cmake_minimum_required(VERSION <span class="number">3.4</span>.1)</div><div class="line"></div><div class="line">add_library(SerialPort SHARED</div><div class="line">            SerialPort.c)</div><div class="line"></div><div class="line"># Include libraries needed for libserial_port lib</div><div class="line">target_link_libraries(SerialPort</div><div class="line">                      android</div><div class="line">                      log)</div></pre></td></tr></table></figure>
<p>SerialPort.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> &#123;</div><div class="line">    System.loadLibrary(<span class="string">"SerialPort"</span>);</div><div class="line">    System.loadLibrary(<span class="string">"serial_port"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="基类"><a href="#基类" class="headerlink" title="基类"></a>基类</h2><p>需要使用串口通信的类继承 <a href="https://github.com/kongqw/KqwSerialPortDemo/blob/master/app/src/main/java/qingwei/kong/kqwserialportdemo/SerialPortActivity.java" target="_blank" rel="external">SerialPortActivity.java</a></p>
<h2 id="打开串口"><a href="#打开串口" class="headerlink" title="打开串口"></a>打开串口</h2><ul>
<li>端口号：/dev/ttyS2</li>
<li>比特率：115200</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> SerialPort <span class="title">getSerialPort</span><span class="params">()</span> <span class="keyword">throws</span> SecurityException, IOException, InvalidParameterException </span>&#123;</div><div class="line">    <span class="keyword">if</span> (mSerialPort == <span class="keyword">null</span>) &#123;</div><div class="line">        mSerialPort = <span class="keyword">new</span> SerialPort(<span class="keyword">new</span> File(<span class="string">"/dev/ttyS2"</span>), <span class="number">115200</span>, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> mSerialPort;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="关闭串口"><a href="#关闭串口" class="headerlink" title="关闭串口"></a>关闭串口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeSerialPort</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (mSerialPort != <span class="keyword">null</span>) &#123;</div><div class="line">        mSerialPort.close();</div><div class="line">        mSerialPort = <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="发送数据"><a href="#发送数据" class="headerlink" title="发送数据"></a>发送数据</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Message message = Message.obtain();</div><div class="line">message.obj = text.getBytes();</div><div class="line">sendingHandler.sendMessage(message);</div></pre></td></tr></table></figure>
<h2 id="接收消息"><a href="#接收消息" class="headerlink" title="接收消息"></a>接收消息</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDataReceived</span><span class="params">(<span class="keyword">final</span> <span class="keyword">byte</span>[] buffer, <span class="keyword">final</span> <span class="keyword">int</span> size)</span> </span>&#123;</div><div class="line">    runOnUiThread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            Toast.makeText(mApplication, <span class="string">"收到消息："</span> + <span class="keyword">new</span> String(buffer) + <span class="string">"  size = "</span> + size, Toast.LENGTH_SHORT).show();</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="下载并安装NDK与CMake"><a href="#下载并安装NDK与CMake" class="headerlink" title="下载并安装NDK与CMake"></a>下载并安装NDK与CMake</h1><p><img src="http://img.blog.csdn.net/20161104110635516" alt="下载并安装NDK与CMake"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/09/2016-09-09-OpenCV-JavaCV实现人脸识别/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/09/2016-09-09-OpenCV-JavaCV实现人脸识别/" itemprop="url">OpenCV+JavaCV实现人脸识别</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-09T16:29:53+08:00">
                2016-09-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/开源/" itemprop="url" rel="index">
                    <span itemprop="name">开源</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/09/09/2016-09-09-OpenCV-JavaCV实现人脸识别/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/09/09/2016-09-09-OpenCV-JavaCV实现人脸识别/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.com/2016/09/09/2016-09-09-OpenCV-JavaCV%E5%AE%9E%E7%8E%B0%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/article/details/52488447" target="_blank" rel="external">CSDN</a></p>
<hr>
<p>OpenCV主要实现人脸检测功能</p>
<p>JavaCV主要实现人脸对比功能</p>
<p>具体的就不啰嗦了，本来最近很忙，主要是因为好多人私信我要 <a href="http://kongqw.com/2016/07/06/2016-07-06-Android%E4%BD%BF%E7%94%A8OpenCV%E5%AE%9E%E7%8E%B0%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/" target="_blank" rel="external">Android使用OpenCV实现「人脸检测」和「人脸识别」</a> 的Demo，今天特意抽出时间写了一下。</p>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20160909162919759" alt="效果图"></p>
<p><img src="http://img.blog.csdn.net/20160909162931572" alt="效果图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="https://github.com/kongqw/KqwFaceDetectionDemo" target="_blank" rel="external">KqwFaceDetectionDemo</a></p>
<p>感觉有用的话，就给个<code>star</code>吧，谢谢！！</p>
<h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><p>最后啰嗦一点，如果你的程序是跑在手机、pad等设备上，一般没有什么问题。<br>但是如果你是在自己的开发板上跑，可能会有一些小插曲。</p>
<p>比如我司的机器人是定制的Android板子，对系统做了裁剪，很多摄像头的方法可能就用不了</p>
<p>例如这样一个错误</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">AndroidRuntime: java.lang.RuntimeException: setParameters failed</div></pre></td></tr></table></figure>
<p>当打开程序的时候，OpenCV会提示，没有找到可用摄像头或者摄像头被锁住（大概这个意思，我就不截图了），一种可能是设备真的没有接摄像头，也有可能是摄像头定制过，导致某些方法用不了，比如上面的错误就是我遇到的其中一个。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/01/2016-09-01-Android自定义摇杆/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/01/2016-09-01-Android自定义摇杆/" itemprop="url">Android自定义摇杆</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-01T17:37:11+08:00">
                2016-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/开源/" itemprop="url" rel="index">
                    <span itemprop="name">开源</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/09/01/2016-09-01-Android自定义摇杆/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/09/01/2016-09-01-Android自定义摇杆/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.com/2016/09/01/2016-09-01-Android%E8%87%AA%E5%AE%9A%E4%B9%89%E6%91%87%E6%9D%86/" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/article/details/52402529" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20160901182847783" alt="效果图"></p>
<p><img src="http://img.blog.csdn.net/20160901182902455" alt="效果图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="https://github.com/kongqw/KqwRockerDemo" target="_blank" rel="external">KqwRockerDemo</a></p>
<p>喜欢就给个<code>star</code>，谢谢！</p>
<h1 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h1><ul>
<li>支持自适应大小</li>
<li>支持2个方向、4个方向、8个方向的摇动监听</li>
<li>支持摇动角度获取</li>
<li>可选回调模式</li>
<li>支持可摇动区域自定义</li>
<li>支持摇杆自定义</li>
<li>支持设置图片、色值、Shape图形</li>
</ul>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;kong.qingwei.rockerlibrary.RockerView</div><div class="line">    android:id=<span class="string">"@+id/rockerView_center"</span></div><div class="line">    android:layout_width=<span class="string">"100dp"</span></div><div class="line">    android:layout_height=<span class="string">"100dp"</span></div><div class="line">    android:layout_centerHorizontal=<span class="string">"true"</span></div><div class="line">    kongqw:areaBackground=<span class="string">"#FF333333"</span></div><div class="line">    kongqw:rockerBackground=<span class="string">"#FF987654"</span></div><div class="line">    kongqw:rockerRadius=<span class="string">"15dp"</span> /&gt;</div></pre></td></tr></table></figure>
<h1 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h1><table>
<thead>
<tr>
<th>参数</th>
<th>是否必须</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>areaBackground</td>
<td>可选</td>
<td>可摇动区域的背景</td>
</tr>
<tr>
<td>rockerBackground</td>
<td>可选</td>
<td>摇杆的背景</td>
</tr>
<tr>
<td>rockerRadius</td>
<td>可选</td>
<td>摇杆半径</td>
</tr>
</tbody>
</table>
<h1 id="设置回调方式"><a href="#设置回调方式" class="headerlink" title="设置回调方式"></a>设置回调方式</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">setCallBackMode(CallBackMode mode)</div></pre></td></tr></table></figure>
<p>参数</p>
<table>
<thead>
<tr>
<th>回调方式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>CALL_BACK_MODE_MOVE</td>
<td>有移动就立刻回调</td>
</tr>
<tr>
<td>CALL_BACK_MODE_STATE_CHANGE</td>
<td>状态有变化的时候回调</td>
</tr>
</tbody>
</table>
<h1 id="监听摇动角度"><a href="#监听摇动角度" class="headerlink" title="监听摇动角度"></a>监听摇动角度</h1><p>返回角度的取值范围：[0°,360°)</p>
<p><img src="http://img.blog.csdn.net/20160901183045786" alt="取值范围"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">setOnAngleChangeListener(OnAngleChangeListener listener)</div></pre></td></tr></table></figure>
<h1 id="监听摇动方向"><a href="#监听摇动方向" class="headerlink" title="监听摇动方向"></a>监听摇动方向</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">setOnShakeListener(DirectionMode directionMode, OnShakeListener listener)</div></pre></td></tr></table></figure>
<p>支持监听的方向</p>
<table>
<thead>
<tr>
<th>方向</th>
<th>图</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>DIRECTION_2_HORIZONTAL</td>
<td><img src="http://img.blog.csdn.net/20160901183144896" alt="左右两个方向"></td>
<td>横向 左右两个方向</td>
</tr>
<tr>
<td>DIRECTION_2_VERTICAL</td>
<td><img src="http://img.blog.csdn.net/20160901183332084" alt="上下两个方向"></td>
<td>纵向 上下两个方向</td>
</tr>
<tr>
<td>DIRECTION_4_ROTATE_0</td>
<td><img src="http://img.blog.csdn.net/20160901183347055" alt="四个方向"></td>
<td>四个方向</td>
</tr>
<tr>
<td>DIRECTION_4_ROTATE_45</td>
<td><img src="http://img.blog.csdn.net/20160901183404461" alt="四个方向 旋转45°"></td>
<td>四个方向 旋转45°</td>
</tr>
<tr>
<td>DIRECTION_8</td>
<td><img src="http://img.blog.csdn.net/20160901183419477" alt="八个方向"></td>
<td>八个方向</td>
</tr>
</tbody>
</table>
<p>方向描述</p>
<table>
<thead>
<tr>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>DIRECTION_LEFT</td>
<td>左</td>
</tr>
<tr>
<td>DIRECTION_RIGHT</td>
<td>右</td>
</tr>
<tr>
<td>DIRECTION_UP</td>
<td>上</td>
</tr>
<tr>
<td>DIRECTION_DOWN</td>
<td>下</td>
</tr>
<tr>
<td>DIRECTION_UP_LEFT</td>
<td>左上</td>
</tr>
<tr>
<td>DIRECTION_UP_RIGHT</td>
<td>右上</td>
</tr>
<tr>
<td>DIRECTION_DOWN_LEFT</td>
<td>左下</td>
</tr>
<tr>
<td>DIRECTION_DOWN_RIGHT</td>
<td>右下</td>
</tr>
<tr>
<td>DIRECTION_CENTER</td>
<td>中间</td>
</tr>
</tbody>
</table>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">RockerView rockerViewLeft = (RockerView) findViewById(R.id.rockerView_left);</div><div class="line"><span class="keyword">if</span> (rockerViewLeft != <span class="keyword">null</span>) &#123;</div><div class="line">    rockerViewLeft.setCallBackMode(RockerView.CallBackMode.CALL_BACK_MODE_STATE_CHANGE);</div><div class="line">    rockerViewLeft.setOnShakeListener(RockerView.DirectionMode.DIRECTION_8, <span class="keyword">new</span> RockerView.OnShakeListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</div><div class="line">            mLogLeft.setText(<span class="keyword">null</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">direction</span><span class="params">(RockerView.Direction direction)</span> </span>&#123;</div><div class="line">            mLogLeft.setText(<span class="string">"摇动方向 : "</span> + getDirection(direction));</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFinish</span><span class="params">()</span> </span>&#123;</div><div class="line">            mLogLeft.setText(<span class="keyword">null</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">RockerView rockerViewRight = (RockerView) findViewById(R.id.rockerView_right);</div><div class="line"><span class="keyword">if</span> (rockerViewRight != <span class="keyword">null</span>) &#123;</div><div class="line">    rockerViewRight.setOnAngleChangeListener(<span class="keyword">new</span> RockerView.OnAngleChangeListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</div><div class="line">            mLogRight.setText(<span class="keyword">null</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">angle</span><span class="params">(<span class="keyword">double</span> angle)</span> </span>&#123;</div><div class="line">            mLogRight.setText(<span class="string">"摇动角度 : "</span> + angle);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFinish</span><span class="params">()</span> </span>&#123;</div><div class="line">            mLogRight.setText(<span class="keyword">null</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/29/2016-08-29-Android输出正弦波音频信号-左右声道对称/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/29/2016-08-29-Android输出正弦波音频信号-左右声道对称/" itemprop="url">Android输出正弦波音频信号(左右声道对称)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-29T15:01:34+08:00">
                2016-08-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/08/29/2016-08-29-Android输出正弦波音频信号-左右声道对称/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/08/29/2016-08-29-Android输出正弦波音频信号-左右声道对称/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.com/2016/08/29/2016-08-29-Android%E8%BE%93%E5%87%BA%E6%AD%A3%E5%BC%A6%E6%B3%A2%E9%9F%B3%E9%A2%91%E4%BF%A1%E5%8F%B7-%E5%B7%A6%E5%8F%B3%E5%A3%B0%E9%81%93%E5%AF%B9%E7%A7%B0/" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/article/details/52353727" target="_blank" rel="external">CSDN</a></p>
<hr>
<p>需求：左右声道分别输出不同的音频数据，波形要是一个正弦波，左右声道还要对称！<br>对硬件不是很了解，说是要通过音波避障。</p>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20160829154617837" alt="效果图"></p>
<p>之前已经介绍了如何在左右声道输出不同的音频数据。<br>那么这里主要介绍如何模拟出波形是正弦波的音频数据。</p>
<h1 id="模拟正弦波"><a href="#模拟正弦波" class="headerlink" title="模拟正弦波"></a>模拟正弦波</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 模拟正弦波音频数据</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> isLeft 左右声道</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span> 音频数据</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">short</span>[] initData(<span class="keyword">boolean</span> isLeft) &#123;</div><div class="line">    <span class="keyword">double</span> phase = <span class="number">0.0</span>;</div><div class="line">    <span class="keyword">int</span> amp = <span class="number">10000</span>;</div><div class="line">    <span class="keyword">short</span>[] data = <span class="keyword">new</span> <span class="keyword">short</span>[bufferSize];</div><div class="line"></div><div class="line">    <span class="keyword">double</span> phaseIncrement = (<span class="number">2</span> * Math.PI * mFrequency) / mSampleRateInHz;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bufferSize; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (isLeft) &#123;</div><div class="line">            data[i] = (<span class="keyword">short</span>) (amp * Math.sin(phase));</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            data[i] = (<span class="keyword">short</span>) (-amp * Math.sin(phase));</div><div class="line">        &#125;</div><div class="line">        phase += phaseIncrement;</div><div class="line">        Log.i(TAG, <span class="string">"initData: isLeft = "</span> + isLeft + <span class="string">"  buffer["</span> + i + <span class="string">"] = "</span> + data[i]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> data;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>主要参数</p>
<ul>
<li>mFrequency：频率</li>
<li>mSampleRateInHz：采样率</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 单声道</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> mChannelConfig = AudioFormat.CHANNEL_OUT_MONO;</div><div class="line"><span class="comment">// 频率</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> mFrequency = <span class="number">19000</span>;</div><div class="line"><span class="comment">// 采样率</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> mSampleRateInHz = <span class="number">44100</span>;</div></pre></td></tr></table></figure>
<h1 id="播放音频的线程封装"><a href="#播放音频的线程封装" class="headerlink" title="播放音频的线程封装"></a>播放音频的线程封装</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> kong.qingwei.myapplication;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.annotation.TargetApi;</div><div class="line"><span class="keyword">import</span> android.media.AudioFormat;</div><div class="line"><span class="keyword">import</span> android.media.AudioManager;</div><div class="line"><span class="keyword">import</span> android.media.AudioTrack;</div><div class="line"><span class="keyword">import</span> android.os.Build;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Created by kqw on 2016/8/29.</span></div><div class="line"><span class="comment"> * 播放音乐的线程</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChannelThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"ChannelThread"</span>;</div><div class="line">    <span class="keyword">private</span> AudioTrack mAudioTrack;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">short</span>[] mData;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 构造方法</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> channelConfig  声道</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> sampleRateInHz 采样率</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> data           音频数据</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> bufferSize     缓存大小</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> isLeft         左右声道</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@TargetApi</span>(Build.VERSION_CODES.LOLLIPOP)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChannelThread</span><span class="params">(<span class="keyword">int</span> channelConfig, <span class="keyword">int</span> sampleRateInHz, <span class="keyword">short</span>[] data, <span class="keyword">int</span> bufferSize, <span class="keyword">boolean</span> isLeft)</span> </span>&#123;</div><div class="line">        mData = data;</div><div class="line"></div><div class="line">        mAudioTrack = <span class="keyword">new</span> AudioTrack(</div><div class="line">                AudioManager.STREAM_MUSIC,</div><div class="line">                sampleRateInHz,</div><div class="line">                channelConfig,</div><div class="line">                AudioFormat.ENCODING_PCM_16BIT,</div><div class="line">                bufferSize,</div><div class="line">                AudioTrack.MODE_STREAM);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (isLeft) &#123;</div><div class="line">            mAudioTrack.setStereoVolume(AudioTrack.getMaxVolume(), <span class="number">0</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            mAudioTrack.setStereoVolume(<span class="number">0</span>, AudioTrack.getMaxVolume());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.run();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != mAudioTrack) &#123;</div><div class="line">                mAudioTrack.play();</div><div class="line">                <span class="keyword">while</span> (AudioTrack.PLAYSTATE_STOPPED != mAudioTrack.getPlayState()) &#123;</div><div class="line">                    mAudioTrack.write(mData, <span class="number">0</span>, mData.length);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            Log.i(TAG, <span class="string">"run: End"</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 释放AudioTrack</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">releaseAudioTrack</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mAudioTrack) &#123;</div><div class="line">            mAudioTrack.stop();</div><div class="line">            mAudioTrack.release();</div><div class="line">            mAudioTrack = <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="播放"><a href="#播放" class="headerlink" title="播放"></a>播放</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mLeftChannelThread = <span class="keyword">new</span> ChannelThread(mChannelConfig, mSampleRateInHz, mDataLeft, bufferSize, <span class="keyword">true</span>);</div><div class="line">mRightChannelThread = <span class="keyword">new</span> ChannelThread(mChannelConfig, mSampleRateInHz, mDataRight, bufferSize, <span class="keyword">false</span>);</div><div class="line"></div><div class="line">mLeftChannelThread.start();</div><div class="line">mRightChannelThread.start();</div></pre></td></tr></table></figure>
<h1 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (<span class="keyword">null</span> != mLeftChannelThread) &#123;</div><div class="line">    mLeftChannelThread.releaseAudioTrack();</div><div class="line">    mLeftChannelThread = <span class="keyword">null</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (<span class="keyword">null</span> != mRightChannelThread) &#123;</div><div class="line">    mRightChannelThread.releaseAudioTrack();</div><div class="line">    mRightChannelThread = <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="不足"><a href="#不足" class="headerlink" title="不足"></a>不足</h1><p>这里介绍的是在程序中模拟出一个波形满足正弦波的音频数据，还有一种方式，可以事先准备好一个这样的音频文件，直接播放就可以了。</p>
<p>在程序中模拟音频数据有一个缺点，就是不能保证两个线程完完全全的同步，即便是同时开启两个线程也有一先一后，在频率很高的时候，难免会有一点误差！像下面这样：</p>
<p><img src="http://img.blog.csdn.net/20160829154737304" alt="误差图"></p>
<p>另外，这个波形和硬件有很大关系，越是低配设备，误差可能会越大，相同的趋势，但是波动的幅度会比较大（线很粗），可能和设备本身的噪音有关系。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="kongqw" />
          <p class="site-author-name" itemprop="name">kongqw</p>
           
              <p class="site-description motion-element" itemprop="description">Android Developer</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">54</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/kongqw" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.csdn.net/q4878802" target="_blank" title="CSDN">
                  
                    <i class="fa fa-fw fa-home"></i>
                  
                  CSDN
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://gank.io" title="干货集中营" target="_blank">干货集中营</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.xfyun.cn" title="讯飞开放平台" target="_blank">讯飞开放平台</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.easemob.com" title="环信" target="_blank">环信</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://tongji.baidu.com" title="百度统计" target="_blank">百度统计</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://kongqw.disqus.com/admin/" title="DISQUS评论" target="_blank">DISQUS评论</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://wallet.btc.com/" title="BTC Wallet" target="_blank">BTC Wallet</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.okcoin.cn/" title="OKCoin中国站" target="_blank">OKCoin中国站</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.okcoin.com/" title="OKCoin国际站" target="_blank">OKCoin国际站</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://btc.com/" title="BTC.com" target="_blank">BTC.com</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kongqw</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://kongqw.disqus.com/count.js" async></script>
    

    

  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
