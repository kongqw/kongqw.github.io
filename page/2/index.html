<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="Android Developer">
<meta property="og:type" content="website">
<meta property="og:title" content="孔庆威的博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="孔庆威的博客">
<meta property="og:description" content="Android Developer">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="孔庆威的博客">
<meta name="twitter:description" content="Android Developer">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>孔庆威的博客</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?e8ad05f02e13a412b09b2e8a632634af";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>











  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">孔庆威的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">精于心，简于形</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/16/2016-11-16-Android与Javascript交互/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/16/2016-11-16-Android与Javascript交互/" itemprop="url">Android与Javascript交互</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-16T17:59:39+08:00">
                2016-11-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/16/2016-11-16-Android与Javascript交互/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/11/16/2016-11-16-Android与Javascript交互/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.com/2016/11/16/2016-11-16-Android%E4%B8%8EJavascript%E4%BA%A4%E4%BA%92/" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/article/details/53189882" target="_blank" rel="external">CSDN</a></p>
<hr>
<p>本篇参考<a href="http://blog.csdn.net/leejizhou/article/details/50894531" target="_blank" rel="external">Android与HTML+JS交互入门</a></p>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20161116184229121" alt="效果图"></p>
<h1 id="加载本地Html"><a href="#加载本地Html" class="headerlink" title="加载本地Html"></a>加载本地Html</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">contentWebView = (WebView) findViewById(R.id.webview);</div><div class="line"><span class="comment">// 加载Assets下的Html</span></div><div class="line">contentWebView.loadUrl(<span class="string">"file:///android_asset/html/test.html"</span>);</div></pre></td></tr></table></figure>
<h1 id="启用Javascript"><a href="#启用Javascript" class="headerlink" title="启用Javascript"></a>启用Javascript</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">contentWebView.getSettings().setJavaScriptEnabled(<span class="keyword">true</span>);</div><div class="line">contentWebView.addJavascriptInterface(<span class="keyword">this</span>, <span class="string">"android"</span>);</div></pre></td></tr></table></figure>
<h1 id="Android调用Javascript的方法"><a href="#Android调用Javascript的方法" class="headerlink" title="Android调用Javascript的方法"></a>Android调用Javascript的方法</h1><p>Javascript写法</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="undefined">    function jsFunction()&#123;</span></div><div class="line"><span class="undefined">         document.getElementById("content").innerHTML = "JS方法被调用";</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined">    function jsFunctionArg(arg)&#123;</span></div><div class="line"><span class="xml">         document.getElementById("content").innerHTML = "JS方法被调用并收到参数：<span class="tag">&lt;<span class="name">br</span>/&gt;</span>" + arg;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Android写法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 调用JS的jsFunction方法</span></div><div class="line">contentWebView.loadUrl(<span class="string">"javascript:jsFunction()"</span>);</div><div class="line"><span class="comment">// 调用JS的jsFunctionArg方法</span></div><div class="line">contentWebView.loadUrl(<span class="string">"javascript:jsFunctionArg('[Android传递过来的数据]')"</span>);</div></pre></td></tr></table></figure>
<h1 id="Javascript调用Android的方法"><a href="#Javascript调用Android的方法" class="headerlink" title="Javascript调用Android的方法"></a>Javascript调用Android的方法</h1><p>Android方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@JavascriptInterface</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">androidFunction</span><span class="params">()</span> </span>&#123;</div><div class="line">    Snackbar.make(contentWebView, <span class="string">"Android的方法被调用"</span>, Snackbar.LENGTH_SHORT).show();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@JavascriptInterface</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">androidFunction</span><span class="params">(String text)</span> </span>&#123;</div><div class="line">    Snackbar.make(contentWebView, <span class="string">"Android的方法被调用并收到参数 : \n"</span> + text, Snackbar.LENGTH_SHORT).show();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Javascript调用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">style</span>=<span class="string">"width:300px;height:50px;"</span> <span class="attr">value</span>=<span class="string">"JS调用Android方法"</span> <span class="attr">onclick</span>=<span class="string">"window.android.androidFunction()"</span> /&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">style</span>=<span class="string">"width:300px;height:50px;"</span> <span class="attr">value</span>=<span class="string">"JS调用Android带有参数的方法"</span> <span class="attr">onclick</span>=<span class="string">"window.android.androidFunction('[JS传递过来的数据]')"</span> /&gt;</span></div></pre></td></tr></table></figure>
<hr>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><p><img src="http://img.blog.csdn.net/20161116184259654" alt="XML"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=gb2312"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="undefined">            function jsFunction()&#123;</span></div><div class="line"><span class="undefined">                 document.getElementById("content").innerHTML = "JS方法被调用";</span></div><div class="line"><span class="undefined">            &#125;</span></div><div class="line"><span class="undefined">            function jsFunctionArg(arg)&#123;</span></div><div class="line"><span class="xml">                 document.getElementById("content").innerHTML = "JS方法被调用并收到参数：<span class="tag">&lt;<span class="name">br</span>/&gt;</span>" + arg;</span></div><div class="line"><span class="undefined">            &#125;</span></div><div class="line"><span class="undefined">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>HTML页面<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span>|<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">style</span>=<span class="string">"width:300px;height:50px;"</span> <span class="attr">value</span>=<span class="string">"JS调用Android方法"</span> <span class="attr">onclick</span>=<span class="string">"window.android.androidFunction()"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">style</span>=<span class="string">"width:300px;height:50px;"</span> <span class="attr">value</span>=<span class="string">"JS调用Android带有参数的方法"</span> <span class="attr">onclick</span>=<span class="string">"window.android.androidFunction('[JS传递过来的数据]')"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.kongqw.kqwandroidjsdemo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.annotation.SuppressLint;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.design.widget.Snackbar;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.Toolbar;</div><div class="line"><span class="keyword">import</span> android.view.Menu;</div><div class="line"><span class="keyword">import</span> android.view.MenuItem;</div><div class="line"><span class="keyword">import</span> android.webkit.JavascriptInterface;</div><div class="line"><span class="keyword">import</span> android.webkit.WebView;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> WebView contentWebView;</div><div class="line"></div><div class="line">    <span class="meta">@SuppressLint</span>(&#123;<span class="string">"JavascriptInterface"</span>, <span class="string">"SetJavaScriptEnabled"</span>, <span class="string">"AddJavascriptInterface"</span>&#125;)</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);</div><div class="line">        setSupportActionBar(toolbar);</div><div class="line"></div><div class="line">        contentWebView = (WebView) findViewById(R.id.webview);</div><div class="line">        <span class="comment">// 加载Assets下的Html</span></div><div class="line">        contentWebView.loadUrl(<span class="string">"file:///android_asset/html/test.html"</span>);</div><div class="line">        <span class="comment">// 启用Javascript</span></div><div class="line">        contentWebView.getSettings().setJavaScriptEnabled(<span class="keyword">true</span>);</div><div class="line">        contentWebView.addJavascriptInterface(<span class="keyword">this</span>, <span class="string">"android"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@JavascriptInterface</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">androidFunction</span><span class="params">()</span> </span>&#123;</div><div class="line">        Snackbar.make(contentWebView, <span class="string">"Android的方法被调用"</span>, Snackbar.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@JavascriptInterface</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">androidFunction</span><span class="params">(String text)</span> </span>&#123;</div><div class="line">        Snackbar.make(contentWebView, <span class="string">"Android的方法被调用并收到参数 : \n"</span> + text, Snackbar.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</div><div class="line">        getMenuInflater().inflate(R.menu.menu_main, menu);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> id = item.getItemId();</div><div class="line">        <span class="keyword">if</span> (id == R.id.action_js_function1) &#123;</div><div class="line">            <span class="comment">// 调用JS的jsFunction方法</span></div><div class="line">            contentWebView.loadUrl(<span class="string">"javascript:jsFunction()"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (id == R.id.action_js_function2) &#123;</div><div class="line">            <span class="comment">// 调用JS的jsFunctionArg方法</span></div><div class="line">            contentWebView.loadUrl(<span class="string">"javascript:jsFunctionArg('[Android传递过来的数据]')"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onOptionsItemSelected(item);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/16/2016-11-16-Android播放音效/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/16/2016-11-16-Android播放音效/" itemprop="url">Android播放音效</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-16T10:56:36+08:00">
                2016-11-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/16/2016-11-16-Android播放音效/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/11/16/2016-11-16-Android播放音效/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.com/2016/11/16/2016-11-16-Android%E6%92%AD%E6%94%BE%E9%9F%B3%E6%95%88/" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/article/details/53184654" target="_blank" rel="external">CSDN</a></p>
<hr>
<p>有些时候程序需要播放几个很短的低延迟的音效来响应与用户的交互。</p>
<p>Android通过<code>SoundPool</code>将文件音频缓存加载到内存中，然后在响应用户操作的时候快速地播放。<br>Android框架低通了SoundPool来解码小音频文件，并在内存中操作它们来进行音频快速和重复的播放。SoundPool还有一些其他特性，比如可以在运行时控制音量和播放速度。</p>
<p>播放音效也很简单，总共分5步</p>
<h1 id="准备音频文件"><a href="#准备音频文件" class="headerlink" title="准备音频文件"></a>准备音频文件</h1><p>将音频文件放置在assets目录下</p>
<p><img src="http://img.blog.csdn.net/20161116111440550" alt="准备音频文件"></p>
<h1 id="初始化SoundPool"><a href="#初始化SoundPool" class="headerlink" title="初始化SoundPool"></a>初始化SoundPool</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SoundPool mSoundPool = <span class="keyword">new</span> SoundPool(<span class="number">1</span>, AudioManager.STREAM_MUSIC, <span class="number">0</span>);</div></pre></td></tr></table></figure>
<h1 id="加载音频文件"><a href="#加载音频文件" class="headerlink" title="加载音频文件"></a>加载音频文件</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> streamID = mSoundPool.load(getApplicationContext().getAssets().openFd(<span class="string">"beep/beep1.mp3"</span>), <span class="number">1</span>);</div></pre></td></tr></table></figure>
<h1 id="播放音频文件"><a href="#播放音频文件" class="headerlink" title="播放音频文件"></a>播放音频文件</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mSoundPool.play(streamID, <span class="number">10</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1.0f</span>);</div></pre></td></tr></table></figure>
<h1 id="释放SoundPool"><a href="#释放SoundPool" class="headerlink" title="释放SoundPool"></a>释放SoundPool</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mSoundPool.release();</div><div class="line">mSoundPool = <span class="keyword">null</span>;</div></pre></td></tr></table></figure>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.kongqw.kqwplaybeepdemo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.media.AudioManager;</div><div class="line"><span class="keyword">import</span> android.media.SoundPool;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MainActivity"</span>;</div><div class="line">    <span class="keyword">private</span> SoundPool mSoundPool;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> streamID;</div><div class="line">    <span class="keyword">private</span> HashMap&lt;String, Integer&gt; mSoundMap;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        findViewById(R.id.button_beep1).setOnClickListener(<span class="keyword">this</span>);</div><div class="line">        findViewById(R.id.button_beep2).setOnClickListener(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">        mSoundPool = <span class="keyword">new</span> SoundPool(<span class="number">1</span>, AudioManager.STREAM_MUSIC, <span class="number">0</span>);</div><div class="line">        mSoundMap = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            streamID = mSoundPool.load(getApplicationContext().getAssets().openFd(<span class="string">"beep/beep1.mp3"</span>), <span class="number">1</span>);</div><div class="line">            mSoundMap.put(<span class="string">"beep1.mp3"</span>, streamID);</div><div class="line">            streamID = mSoundPool.load(getApplicationContext().getAssets().openFd(<span class="string">"beep/beep2.mp3"</span>), <span class="number">1</span>);</div><div class="line">            mSoundMap.put(<span class="string">"beep2.mp3"</span>, streamID);</div><div class="line">            Log.i(TAG, <span class="string">"onCreate: streamID = "</span> + streamID);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">        mSoundPool.release();</div><div class="line">        mSoundPool = <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (view.getId()) &#123;</div><div class="line">            <span class="keyword">case</span> R.id.button_beep1:</div><div class="line">                streamID = mSoundMap.get(<span class="string">"beep1.mp3"</span>);</div><div class="line">                mSoundPool.play(streamID, <span class="number">10</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1.0f</span>);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> R.id.button_beep2:</div><div class="line">                streamID = mSoundMap.get(<span class="string">"beep2.mp3"</span>);</div><div class="line">                mSoundPool.play(streamID, <span class="number">10</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1.0f</span>);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/14/2016-11-14-App启动优化最佳实践/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/14/2016-11-14-App启动优化最佳实践/" itemprop="url">App启动优化最佳实践</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-14T17:43:17+08:00">
                2016-11-14
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/14/2016-11-14-App启动优化最佳实践/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/11/14/2016-11-14-App启动优化最佳实践/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.com/2016/11/14/2016-11-14-App%E5%90%AF%E5%8A%A8%E4%BC%98%E5%8C%96%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/article/details/53162188" target="_blank" rel="external">CSDN</a></p>
<hr>
<blockquote>
<p>看了医生写的文章<a href="http://mp.weixin.qq.com/s?__biz=MzAxNzMxNzk5OQ==&amp;mid=2649484847&amp;idx=1&amp;sn=39ebb7b2444bee53224246d8f26dce36&amp;chksm=83f8272fb48fae392300dbe011f624a0981286b66c9a7b9508e49b95eee80b2ea86568366564&amp;scene=4#wechat_redirect" target="_blank" rel="external">一触即发——App启动优化最佳实践</a>，收获是有的。</p>
</blockquote>
<p>做Android开发，一定写给过启动页，在这里做一些初始化的操作，还有就是显示推广信息。</p>
<p>很普通的一个页面，以前测试也给我提出过bug，应用在启动的时候，有时候有白屏/黑屏。当时能做的就是尽量较少耗时操作，上面医生的文章里也有提到，但是通过主题的方式优化这个问题之前还真是不知道的。</p>
<p>下面主要总结一下通过主题的方式优化启动页（医生还提到了在子线程初始化和使用IntentService初始化，都是属于异步初始化，还有延迟初始化，就不说了）</p>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20161114183258615" alt="优化前"></p>
<p><img src="http://img.blog.csdn.net/20161114183329516" alt="优化后"></p>
<h1 id="通过修改主题优化启动时白屏-黑屏"><a href="#通过修改主题优化启动时白屏-黑屏" class="headerlink" title="通过修改主题优化启动时白屏/黑屏"></a>通过修改主题优化启动时白屏/黑屏</h1><blockquote>
<p>原理请移步到医生的文章，我就不复述了，之所以会看到白屏或者黑屏，是和我们的主题有关系的，因为系统默认使用的主题，背景色就是白色/黑色。那么我们自定义一个主题，让默认的样式就是我们想要的，就优化了白屏/黑屏的问题。</p>
</blockquote>
<p>首先，我们自定义一个主题,设置一个我们想要的背景</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 启动页主题 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"SplashTheme"</span> <span class="attr">parent</span>=<span class="string">"@style/Theme.AppCompat.Light.NoActionBar"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="xml">	<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowBackground"</span>&gt;</span>@drawable/start_window<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<p>自定义背景<code>start_window.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">layer-list</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:opacity</span>=<span class="string">"opaque"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- The background color, preferably the same as your normal theme --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@android:color/holo_blue_dark"</span> /&gt;</span></div><div class="line">    <span class="comment">&lt;!-- Your product logo - 144dp color version of your app icon --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">bitmap</span></span></div><div class="line"><span class="tag">            <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">"@mipmap/ic_launcher"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></div></pre></td></tr></table></figure>
<p>最后，在清单文件设置启动页使用我们自定义的主题</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">package</span>=<span class="string">"com.bitmain.launchtimedemo"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">application</span></span></div><div class="line"><span class="tag">        <span class="attr">android:allowBackup</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:supportsRtl</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 启动页 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">activity</span></span></div><div class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">".SplashActivity"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:theme</span>=<span class="string">"@style/SplashTheme"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span> /&gt;</span></div><div class="line"></div><div class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 主页 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".MainActivity"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div></pre></td></tr></table></figure>
<p>到此大功告成，为了体现出效果，在启动页加载之前，我们模拟一个白屏/黑屏的延时操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SplashActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        <span class="comment">// 模拟系统初始化  白屏、黑屏</span></div><div class="line">        SystemClock.sleep(<span class="number">1000</span>);</div><div class="line">        setContentView(R.layout.activity_splash);</div><div class="line">		<span class="comment">// 启动后 停留2秒进入到主页面</span></div><div class="line">        <span class="keyword">new</span> Handler().postDelayed(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                Intent intent = <span class="keyword">new</span> Intent(SplashActivity.<span class="keyword">this</span>, MainActivity.class);</div><div class="line">                startActivity(intent);</div><div class="line">                finish();</div><div class="line">            &#125;</div><div class="line">        &#125;, <span class="number">2000</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/01/2016-11-01-Android串口通信/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/01/2016-11-01-Android串口通信/" itemprop="url">Android串口通信</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-01T15:40:53+08:00">
                2016-11-01
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/01/2016-11-01-Android串口通信/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/11/01/2016-11-01-Android串口通信/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.com/2016/11/01/2016-11-01-Android%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1/" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/article/details/52996548" target="_blank" rel="external">CSDN</a></p>
<hr>
<blockquote>
<p>串口通信偏向嵌入式一点，是Android设备通过串口与其他设备进行通信的一种方式，本文介绍的Android纯串口的通信，并不是手机上的USB串口通信。</p>
</blockquote>
<p><img src="http://img.blog.csdn.net/20161101153352899" alt="P1"></p>
<blockquote>
<p>手机上是没有这个串口的哦。</p>
</blockquote>
<p>关于串口通信，Google已经给出了源码，地址在GitHub <a href="https://github.com/cepr/android-serialport-api" target="_blank" rel="external">android-serialport-api</a></p>
<p>四年前的代码，还是Eclipse工程，本文主要介绍如何在Android Studio中使用。</p>
<p>源码地址在 <a href="https://github.com/kongqw/KqwSerialPortDemo" target="_blank" rel="external">KqwSerialPortDemo</a> </p>
<h1 id="集成"><a href="#集成" class="headerlink" title="集成"></a>集成</h1><p>Java层的代码，Google已经给封装在 <a href="https://github.com/kongqw/KqwSerialPortDemo/blob/master/SerialPortLibrary/src/main/java/qingwei/kong/serialportlibrary/SerialPort.java" target="_blank" rel="external">SerialPort.java</a></p>
<h2 id="导入-so"><a href="#导入-so" class="headerlink" title="导入.so"></a>导入.so</h2><p>没有什么难度了，将so导入到项目</p>
<p><img src="http://img.blog.csdn.net/20161101153618510" alt="P1"></p>
<h2 id="导入jni文件"><a href="#导入jni文件" class="headerlink" title="导入jni文件"></a>导入jni文件</h2><p>在<code>main</code>目录下创建<code>cpp</code>文件夹，并将jni源文件和CMakeLists.txt导入</p>
<p><img src="http://img.blog.csdn.net/20161101153635136" alt="P2"></p>
<p>在<code>build.gradle</code>配置<code>cmake</code>路径。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    ……</div><div class="line">    externalNativeBuild &#123;</div><div class="line">        cmake &#123;</div><div class="line">            path <span class="string">"src/main/cpp/CMakeLists.txt"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">	……</div><div class="line">｝</div></pre></td></tr></table></figure>
<h2 id="修改jni源文件"><a href="#修改jni源文件" class="headerlink" title="修改jni源文件"></a>修改jni源文件</h2><p>这里要注意jni文件函数名的写法：<code>Java_包名_类名_方法名</code></p>
<p><img src="http://img.blog.csdn.net/20161101153707996" alt="P3"></p>
<p>在将源码里的jni导入过来的时候，包名是源码Demo的包名，我们在自己的工程里要换成自己的包名、类名，源文件和头文件都要记得改。</p>
<h2 id="修改CMakeLists-txt与SerialPort-java"><a href="#修改CMakeLists-txt与SerialPort-java" class="headerlink" title="修改CMakeLists.txt与SerialPort.java"></a>修改CMakeLists.txt与SerialPort.java</h2><p>CMakeLists.txt</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">cmake_minimum_required(VERSION <span class="number">3.4</span>.1)</div><div class="line"></div><div class="line">add_library(SerialPort SHARED</div><div class="line">            SerialPort.c)</div><div class="line"></div><div class="line"># Include libraries needed for libserial_port lib</div><div class="line">target_link_libraries(SerialPort</div><div class="line">                      android</div><div class="line">                      log)</div></pre></td></tr></table></figure>
<p>SerialPort.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> &#123;</div><div class="line">    System.loadLibrary(<span class="string">"SerialPort"</span>);</div><div class="line">    System.loadLibrary(<span class="string">"serial_port"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="基类"><a href="#基类" class="headerlink" title="基类"></a>基类</h2><p>需要使用串口通信的类继承 <a href="https://github.com/kongqw/KqwSerialPortDemo/blob/master/app/src/main/java/qingwei/kong/kqwserialportdemo/SerialPortActivity.java" target="_blank" rel="external">SerialPortActivity.java</a></p>
<h2 id="打开串口"><a href="#打开串口" class="headerlink" title="打开串口"></a>打开串口</h2><ul>
<li>端口号：/dev/ttyS2</li>
<li>比特率：115200</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> SerialPort <span class="title">getSerialPort</span><span class="params">()</span> <span class="keyword">throws</span> SecurityException, IOException, InvalidParameterException </span>&#123;</div><div class="line">    <span class="keyword">if</span> (mSerialPort == <span class="keyword">null</span>) &#123;</div><div class="line">        mSerialPort = <span class="keyword">new</span> SerialPort(<span class="keyword">new</span> File(<span class="string">"/dev/ttyS2"</span>), <span class="number">115200</span>, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> mSerialPort;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="关闭串口"><a href="#关闭串口" class="headerlink" title="关闭串口"></a>关闭串口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeSerialPort</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (mSerialPort != <span class="keyword">null</span>) &#123;</div><div class="line">        mSerialPort.close();</div><div class="line">        mSerialPort = <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="发送数据"><a href="#发送数据" class="headerlink" title="发送数据"></a>发送数据</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Message message = Message.obtain();</div><div class="line">message.obj = text.getBytes();</div><div class="line">sendingHandler.sendMessage(message);</div></pre></td></tr></table></figure>
<h2 id="接收消息"><a href="#接收消息" class="headerlink" title="接收消息"></a>接收消息</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDataReceived</span><span class="params">(<span class="keyword">final</span> <span class="keyword">byte</span>[] buffer, <span class="keyword">final</span> <span class="keyword">int</span> size)</span> </span>&#123;</div><div class="line">    runOnUiThread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            Toast.makeText(mApplication, <span class="string">"收到消息："</span> + <span class="keyword">new</span> String(buffer) + <span class="string">"  size = "</span> + size, Toast.LENGTH_SHORT).show();</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="下载并安装NDK与CMake"><a href="#下载并安装NDK与CMake" class="headerlink" title="下载并安装NDK与CMake"></a>下载并安装NDK与CMake</h1><p><img src="http://img.blog.csdn.net/20161104110635516" alt="下载并安装NDK与CMake"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/09/2016-09-09-OpenCV-JavaCV实现人脸识别/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/09/2016-09-09-OpenCV-JavaCV实现人脸识别/" itemprop="url">OpenCV+JavaCV实现人脸识别</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-09T16:29:53+08:00">
                2016-09-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/开源/" itemprop="url" rel="index">
                    <span itemprop="name">开源</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/09/09/2016-09-09-OpenCV-JavaCV实现人脸识别/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/09/09/2016-09-09-OpenCV-JavaCV实现人脸识别/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.com/2016/09/09/2016-09-09-OpenCV-JavaCV%E5%AE%9E%E7%8E%B0%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/article/details/52488447" target="_blank" rel="external">CSDN</a></p>
<hr>
<p>OpenCV主要实现人脸检测功能</p>
<p>JavaCV主要实现人脸对比功能</p>
<p>具体的就不啰嗦了，本来最近很忙，主要是因为好多人私信我要 <a href="http://kongqw.com/2016/07/06/2016-07-06-Android%E4%BD%BF%E7%94%A8OpenCV%E5%AE%9E%E7%8E%B0%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/" target="_blank" rel="external">Android使用OpenCV实现「人脸检测」和「人脸识别」</a> 的Demo，今天特意抽出时间写了一下。</p>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20160909162919759" alt="效果图"></p>
<p><img src="http://img.blog.csdn.net/20160909162931572" alt="效果图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="https://github.com/kongqw/KqwFaceDetectionDemo" target="_blank" rel="external">KqwFaceDetectionDemo</a></p>
<p>感觉有用的话，就给个<code>star</code>吧，谢谢！！</p>
<h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><p>最后啰嗦一点，如果你的程序是跑在手机、pad等设备上，一般没有什么问题。<br>但是如果你是在自己的开发板上跑，可能会有一些小插曲。</p>
<p>比如我司的机器人是定制的Android板子，对系统做了裁剪，很多摄像头的方法可能就用不了</p>
<p>例如这样一个错误</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">AndroidRuntime: java.lang.RuntimeException: setParameters failed</div></pre></td></tr></table></figure>
<p>当打开程序的时候，OpenCV会提示，没有找到可用摄像头或者摄像头被锁住（大概这个意思，我就不截图了），一种可能是设备真的没有接摄像头，也有可能是摄像头定制过，导致某些方法用不了，比如上面的错误就是我遇到的其中一个。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/01/2016-09-01-Android自定义摇杆/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/01/2016-09-01-Android自定义摇杆/" itemprop="url">Android自定义摇杆</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-01T17:37:11+08:00">
                2016-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/开源/" itemprop="url" rel="index">
                    <span itemprop="name">开源</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/09/01/2016-09-01-Android自定义摇杆/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/09/01/2016-09-01-Android自定义摇杆/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.com/2016/09/01/2016-09-01-Android%E8%87%AA%E5%AE%9A%E4%B9%89%E6%91%87%E6%9D%86/" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/article/details/52402529" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20160901182847783" alt="效果图"></p>
<p><img src="http://img.blog.csdn.net/20160901182902455" alt="效果图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="https://github.com/kongqw/KqwRockerDemo" target="_blank" rel="external">KqwRockerDemo</a></p>
<p>喜欢就给个<code>star</code>，谢谢！</p>
<h1 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h1><ul>
<li>支持自适应大小</li>
<li>支持2个方向、4个方向、8个方向的摇动监听</li>
<li>支持摇动角度获取</li>
<li>可选回调模式</li>
<li>支持可摇动区域自定义</li>
<li>支持摇杆自定义</li>
<li>支持设置图片、色值、Shape图形</li>
</ul>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;kong.qingwei.rockerlibrary.RockerView</div><div class="line">    android:id=<span class="string">"@+id/rockerView_center"</span></div><div class="line">    android:layout_width=<span class="string">"100dp"</span></div><div class="line">    android:layout_height=<span class="string">"100dp"</span></div><div class="line">    android:layout_centerHorizontal=<span class="string">"true"</span></div><div class="line">    kongqw:areaBackground=<span class="string">"#FF333333"</span></div><div class="line">    kongqw:rockerBackground=<span class="string">"#FF987654"</span></div><div class="line">    kongqw:rockerRadius=<span class="string">"15dp"</span> /&gt;</div></pre></td></tr></table></figure>
<h1 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h1><table>
<thead>
<tr>
<th>参数</th>
<th>是否必须</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>areaBackground</td>
<td>可选</td>
<td>可摇动区域的背景</td>
</tr>
<tr>
<td>rockerBackground</td>
<td>可选</td>
<td>摇杆的背景</td>
</tr>
<tr>
<td>rockerRadius</td>
<td>可选</td>
<td>摇杆半径</td>
</tr>
</tbody>
</table>
<h1 id="设置回调方式"><a href="#设置回调方式" class="headerlink" title="设置回调方式"></a>设置回调方式</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">setCallBackMode(CallBackMode mode)</div></pre></td></tr></table></figure>
<p>参数</p>
<table>
<thead>
<tr>
<th>回调方式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>CALL_BACK_MODE_MOVE</td>
<td>有移动就立刻回调</td>
</tr>
<tr>
<td>CALL_BACK_MODE_STATE_CHANGE</td>
<td>状态有变化的时候回调</td>
</tr>
</tbody>
</table>
<h1 id="监听摇动角度"><a href="#监听摇动角度" class="headerlink" title="监听摇动角度"></a>监听摇动角度</h1><p>返回角度的取值范围：[0°,360°)</p>
<p><img src="http://img.blog.csdn.net/20160901183045786" alt="取值范围"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">setOnAngleChangeListener(OnAngleChangeListener listener)</div></pre></td></tr></table></figure>
<h1 id="监听摇动方向"><a href="#监听摇动方向" class="headerlink" title="监听摇动方向"></a>监听摇动方向</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">setOnShakeListener(DirectionMode directionMode, OnShakeListener listener)</div></pre></td></tr></table></figure>
<p>支持监听的方向</p>
<table>
<thead>
<tr>
<th>方向</th>
<th>图</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>DIRECTION_2_HORIZONTAL</td>
<td><img src="http://img.blog.csdn.net/20160901183144896" alt="左右两个方向"></td>
<td>横向 左右两个方向</td>
</tr>
<tr>
<td>DIRECTION_2_VERTICAL</td>
<td><img src="http://img.blog.csdn.net/20160901183332084" alt="上下两个方向"></td>
<td>纵向 上下两个方向</td>
</tr>
<tr>
<td>DIRECTION_4_ROTATE_0</td>
<td><img src="http://img.blog.csdn.net/20160901183347055" alt="四个方向"></td>
<td>四个方向</td>
</tr>
<tr>
<td>DIRECTION_4_ROTATE_45</td>
<td><img src="http://img.blog.csdn.net/20160901183404461" alt="四个方向 旋转45°"></td>
<td>四个方向 旋转45°</td>
</tr>
<tr>
<td>DIRECTION_8</td>
<td><img src="http://img.blog.csdn.net/20160901183419477" alt="八个方向"></td>
<td>八个方向</td>
</tr>
</tbody>
</table>
<p>方向描述</p>
<table>
<thead>
<tr>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>DIRECTION_LEFT</td>
<td>左</td>
</tr>
<tr>
<td>DIRECTION_RIGHT</td>
<td>右</td>
</tr>
<tr>
<td>DIRECTION_UP</td>
<td>上</td>
</tr>
<tr>
<td>DIRECTION_DOWN</td>
<td>下</td>
</tr>
<tr>
<td>DIRECTION_UP_LEFT</td>
<td>左上</td>
</tr>
<tr>
<td>DIRECTION_UP_RIGHT</td>
<td>右上</td>
</tr>
<tr>
<td>DIRECTION_DOWN_LEFT</td>
<td>左下</td>
</tr>
<tr>
<td>DIRECTION_DOWN_RIGHT</td>
<td>右下</td>
</tr>
<tr>
<td>DIRECTION_CENTER</td>
<td>中间</td>
</tr>
</tbody>
</table>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">RockerView rockerViewLeft = (RockerView) findViewById(R.id.rockerView_left);</div><div class="line"><span class="keyword">if</span> (rockerViewLeft != <span class="keyword">null</span>) &#123;</div><div class="line">    rockerViewLeft.setCallBackMode(RockerView.CallBackMode.CALL_BACK_MODE_STATE_CHANGE);</div><div class="line">    rockerViewLeft.setOnShakeListener(RockerView.DirectionMode.DIRECTION_8, <span class="keyword">new</span> RockerView.OnShakeListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</div><div class="line">            mLogLeft.setText(<span class="keyword">null</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">direction</span><span class="params">(RockerView.Direction direction)</span> </span>&#123;</div><div class="line">            mLogLeft.setText(<span class="string">"摇动方向 : "</span> + getDirection(direction));</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFinish</span><span class="params">()</span> </span>&#123;</div><div class="line">            mLogLeft.setText(<span class="keyword">null</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">RockerView rockerViewRight = (RockerView) findViewById(R.id.rockerView_right);</div><div class="line"><span class="keyword">if</span> (rockerViewRight != <span class="keyword">null</span>) &#123;</div><div class="line">    rockerViewRight.setOnAngleChangeListener(<span class="keyword">new</span> RockerView.OnAngleChangeListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</div><div class="line">            mLogRight.setText(<span class="keyword">null</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">angle</span><span class="params">(<span class="keyword">double</span> angle)</span> </span>&#123;</div><div class="line">            mLogRight.setText(<span class="string">"摇动角度 : "</span> + angle);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFinish</span><span class="params">()</span> </span>&#123;</div><div class="line">            mLogRight.setText(<span class="keyword">null</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/29/2016-08-29-Android输出正弦波音频信号-左右声道对称/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/29/2016-08-29-Android输出正弦波音频信号-左右声道对称/" itemprop="url">Android输出正弦波音频信号(左右声道对称)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-29T15:01:34+08:00">
                2016-08-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/08/29/2016-08-29-Android输出正弦波音频信号-左右声道对称/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/08/29/2016-08-29-Android输出正弦波音频信号-左右声道对称/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.com/2016/08/29/2016-08-29-Android%E8%BE%93%E5%87%BA%E6%AD%A3%E5%BC%A6%E6%B3%A2%E9%9F%B3%E9%A2%91%E4%BF%A1%E5%8F%B7-%E5%B7%A6%E5%8F%B3%E5%A3%B0%E9%81%93%E5%AF%B9%E7%A7%B0/" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/article/details/52353727" target="_blank" rel="external">CSDN</a></p>
<hr>
<p>需求：左右声道分别输出不同的音频数据，波形要是一个正弦波，左右声道还要对称！<br>对硬件不是很了解，说是要通过音波避障。</p>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20160829154617837" alt="效果图"></p>
<p>之前已经介绍了如何在左右声道输出不同的音频数据。<br>那么这里主要介绍如何模拟出波形是正弦波的音频数据。</p>
<h1 id="模拟正弦波"><a href="#模拟正弦波" class="headerlink" title="模拟正弦波"></a>模拟正弦波</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 模拟正弦波音频数据</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> isLeft 左右声道</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span> 音频数据</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">short</span>[] initData(<span class="keyword">boolean</span> isLeft) &#123;</div><div class="line">    <span class="keyword">double</span> phase = <span class="number">0.0</span>;</div><div class="line">    <span class="keyword">int</span> amp = <span class="number">10000</span>;</div><div class="line">    <span class="keyword">short</span>[] data = <span class="keyword">new</span> <span class="keyword">short</span>[bufferSize];</div><div class="line"></div><div class="line">    <span class="keyword">double</span> phaseIncrement = (<span class="number">2</span> * Math.PI * mFrequency) / mSampleRateInHz;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bufferSize; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (isLeft) &#123;</div><div class="line">            data[i] = (<span class="keyword">short</span>) (amp * Math.sin(phase));</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            data[i] = (<span class="keyword">short</span>) (-amp * Math.sin(phase));</div><div class="line">        &#125;</div><div class="line">        phase += phaseIncrement;</div><div class="line">        Log.i(TAG, <span class="string">"initData: isLeft = "</span> + isLeft + <span class="string">"  buffer["</span> + i + <span class="string">"] = "</span> + data[i]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> data;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>主要参数</p>
<ul>
<li>mFrequency：频率</li>
<li>mSampleRateInHz：采样率</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 单声道</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> mChannelConfig = AudioFormat.CHANNEL_OUT_MONO;</div><div class="line"><span class="comment">// 频率</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> mFrequency = <span class="number">19000</span>;</div><div class="line"><span class="comment">// 采样率</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> mSampleRateInHz = <span class="number">44100</span>;</div></pre></td></tr></table></figure>
<h1 id="播放音频的线程封装"><a href="#播放音频的线程封装" class="headerlink" title="播放音频的线程封装"></a>播放音频的线程封装</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> kong.qingwei.myapplication;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.annotation.TargetApi;</div><div class="line"><span class="keyword">import</span> android.media.AudioFormat;</div><div class="line"><span class="keyword">import</span> android.media.AudioManager;</div><div class="line"><span class="keyword">import</span> android.media.AudioTrack;</div><div class="line"><span class="keyword">import</span> android.os.Build;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Created by kqw on 2016/8/29.</span></div><div class="line"><span class="comment"> * 播放音乐的线程</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChannelThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"ChannelThread"</span>;</div><div class="line">    <span class="keyword">private</span> AudioTrack mAudioTrack;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">short</span>[] mData;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 构造方法</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> channelConfig  声道</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> sampleRateInHz 采样率</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> data           音频数据</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> bufferSize     缓存大小</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> isLeft         左右声道</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@TargetApi</span>(Build.VERSION_CODES.LOLLIPOP)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChannelThread</span><span class="params">(<span class="keyword">int</span> channelConfig, <span class="keyword">int</span> sampleRateInHz, <span class="keyword">short</span>[] data, <span class="keyword">int</span> bufferSize, <span class="keyword">boolean</span> isLeft)</span> </span>&#123;</div><div class="line">        mData = data;</div><div class="line"></div><div class="line">        mAudioTrack = <span class="keyword">new</span> AudioTrack(</div><div class="line">                AudioManager.STREAM_MUSIC,</div><div class="line">                sampleRateInHz,</div><div class="line">                channelConfig,</div><div class="line">                AudioFormat.ENCODING_PCM_16BIT,</div><div class="line">                bufferSize,</div><div class="line">                AudioTrack.MODE_STREAM);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (isLeft) &#123;</div><div class="line">            mAudioTrack.setStereoVolume(AudioTrack.getMaxVolume(), <span class="number">0</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            mAudioTrack.setStereoVolume(<span class="number">0</span>, AudioTrack.getMaxVolume());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.run();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != mAudioTrack) &#123;</div><div class="line">                mAudioTrack.play();</div><div class="line">                <span class="keyword">while</span> (AudioTrack.PLAYSTATE_STOPPED != mAudioTrack.getPlayState()) &#123;</div><div class="line">                    mAudioTrack.write(mData, <span class="number">0</span>, mData.length);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            Log.i(TAG, <span class="string">"run: End"</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 释放AudioTrack</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">releaseAudioTrack</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mAudioTrack) &#123;</div><div class="line">            mAudioTrack.stop();</div><div class="line">            mAudioTrack.release();</div><div class="line">            mAudioTrack = <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="播放"><a href="#播放" class="headerlink" title="播放"></a>播放</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mLeftChannelThread = <span class="keyword">new</span> ChannelThread(mChannelConfig, mSampleRateInHz, mDataLeft, bufferSize, <span class="keyword">true</span>);</div><div class="line">mRightChannelThread = <span class="keyword">new</span> ChannelThread(mChannelConfig, mSampleRateInHz, mDataRight, bufferSize, <span class="keyword">false</span>);</div><div class="line"></div><div class="line">mLeftChannelThread.start();</div><div class="line">mRightChannelThread.start();</div></pre></td></tr></table></figure>
<h1 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (<span class="keyword">null</span> != mLeftChannelThread) &#123;</div><div class="line">    mLeftChannelThread.releaseAudioTrack();</div><div class="line">    mLeftChannelThread = <span class="keyword">null</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (<span class="keyword">null</span> != mRightChannelThread) &#123;</div><div class="line">    mRightChannelThread.releaseAudioTrack();</div><div class="line">    mRightChannelThread = <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="不足"><a href="#不足" class="headerlink" title="不足"></a>不足</h1><p>这里介绍的是在程序中模拟出一个波形满足正弦波的音频数据，还有一种方式，可以事先准备好一个这样的音频文件，直接播放就可以了。</p>
<p>在程序中模拟音频数据有一个缺点，就是不能保证两个线程完完全全的同步，即便是同时开启两个线程也有一先一后，在频率很高的时候，难免会有一点误差！像下面这样：</p>
<p><img src="http://img.blog.csdn.net/20160829154737304" alt="误差图"></p>
<p>另外，这个波形和硬件有很大关系，越是低配设备，误差可能会越大，相同的趋势，但是波动的幅度会比较大（线很粗），可能和设备本身的噪音有关系。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/26/2016-08-26-Android左右声道的控制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/26/2016-08-26-Android左右声道的控制/" itemprop="url">Android左右声道的控制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-26T15:36:50+08:00">
                2016-08-26
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/08/26/2016-08-26-Android左右声道的控制/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/08/26/2016-08-26-Android左右声道的控制/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20160826164630772" alt="效果图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="https://github.com/kongqw/AndroidSoundManagerDemo" target="_blank" rel="external">AndroidSoundManagerDemo</a></p>
<hr>
<p>我这里主要是用到了<a href="https://developer.android.com/reference/android/media/AudioTrack.html" target="_blank" rel="external">AudioTrack</a>实现的左右声道的控制，手机一般都只有两个声道，即左声道和右声道，我们在输出的时候可以选择单声道，也可以选择双声道（立体声）。</p>
<p>查看了<code>AudioTrack</code>的API，提供了<code>play()</code>、<code>pause()</code>、<code>stop()</code>、<code>write()</code>等一系列的方法。<br>通过<code>write()</code>方法，可以实现将音频数据发送出去（播放出来）。</p>
<h1 id="AudioTrack对象的构造"><a href="#AudioTrack对象的构造" class="headerlink" title="AudioTrack对象的构造"></a>AudioTrack对象的构造</h1><p>有三个构造方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">AudioTrack (<span class="keyword">int</span> streamType, <span class="keyword">int</span> sampleRateInHz, <span class="keyword">int</span> channelConfig, <span class="keyword">int</span> audioFormat, <span class="keyword">int</span> bufferSizeInBytes, <span class="keyword">int</span> mode)</div><div class="line">AudioTrack (<span class="keyword">int</span> streamType, <span class="keyword">int</span> sampleRateInHz, <span class="keyword">int</span> channelConfig, <span class="keyword">int</span> audioFormat, <span class="keyword">int</span> bufferSizeInBytes, <span class="keyword">int</span> mode, <span class="keyword">int</span> sessionId)</div><div class="line">AudioTrack (AudioAttributes attributes, AudioFormat format, <span class="keyword">int</span> bufferSizeInBytes, <span class="keyword">int</span> mode, <span class="keyword">int</span> sessionId)</div></pre></td></tr></table></figure>
<p>主要参数有如下几个</p>
<ul>
<li><p>streamType：以什么形式播放</p>
<ul>
<li>STREAM_VOICE_CALL</li>
<li>STREAM_SYSTEM</li>
<li>STREAM_RING</li>
<li>STREAM_MUSIC</li>
<li>STREAM_ALARM</li>
<li>STREAM_NOTIFICATION</li>
</ul>
</li>
<li><p>sampleRateInHz：采样率</p>
</li>
<li><p>channelConfig：声道</p>
<ul>
<li>AudioFormat.CHANNEL_OUT_MONO：输出单声道音频数据</li>
<li>AudioFormat.CHANNEL_OUT_STEREO：输出双声道音频数据（立体声）</li>
</ul>
</li>
<li><p>audioFormat：音频数据格式</p>
</li>
<li><p>mode：缓冲模式</p>
<ul>
<li>MODE_STATIC：一次性将音频载入以后再播放</li>
<li>MODE_STREAM：以流的形式，加载一点就播放一点</li>
</ul>
</li>
</ul>
<p>把channelConfig的相关参数都看了一遍，没发现有可以指定向某声道发送数据的，只能通过<code>AudioFormat.CHANNEL_OUT_MONO</code>和<code>AudioFormat.CHANNEL_OUT_STEREO</code>选择是输出单声道的音频数据还是双声道的音频数据。</p>
<h1 id="左右声道控制"><a href="#左右声道控制" class="headerlink" title="左右声道控制"></a>左右声道控制</h1><p>构造的时候不能选择指定声道输出音频，但是有这样一个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">setStereoVolume(<span class="keyword">float</span> leftGain, <span class="keyword">float</span> rightGain)</div></pre></td></tr></table></figure>
<p>可以通过把某一个声道的音量设置到最小，达到只向某个声道输出音频的效果。<br>我自己也有点”呵呵“，但是也没有发现还有别的方法可以实现这样的效果。</p>
<blockquote>
<p>这个方法还有一点小问题，在个别手机上，即使将某个声道的声音设置到了最小，也还是会有一点声音，这个我也还没有搞清楚为什么，个人猜测可能和手机硬件有关系。</p>
</blockquote>
<h1 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h1><p>我这里的缓冲模式使用的<code>MODE_STREAM</code>的形式，以流的形式播放，因为这个逻辑要稍微复杂一点，尤其是暂停以后再继续播放的位置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> kong.qingwei.androidsoundmanagerdemo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Activity;</div><div class="line"><span class="keyword">import</span> android.media.AudioFormat;</div><div class="line"><span class="keyword">import</span> android.media.AudioManager;</div><div class="line"><span class="keyword">import</span> android.media.AudioTrack;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Created by kqw on 2016/8/26.</span></div><div class="line"><span class="comment"> * 播放音乐的线程</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PlayThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 采样率</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mSampleRateInHz = <span class="number">16000</span>;</div><div class="line">    <span class="comment">// 单声道</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mChannelConfig = AudioFormat.CHANNEL_OUT_MONO;</div><div class="line">    <span class="comment">// 双声道（立体声）</span></div><div class="line">    <span class="comment">// private int mChannelConfig = AudioFormat.CHANNEL_OUT_STEREO;</span></div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"PlayThread"</span>;</div><div class="line">    <span class="keyword">private</span> Activity mActivity;</div><div class="line">    <span class="keyword">private</span> AudioTrack mAudioTrack;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] data;</div><div class="line">    <span class="keyword">private</span> String mFileName;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PlayThread</span><span class="params">(Activity activity, String fileName)</span> </span>&#123;</div><div class="line">        mActivity = activity;</div><div class="line">        mFileName = fileName;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> bufferSize = AudioTrack.getMinBufferSize(mSampleRateInHz, mChannelConfig, AudioFormat.ENCODING_PCM_16BIT);</div><div class="line">        mAudioTrack = <span class="keyword">new</span> AudioTrack(</div><div class="line">                AudioManager.STREAM_MUSIC,</div><div class="line">                mSampleRateInHz,</div><div class="line">                mChannelConfig,</div><div class="line">                AudioFormat.ENCODING_PCM_16BIT,</div><div class="line">                bufferSize,</div><div class="line">                AudioTrack.MODE_STREAM);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.run();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != mAudioTrack)</div><div class="line">                mAudioTrack.play();</div><div class="line"></div><div class="line">            ByteArrayOutputStream byteArrayOutputStream = <span class="keyword">new</span> ByteArrayOutputStream();</div><div class="line">            InputStream inputStream = mActivity.getResources().getAssets().open(mFileName);</div><div class="line"></div><div class="line">            <span class="comment">// 缓冲区</span></div><div class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</div><div class="line">            <span class="comment">// 播放进度</span></div><div class="line">            <span class="keyword">int</span> playIndex = <span class="number">0</span>;</div><div class="line">            <span class="comment">// 是否缓冲完成</span></div><div class="line">            <span class="keyword">boolean</span> isLoaded = <span class="keyword">false</span>;</div><div class="line">            <span class="comment">// 缓冲 + 播放</span></div><div class="line">            <span class="keyword">while</span> (<span class="keyword">null</span> != mAudioTrack &amp;&amp; AudioTrack.PLAYSTATE_STOPPED != mAudioTrack.getPlayState()) &#123;</div><div class="line">                <span class="comment">// 字符长度</span></div><div class="line">                <span class="keyword">int</span> len;</div><div class="line">                <span class="keyword">if</span> (-<span class="number">1</span> != (len = inputStream.read(buffer))) &#123;</div><div class="line">                    byteArrayOutputStream.write(buffer, <span class="number">0</span>, len);</div><div class="line">                    data = byteArrayOutputStream.toByteArray();</div><div class="line">                    Log.i(TAG, <span class="string">"run: 已缓冲 : "</span> + data.length);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="comment">// 缓冲完成</span></div><div class="line">                    isLoaded = <span class="keyword">true</span>;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (AudioTrack.PLAYSTATE_PAUSED == mAudioTrack.getPlayState()) &#123;</div><div class="line">                    <span class="comment">// TODO 已经暂停</span></div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (AudioTrack.PLAYSTATE_PLAYING == mAudioTrack.getPlayState()) &#123;</div><div class="line">                    Log.i(TAG, <span class="string">"run: 开始从 "</span> + playIndex + <span class="string">" 播放"</span>);</div><div class="line">                    playIndex += mAudioTrack.write(data, playIndex, data.length - playIndex);</div><div class="line">                    Log.i(TAG, <span class="string">"run: 播放到了 : "</span> + playIndex);</div><div class="line">                    <span class="keyword">if</span> (isLoaded &amp;&amp; playIndex == data.length) &#123;</div><div class="line">                        Log.i(TAG, <span class="string">"run: 播放完了"</span>);</div><div class="line">                        mAudioTrack.stop();</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="keyword">if</span> (playIndex &lt; <span class="number">0</span>) &#123;</div><div class="line">                        Log.i(TAG, <span class="string">"run: 播放出错"</span>);</div><div class="line">                        mAudioTrack.stop();</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            Log.i(TAG, <span class="string">"run: play end"</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 设置左右声道平衡</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> max     最大值</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> balance 当前值</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBalance</span><span class="params">(<span class="keyword">int</span> max, <span class="keyword">int</span> balance)</span> </span>&#123;</div><div class="line">        <span class="keyword">float</span> b = (<span class="keyword">float</span>) balance / (<span class="keyword">float</span>) max;</div><div class="line">        Log.i(TAG, <span class="string">"setBalance: b = "</span> + b);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mAudioTrack)</div><div class="line">            mAudioTrack.setStereoVolume(<span class="number">1</span> - b, b);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 设置左右声道是否可用</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> left  左声道</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> right 右声道</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setChannel</span><span class="params">(<span class="keyword">boolean</span> left, <span class="keyword">boolean</span> right)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mAudioTrack) &#123;</div><div class="line">            mAudioTrack.setStereoVolume(left ? <span class="number">1</span> : <span class="number">0</span>, right ? <span class="number">1</span> : <span class="number">0</span>);</div><div class="line">            mAudioTrack.play();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pause</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mAudioTrack)</div><div class="line">            mAudioTrack.pause();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mAudioTrack)</div><div class="line">            mAudioTrack.play();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopp</span><span class="params">()</span> </span>&#123;</div><div class="line">        releaseAudioTrack();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">releaseAudioTrack</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mAudioTrack) &#123;</div><div class="line">            mAudioTrack.stop();</div><div class="line">            mAudioTrack.release();</div><div class="line">            mAudioTrack = <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="从头开始播放"><a href="#从头开始播放" class="headerlink" title="从头开始播放"></a>从头开始播放</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mPlayThread = <span class="keyword">new</span> PlayThread(<span class="keyword">this</span>, <span class="string">"tts1.pcm"</span>);</div><div class="line">mPlayThread.start();</div></pre></td></tr></table></figure>
<h2 id="暂停"><a href="#暂停" class="headerlink" title="暂停"></a>暂停</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mPlayThread.pause();</div></pre></td></tr></table></figure>
<h2 id="暂停后继续播放"><a href="#暂停后继续播放" class="headerlink" title="暂停后继续播放"></a>暂停后继续播放</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mPlayThread.play();</div></pre></td></tr></table></figure>
<h2 id="停止播放"><a href="#停止播放" class="headerlink" title="停止播放"></a>停止播放</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mPlayThread.stopp();</div><div class="line">mPlayThread = <span class="keyword">null</span>;</div></pre></td></tr></table></figure>
<h2 id="左右声道控制-1"><a href="#左右声道控制-1" class="headerlink" title="左右声道控制"></a>左右声道控制</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 禁用左声道（右声道同理）</span></div><div class="line">mPlayThread.setChannel(<span class="keyword">false</span>, <span class="keyword">true</span>);</div></pre></td></tr></table></figure>
<h1 id="向左右声道单独输出不同的音频数据"><a href="#向左右声道单独输出不同的音频数据" class="headerlink" title="向左右声道单独输出不同的音频数据"></a>向左右声道单独输出不同的音频数据</h1><p>也是一个很”呵呵“的做法，但是依然还没有找到更好的方法。<br>构造两个<code>AudioTrack</code>对象，分别输出两个音频，一个禁用左声道，一个禁用右声道，达到预期效果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mChannelLeftPlayer = <span class="keyword">new</span> PlayThread(<span class="keyword">this</span>, <span class="string">"tts1.pcm"</span>);</div><div class="line">mChannelRightPlayer = <span class="keyword">new</span> PlayThread(<span class="keyword">this</span>, <span class="string">"tts2.pcm"</span>);</div><div class="line"></div><div class="line">mChannelLeftPlayer.setChannel(<span class="keyword">true</span>, <span class="keyword">false</span>);</div><div class="line">mChannelRightPlayer.setChannel(<span class="keyword">false</span>, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">mChannelLeftPlayer.start();</div><div class="line">mChannelRightPlayer.start();</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/22/2016-08-22-环信即时通讯在Android平台的部署/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/22/2016-08-22-环信即时通讯在Android平台的部署/" itemprop="url">环信即时通讯在Android平台的部署</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-22T18:36:12+08:00">
                2016-08-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IM/" itemprop="url" rel="index">
                    <span itemprop="name">IM</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/08/22/2016-08-22-环信即时通讯在Android平台的部署/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/08/22/2016-08-22-环信即时通讯在Android平台的部署/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h1><p><a href="http://www.easemob.com/" target="_blank" rel="external">环信</a></p>
<p><a href="http://www.easemob.com/download" target="_blank" rel="external">下载SDK</a></p>
<h1 id="创建一个工程"><a href="#创建一个工程" class="headerlink" title="创建一个工程"></a>创建一个工程</h1><p>如果想要封装性好一点，也可以在工程里再创建一个环信的Library，然后将SDK里的<code>jar</code>和<code>.so</code>，都导入到工程</p>
<p><img src="http://img.blog.csdn.net/20160822185314139" alt="导入SDK"></p>
<h1 id="清单文件"><a href="#清单文件" class="headerlink" title="清单文件"></a>清单文件</h1><p>下面是环信Library库里面的清单文件，包含了权限的设置、APPKEY的设置和服务的声明等。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">&lt;manifest xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="keyword">package</span>=<span class="string">"……"</span>&gt;</div><div class="line"></div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.VIBRATE"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.INTERNET"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.RECORD_AUDIO"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.CAMERA"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_NETWORK_STATE"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.MOUNT_UNMOUNT_FILESYSTEMS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_FINE_LOCATION"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.GET_TASKS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_WIFI_STATE"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.CHANGE_WIFI_STATE"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.WAKE_LOCK"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.MODIFY_AUDIO_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.READ_PHONE_STATE"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.RECEIVE_BOOT_COMPLETED"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.USE_CREDENTIALS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.android.launcher.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.BROADCAST_STICKY"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS"</span> /&gt;</div><div class="line"></div><div class="line"></div><div class="line">    &lt;application</div><div class="line">        android:allowBackup=<span class="string">"true"</span></div><div class="line">        android:label=<span class="string">"@string/app_name"</span></div><div class="line">        android:supportsRtl=<span class="string">"true"</span>&gt;</div><div class="line"></div><div class="line">        &lt;!-- 设置环信应用的AppKey --&gt;</div><div class="line">        &lt;meta-data</div><div class="line">            android:name=<span class="string">"EASEMOB_APPKEY"</span></div><div class="line">            android:value=<span class="string">"你的APPKEY"</span> /&gt;</div><div class="line">        &lt;!-- 声明SDK所需的service SDK核心功能--&gt;</div><div class="line">        &lt;service</div><div class="line">            android:name=<span class="string">"com.hyphenate.chat.EMChatService"</span></div><div class="line">            android:exported=<span class="string">"true"</span> /&gt;</div><div class="line">        &lt;!-- 声明SDK所需的receiver --&gt;</div><div class="line">        &lt;receiver android:name=<span class="string">"com.hyphenate.chat.EMMonitorReceiver"</span>&gt;</div><div class="line">            &lt;intent-filter&gt;</div><div class="line">                &lt;action android:name=<span class="string">"android.intent.action.PACKAGE_REMOVED"</span> /&gt;</div><div class="line">                &lt;data android:scheme=<span class="string">"package"</span> /&gt;</div><div class="line">            &lt;/intent-filter&gt;</div><div class="line">            &lt;!-- 可选filter --&gt;</div><div class="line">            &lt;intent-filter&gt;</div><div class="line">                &lt;action android:name=<span class="string">"android.intent.action.BOOT_COMPLETED"</span> /&gt;</div><div class="line">                &lt;action android:name=<span class="string">"android.intent.action.USER_PRESENT"</span> /&gt;</div><div class="line">            &lt;/intent-filter&gt;</div><div class="line">        &lt;/receiver&gt;</div><div class="line"></div><div class="line">    &lt;/application&gt;</div><div class="line"></div><div class="line">&lt;/manifest&gt;</div></pre></td></tr></table></figure>
<h1 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h1><p>创建一个<code>InitApplication</code>类，继承<code>Application</code>，用来初始化应用的一些信息。</p>
<p>在主工程的清单文件下声明</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</div><div class="line">&lt;manifest xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="keyword">package</span>=<span class="string">"……"</span>&gt;</div><div class="line"></div><div class="line">    &lt;application</div><div class="line">        android:name=<span class="string">".InitApplication"</span></div><div class="line">        ……&gt;</div><div class="line">        ……</div><div class="line">    &lt;/application&gt;</div><div class="line"></div><div class="line">&lt;/manifest&gt;</div></pre></td></tr></table></figure>
<p>初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> ……;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Application;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.hyphenate.chat.EMClient;</div><div class="line"><span class="keyword">import</span> com.hyphenate.chat.EMOptions;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Created by kqw on 2016/8/22.</span></div><div class="line"><span class="comment"> * 初始化应用</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InitApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line"></div><div class="line">        EMOptions options = <span class="keyword">new</span> EMOptions();</div><div class="line">        <span class="comment">// 默认添加好友时，是不需要验证的，改成需要验证</span></div><div class="line">        options.setAcceptInvitationAlways(<span class="keyword">false</span>);</div><div class="line">        <span class="comment">// 初始化</span></div><div class="line">        EMClient.getInstance().init(<span class="keyword">this</span>, options);</div><div class="line">        <span class="comment">// 在做打包混淆时，关闭debug模式，避免消耗不必要的资源</span></div><div class="line">        EMClient.getInstance().setDebugMode(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"已经初始化"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>部署完成</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/22/2016-08-22-OpenCV检测图像轮廓/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/22/2016-08-22-OpenCV检测图像轮廓/" itemprop="url">OpenCV检测图像轮廓</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-22T11:35:23+08:00">
                2016-08-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenCV/" itemprop="url" rel="index">
                    <span itemprop="name">OpenCV</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/08/22/2016-08-22-OpenCV检测图像轮廓/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/08/22/2016-08-22-OpenCV检测图像轮廓/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<p><strong>轮廓</strong>只不过是图像中连接的曲线，或者图像中连通部分的边界，轮廓通常以图像中的边缘来计算，但是，边缘和轮廓的区别在于轮廓是闭合的，而边缘可以是任意的。边缘的概念局限于点及其邻域像素，轮廓将目标作为整体进行处理。</p>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20160822114857928" alt="效果图"></p>
<p><img src="http://img.blog.csdn.net/20160822114912492" alt="原图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="https://github.com/kongqw/KqwOpenCVFeaturesDemo" target="_blank" rel="external">KqwOpenCVFeaturesDemo</a></p>
<h1 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h1><ol>
<li>将图像置灰</li>
<li>使用Canny边缘检测检测出图像的边缘</li>
<li>调用<code>Imgproc.findContours()</code>方法检测图像轮廓</li>
<li>在新的图像上画出轮廓</li>
</ol>
<h1 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 找出轮廓</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> bitmap 要检测的图片</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findContours</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != mSubscriber)</div><div class="line">        Observable</div><div class="line">                .just(bitmap)</div><div class="line">                <span class="comment">// 检测边缘</span></div><div class="line">                .map(<span class="keyword">new</span> Func1&lt;Bitmap, Mat&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> Mat <span class="title">call</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">                        Mat grayMat = <span class="keyword">new</span> Mat();</div><div class="line">                        Mat cannyEdges = <span class="keyword">new</span> Mat();</div><div class="line"></div><div class="line">                        <span class="comment">// Bitmap转为Mat</span></div><div class="line">                        Mat src = <span class="keyword">new</span> Mat(bitmap.getHeight(), bitmap.getWidth(), CvType.CV_8UC4);</div><div class="line">                        Utils.bitmapToMat(bitmap, src);</div><div class="line"></div><div class="line">                        <span class="comment">// 原图置灰</span></div><div class="line">                        Imgproc.cvtColor(src, grayMat, Imgproc.COLOR_BGR2GRAY);</div><div class="line">                        <span class="comment">// Canny边缘检测器检测图像边缘</span></div><div class="line">                        Imgproc.Canny(grayMat, cannyEdges, <span class="number">10</span>, <span class="number">100</span>);</div><div class="line"></div><div class="line">                        <span class="keyword">return</span> cannyEdges;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                <span class="comment">// 找出轮廓</span></div><div class="line">                .map(<span class="keyword">new</span> Func1&lt;Mat, Bitmap&gt;() &#123;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">call</span><span class="params">(Mat cannyEdges)</span> </span>&#123;</div><div class="line"></div><div class="line">                        Mat hierarchy = <span class="keyword">new</span> Mat();</div><div class="line">                        <span class="comment">// 保存轮廓</span></div><div class="line">                        ArrayList&lt;MatOfPoint&gt; contourList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">                        <span class="comment">// 检测轮廓</span></div><div class="line">                        Imgproc.findContours(cannyEdges, contourList, hierarchy, Imgproc.RETR_LIST, Imgproc.CHAIN_APPROX_SIMPLE);</div><div class="line"></div><div class="line">                        <span class="comment">// 画出轮廓</span></div><div class="line">                        Mat contours = <span class="keyword">new</span> Mat();</div><div class="line">                        contours.create(cannyEdges.rows(), cannyEdges.cols(), CvType.CV_8UC3);</div><div class="line">                        Random r = <span class="keyword">new</span> Random();</div><div class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; contourList.size(); i++) &#123;</div><div class="line">                            Imgproc.drawContours(contours, contourList, i, <span class="keyword">new</span> Scalar(r.nextInt(<span class="number">255</span>), r.nextInt(<span class="number">255</span>), r.nextInt(<span class="number">255</span>), -<span class="number">1</span>));</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="comment">// Mat转Bitmap</span></div><div class="line">                        Bitmap processedImage = Bitmap.createBitmap(contours.cols(), contours.rows(), Bitmap.Config.ARGB_8888);</div><div class="line">                        Utils.matToBitmap(contours, processedImage);</div><div class="line"></div><div class="line">                        <span class="keyword">return</span> processedImage;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .subscribeOn(Schedulers.io())</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(mSubscriber);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 图片特征提取的工具类</span></div><div class="line">mFeaturesUtil = <span class="keyword">new</span> FeaturesUtil(<span class="keyword">new</span> Subscriber&lt;Bitmap&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理完成</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理异常</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">        <span class="comment">// 获取到处理后的图片</span></div><div class="line">        mImageView.setImageBitmap(bitmap);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 找出轮廓</span></div><div class="line">mFeaturesUtil.findContours(mSelectImage);</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="kongqw" />
          <p class="site-author-name" itemprop="name">kongqw</p>
           
              <p class="site-description motion-element" itemprop="description">Android Developer</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">51</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/kongqw" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.csdn.net/q4878802" target="_blank" title="CSDN">
                  
                    <i class="fa fa-fw fa-home"></i>
                  
                  CSDN
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://gank.io" title="干货集中营" target="_blank">干货集中营</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.xfyun.cn" title="讯飞开放平台" target="_blank">讯飞开放平台</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.easemob.com" title="环信" target="_blank">环信</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://tongji.baidu.com" title="百度统计" target="_blank">百度统计</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://kongqw.disqus.com/admin/" title="DISQUS评论" target="_blank">DISQUS评论</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://wallet.btc.com/" title="BTC Wallet" target="_blank">BTC Wallet</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.okcoin.cn/" title="OKCoin中国站" target="_blank">OKCoin中国站</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.okcoin.com/" title="OKCoin国际站" target="_blank">OKCoin国际站</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://btc.com/" title="BTC.com" target="_blank">BTC.com</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kongqw</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://kongqw.disqus.com/count.js" async></script>
    

    

  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
