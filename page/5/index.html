<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="Android Developer">
<meta property="og:type" content="website">
<meta property="og:title" content="孔庆威的博客">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="孔庆威的博客">
<meta property="og:description" content="Android Developer">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="孔庆威的博客">
<meta name="twitter:description" content="Android Developer">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/5/"/>





  <title>孔庆威的博客</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?e8ad05f02e13a412b09b2e8a632634af";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>











  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">孔庆威的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">精于心，简于形</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/27/2016-07-27-Android设备的唯一标识/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/27/2016-07-27-Android设备的唯一标识/" itemprop="url">Android设备的唯一标识</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-27T11:19:40+08:00">
                2016-07-27
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/07/27/2016-07-27-Android设备的唯一标识/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/07/27/2016-07-27-Android设备的唯一标识/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="Android设备的唯一标识"><a href="#Android设备的唯一标识" class="headerlink" title="Android设备的唯一标识"></a>Android设备的唯一标识</h1><h2 id="IMEI"><a href="#IMEI" class="headerlink" title="IMEI"></a>IMEI</h2><h3 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:name=<span class="string">"android.permission.READ_PHONE_STATE"</span> /&gt;</div></pre></td></tr></table></figure>
<h3 id="获取IMEI"><a href="#获取IMEI" class="headerlink" title="获取IMEI"></a>获取IMEI</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 获取IMEI</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span> IMEI</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getIMEI</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        TelephonyManager TelephonyMgr = (TelephonyManager) getSystemService(TELEPHONY_SERVICE);</div><div class="line">        <span class="keyword">return</span> TelephonyMgr.getDeviceId();</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="WLAN-MAC-Address"><a href="#WLAN-MAC-Address" class="headerlink" title="WLAN MAC Address"></a>WLAN MAC Address</h2><h3 id="权限-1"><a href="#权限-1" class="headerlink" title="权限"></a>权限</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_WIFI_STATE"</span> /&gt;</div></pre></td></tr></table></figure>
<h3 id="获取MAC地址"><a href="#获取MAC地址" class="headerlink" title="获取MAC地址"></a>获取MAC地址</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 获取WLAN MAC Address</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span> MAC地址</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getWLANMacAddress</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        WifiManager wifiManager = (WifiManager) getSystemService(Context.WIFI_SERVICE);</div><div class="line">        WifiInfo wifiInfo = wifiManager.getConnectionInfo();</div><div class="line">        <span class="keyword">return</span> wifiInfo.getMacAddress();</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="BT-MAC-Address"><a href="#BT-MAC-Address" class="headerlink" title="BT MAC Address"></a>BT MAC Address</h2><h3 id="权限-2"><a href="#权限-2" class="headerlink" title="权限"></a>权限</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:name=<span class="string">"android.permission.BLUETOOTH"</span> /&gt;</div></pre></td></tr></table></figure>
<h3 id="获取MAC地址-1"><a href="#获取MAC地址-1" class="headerlink" title="获取MAC地址"></a>获取MAC地址</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 获取BT MAC Address</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span> MAC地址</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getBTMacAddress</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        BluetoothAdapter bluetoothAdapter = BluetoothAdapter.getDefaultAdapter();</div><div class="line">        <span class="keyword">return</span> bluetoothAdapter.getAddress();</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="MD5加密"><a href="#MD5加密" class="headerlink" title="MD5加密"></a>MD5加密</h2><blockquote>
<p>附加一个MD5的加密算法，考虑在某些特殊设备上可能获取不到某个ID，可以获取多个ID，组合起来，通过MD5算法，得到一个32位的唯一标识</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * MD5加密</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> text 要加密的字符串</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span> 加密后的32位结果</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">private</span> String <span class="title">digest</span><span class="params">(String text)</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="comment">// 创建一个MD5加密算法</span></div><div class="line">        MessageDigest digest = MessageDigest.getInstance(<span class="string">"MD5"</span>);</div><div class="line">        <span class="comment">// 创建StringBuffer保存十六进制数据</span></div><div class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();</div><div class="line">        <span class="comment">// 换成字节数组</span></div><div class="line">        <span class="keyword">byte</span>[] bytes = digest.digest(text.getBytes());</div><div class="line">        <span class="comment">// 遍历字节数组加密</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">byte</span> bt : bytes) &#123;</div><div class="line">            <span class="comment">// 将负数转换为正数</span></div><div class="line">            <span class="keyword">int</span> i = bt &amp; <span class="number">0xff</span>;</div><div class="line">            <span class="comment">// 将十进制转换为十六进制</span></div><div class="line">            String hex = Integer.toHexString(i);</div><div class="line">            <span class="comment">// 如果不够2位，前面补0</span></div><div class="line">            <span class="keyword">if</span> (<span class="number">2</span> &gt; hex.length()) &#123;</div><div class="line">                sb.append(<span class="number">0</span>);</div><div class="line">            &#125;</div><div class="line">            sb.append(hex);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> sb.toString();</div><div class="line">    &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="例"><a href="#例" class="headerlink" title="例:"></a>例:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">String text = getWLANMacAddress() + getBTMacAddress() + getIMEI();</div><div class="line">String md5 = digest(text);</div><div class="line">Toast.makeText(<span class="keyword">this</span>, <span class="string">"MD5:"</span> + md5, Toast.LENGTH_SHORT).show();</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/06/2016-07-06-Android使用OpenCV实现人脸识别/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/06/2016-07-06-Android使用OpenCV实现人脸识别/" itemprop="url">Android使用OpenCV实现人脸识别</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-06T17:48:57+08:00">
                2016-07-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenCV/" itemprop="url" rel="index">
                    <span itemprop="name">OpenCV</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/07/06/2016-07-06-Android使用OpenCV实现人脸识别/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/07/06/2016-07-06-Android使用OpenCV实现人脸识别/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p>先上效果图，GIF不好弄</p>
<p><img src="http://img.blog.csdn.net/20160706191730959" alt="人脸检测"></p>
<p><img src="http://img.blog.csdn.net/20160706191746100" alt="人脸特征保存"></p>
<p><img src="http://img.blog.csdn.net/20160706191806413" alt="人脸特征保存"></p>
<p><img src="http://img.blog.csdn.net/20160706191823102" alt="人脸对比"></p>
<p>在网上找了在Android平台上使用OpenCV相关的教程，很少，大部分也都主要是介绍下人脸检测，很少有讲人脸识别，还有的人连人脸检测和人脸识别的概念都没有搞清，人脸识别只是识别到有人脸，能获取到一个人脸的大概位置，有几个人脸，而人脸识别是要获取到人脸特征做对比，识别这个人脸。有好多文章都写自己在讲人脸识别，实际上他只是在做人脸检测。</p>
<p><a href="http://opencv.org/" target="_blank" rel="external">OpenCV官网</a></p>
<p>官方给的Demo是在Eclipse工程下的，如果你现在已经是在Android Studio下开发，因为Eclipse工程有makefile文件，迁移到Android Studio好像还是有点麻烦，我是干脆就在Eclipse下跑的Demo。</p>
<p>先甩过来官方给的一些文档：</p>
<p><a href="http://docs.opencv.org/2.4/doc/tutorials/introduction/android_binary_package/O4A_SDK.html" target="_blank" rel="external">OpenCV4Android SDK</a></p>
<p><a href="http://docs.opencv.org/2.4/doc/tutorials/introduction/android_binary_package/dev_with_OCV_on_Android.html#dev-with-ocv-on-android" target="_blank" rel="external">Android Development with OpenCV</a></p>
<h1 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h1><p>按照官方的文档，我们在Eclipse里导入Demo进去以后，是不能直接运行的，需要安装Manager的一个APK,然后在Demo工程里通过AIDL的方式，调用OpenCV的核心方法，不过Demo给实现的功能也只是一个人脸检测。</p>
<h1 id="SDK"><a href="#SDK" class="headerlink" title="SDK"></a>SDK</h1><p><a href="http://opencv.org/downloads.html" target="_blank" rel="external">SDK下载</a></p>
<p>下面来看一下SDK</p>
<p><img src="http://img.blog.csdn.net/20160706192039369" alt="下载SDK"></p>
<p>目录：</p>
<ul>
<li>apk：Manager的apk</li>
<li>doc：一些文档</li>
<li>samples：示例工程和一些编译好的apk</li>
<li>sdk：一些库文件</li>
</ul>
<blockquote>
<p> 当然, 如果你的C/C++足够好，你肯定可以自己编译一个库，直接导入到工程，就不用安装Manager了，可惜了我自己还不行，哈哈……无奈安装Manager把……</p>
</blockquote>
<p>如何将Demo导入到Eclipse并运行，上面官方的文档已经说的比较清楚了，至于会有什么问题就自行Google吧。</p>
<h1 id="人脸检测"><a href="#人脸检测" class="headerlink" title="人脸检测"></a>人脸检测</h1><p>其实人脸检测并不是重点，Demo里已经实现了人脸检测的功能。</p>
<p>主要的实现方式：OpenCV有一个自己的<code>org.opencv.android.JavaCameraView</code>自定义控件，它循环的从摄像头抓取数据，在回调方法中，我们能获取到Mat数据，然后通过调用OpenCV的Native方法，检测当前是否有人脸，我们会获取到一个<code>Rect</code>数组，里面会有人脸数据，最后将人脸画在屏幕上，到此为止，Demo的人脸检测功能，就结束了。</p>
<h1 id="人脸识别"><a href="#人脸识别" class="headerlink" title="人脸识别"></a>人脸识别</h1><p>人脸识别我这里用到了JavaCV</p>
<p><img src="http://img.blog.csdn.net/20160706192304870" alt="JavaCV"></p>
<p>人脸识别逻辑：人脸识别的主要方式就是获取到人脸的特征值，然后将两个特征值做比对，取到一个相似度去做人脸识别，OpenCV这里的特征值，其实就是一张图片。<br>我们的从回调的Mat数据检测到有人脸以后，提取特征值（也就是保存人脸的一张图片到某个路径），然后比较特征值</p>
<p>为了提高识别的准确度，需要在检测到人脸以后，把人脸的部分截取出来，然后置灰（置灰的目的是为了方式色泽和明暗度对识别有影响）。</p>
<h2 id="保存人脸特征值"><a href="#保存人脸特征值" class="headerlink" title="保存人脸特征值"></a>保存人脸特征值</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 特征保存</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> image    Mat</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> rect     人脸信息</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> fileName 文件名字</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span> 保存是否成功</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">saveImage</span><span class="params">(Mat image, Rect rect, String fileName)</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        String PATH = Environment.getExternalStorageDirectory() + <span class="string">"/FaceDetect/"</span> + fileName + <span class="string">".jpg"</span>;</div><div class="line">        <span class="comment">// 把检测到的人脸重新定义大小后保存成文件</span></div><div class="line">        Mat sub = image.submat(rect);</div><div class="line">        Mat mat = <span class="keyword">new</span> Mat();</div><div class="line">        Size size = <span class="keyword">new</span> Size(<span class="number">100</span>, <span class="number">100</span>);</div><div class="line">        Imgproc.resize(sub, mat, size);</div><div class="line">        Highgui.imwrite(PATH, mat);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="提取特征值"><a href="#提取特征值" class="headerlink" title="提取特征值"></a>提取特征值</h2><p>之前已经说了嘛，人脸特征其实就是一张人脸图片,所以提取人脸特征其实就是获取一张人脸图片</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 提取特征</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> fileName 文件名</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span> 特征图片</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> Bitmap <span class="title">getImage</span><span class="params">(String fileName)</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="keyword">return</span> BitmapFactory.decodeFile(Environment.getExternalStorageDirectory() + <span class="string">"/FaceDetect/"</span> + fileName + <span class="string">".jpg"</span>);</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="人脸识别-1"><a href="#人脸识别-1" class="headerlink" title="人脸识别"></a>人脸识别</h2><p>这里主要使用了JavaCV的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 特征对比</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> file1 人脸特征</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> file2 人脸特征</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span> 相似度</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">CmpPic</span><span class="params">(String file1, String file2)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> l_bins = <span class="number">20</span>;</div><div class="line">    <span class="keyword">int</span> hist_size[] = &#123;l_bins&#125;;</div><div class="line"></div><div class="line">    <span class="keyword">float</span> v_ranges[] = &#123;<span class="number">0</span>, <span class="number">100</span>&#125;;</div><div class="line">    <span class="keyword">float</span> ranges[][] = &#123;v_ranges&#125;;</div><div class="line"></div><div class="line">    opencv_core.IplImage Image1 = cvLoadImage(Environment.getExternalStorageDirectory() + <span class="string">"/FaceDetect/"</span> + file1 + <span class="string">".jpg"</span>, CV_LOAD_IMAGE_GRAYSCALE);</div><div class="line">    opencv_core.IplImage Image2 = cvLoadImage(Environment.getExternalStorageDirectory() + <span class="string">"/FaceDetect/"</span> + file2 + <span class="string">".jpg"</span>, CV_LOAD_IMAGE_GRAYSCALE);</div><div class="line"></div><div class="line">    opencv_core.IplImage imageArr1[] = &#123;Image1&#125;;</div><div class="line">    opencv_core.IplImage imageArr2[] = &#123;Image2&#125;;</div><div class="line"></div><div class="line">    opencv_imgproc.CvHistogram Histogram1 = opencv_imgproc.CvHistogram.create(<span class="number">1</span>, hist_size, CV_HIST_ARRAY, ranges, <span class="number">1</span>);</div><div class="line">    opencv_imgproc.CvHistogram Histogram2 = opencv_imgproc.CvHistogram.create(<span class="number">1</span>, hist_size, CV_HIST_ARRAY, ranges, <span class="number">1</span>);</div><div class="line"></div><div class="line">    cvCalcHist(imageArr1, Histogram1, <span class="number">0</span>, <span class="keyword">null</span>);</div><div class="line">    cvCalcHist(imageArr2, Histogram2, <span class="number">0</span>, <span class="keyword">null</span>);</div><div class="line"></div><div class="line">    cvNormalizeHist(Histogram1, <span class="number">100.0</span>);</div><div class="line">    cvNormalizeHist(Histogram2, <span class="number">100.0</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> cvCompareHist(Histogram1, Histogram2, CV_COMP_CORREL);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>看我轻描淡写了一篇博客写完了，看上去好像挺容易的，但是对于第一次做人脸识别的人或者对JNI还不是很熟的人来说，可能并没有想象的那么简单，你会遇到各种库找不到，编译不通过等等的问题，总之吧，一个大概的实现思路呈现出来，<strong>仅供参考</strong>，就是这样！有时间的话会再深入学习一下。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/15/2016-04-15-Android服务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/15/2016-04-15-Android服务/" itemprop="url">Android服务</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-15T18:51:03+08:00">
                2016-04-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/04/15/2016-04-15-Android服务/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/04/15/2016-04-15-Android服务/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h1><blockquote>
<p>Service 是一个可以在后台执行长时间运行操作而不使用用户界面的应用组件。服务可由其他应用组件启动，而且即使用户切换到其他应用，服务仍将在后台继续运行。 此外，组件可以绑定到服务，以与之进行交互，甚至是执行进程间通信 (IPC)。 例如，服务可以处理网络事务、播放音乐，执行文件 I/O 或与内容提供程序交互，而所有这一切均可在后台进行。</p>
</blockquote>
<p>服务基本上分为两种形式：</p>
<ul>
<li><p>启动</p>
<blockquote>
<p>当应用组件（如 Activity）通过调用 startService() 启动服务时，服务即处于“启动”状态。一旦启动，服务即可在后台无限期运行，即使启动服务的组件已被销毁也不受影响。 已启动的服务通常是执行单一操作，而且不会将结果返回给调用方。例如，它可能通过网络下载或上传文件。 操作完成后，服务会自行停止运行。</p>
</blockquote>
</li>
<li><p>绑定</p>
<blockquote>
<p>当应用组件通过调用 bindService() 绑定到服务时，服务即处于“绑定”状态。绑定服务提供了一个客户端-服务器接口，允许组件与服务进行交互、发送请求、获取结果，甚至是利用进程间通信 (IPC) 跨进程执行这些操作。 仅当与另一个应用组件绑定时，绑定服务才会运行。 多个组件可以同时绑定到该服务，但全部取消绑定后，该服务即会被销毁。</p>
</blockquote>
</li>
</ul>
<p>虽然本文档是分开概括讨论这两种服务，但是您的服务可以同时以这两种方式运行，也就是说，它既可以是启动服务（以无限期运行），也允许绑定。问题只是在于您是否实现了一组回调方法：onStartCommand()（允许组件启动服务）和 onBind()（允许绑定服务）。</p>
<p>无论应用是处于启动状态还是绑定状态，抑或处于启动并且绑定状态，任何应用组件均可像使用活动那样通过调用 Intent 来使用服务（即使此服务来自另一应用）。 不过，您可以通过清单文件将服务声明为私有服务，并阻止其他应用访问。 使用清单文件声明服务部分将对此做更详尽的阐述。</p>
<ul>
<li><p><strong>注意：</strong></p>
<blockquote>
<p>服务在其托管进程的主线程中运行，它既不创建自己的线程，也不在单独的进程中运行（除非另行指定）。 这意味着，如果服务将执行任何 CPU 密集型工作或阻止性操作（例如 MP3 播放或联网），则应在服务内创建新线程来完成这项工作。通过使用单独的线程，可以降低发生“应用无响应”(ANR) 错误的风险，而应用的主线程仍可继续专注于运行用户与 Activity 之间的交互。</p>
</blockquote>
</li>
</ul>
<h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><p>要创建服务，您必须创建 Service 的子类（或使用它的一个现有子类）。在实现中，您需要重写一些回调方法，以处理服务生命周期的某些关键方面并提供一种机制将组件绑定到服务（如适用）。 应重写的最重要的回调方法包括：</p>
<ul>
<li><p>onStartCommand()</p>
<blockquote>
<p>当另一个组件（如 Activity）通过调用 startService() 请求启动服务时，系统将调用此方法。一旦执行此方法，服务即会启动并可在后台无限期运行。 如果您实现此方法，则在服务工作完成后，需要由您通过调用 stopSelf() 或 stopService() 来停止服务。（如果您只想提供绑定，则无需实现此方法。）</p>
</blockquote>
</li>
<li><p>onBind()</p>
<blockquote>
<p>当另一个组件想通过调用 bindService() 与服务绑定（例如执行 RPC）时，系统将调用此方法。在此方法的实现中，您必须通过返回 IBinder 提供一个接口，供客户端用来与服务进行通信。请务必实现此方法，但如果您并不希望允许绑定，则应返回 null。</p>
</blockquote>
</li>
<li><p>onCreate()</p>
<blockquote>
<p>首次创建服务时，系统将调用此方法来执行一次性设置程序（在调用 onStartCommand() 或 onBind() 之前）。如果服务已在运行，则不会调用此方法。</p>
</blockquote>
</li>
<li><p>onDestroy()</p>
<blockquote>
<p>当服务不再使用且将被销毁时，系统将调用此方法。服务应该实现此方法来清理所有资源，如线程、注册的侦听器、接收器等。 这是服务接收的最后一个调用。</p>
</blockquote>
</li>
</ul>
<p>如果组件通过调用 startService() 启动服务（这会导致对 onStartCommand() 的调用），则服务将一直运行，直到服务使用 stopSelf() 自行停止运行，或由其他组件通过调用 stopService() 停止它为止。</p>
<p>如果组件是通过调用 bindService() 来创建服务（且未调用 onStartCommand()），则服务只会在该组件与其绑定时运行。一旦该服务与所有客户端之间的绑定全部取消，系统便会销毁它。</p>
<p>仅当内存过低且必须回收系统资源以供具有用户焦点的 Activity 使用时，Android 系统才会强制停止服务。如果将服务绑定到具有用户焦点的 Activity，则它不太可能会终止；如果将服务声明为在前台运行（稍后讨论），则它几乎永远不会终止。或者，如果服务已启动并要长时间运行，则系统会随着时间的推移降低服务在后台任务列表中的位置，而服务也将随之变得非常容易被终止；如果服务是启动服务，则您必须将其设计为能够妥善处理系统对它的重启。 如果系统终止服务，那么一旦资源变得再次可用，系统便会重启服务（不过这还取决于从 onStartCommand() 返回的值，本文稍后会对此加以讨论）。如需了解有关系统会在何时销毁服务的详细信息，请参阅进程和线程文档。</p>
<p>在下文中，您将了解如何创建各类服务以及如何从其他应用组件使用服务。</p>
<h2 id="使用清单文件声明服务"><a href="#使用清单文件声明服务" class="headerlink" title="使用清单文件声明服务"></a>使用清单文件声明服务</h2><p>如同 Activity（以及其他组件）一样，您必须在应用的清单文件中声明所有服务。</p>
<p>要声明服务，请添加 <service> 元素作为 <application> 元素的子元素。例如：</application></service></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;manifest ... &gt;</div><div class="line">  ...</div><div class="line">  &lt;application ... &gt;</div><div class="line">      &lt;service android:name=<span class="string">".ExampleService"</span> /&gt;</div><div class="line">      ...</div><div class="line">  &lt;/application&gt;</div><div class="line">&lt;/manifest&gt;</div></pre></td></tr></table></figure>
<p>如需了解有关使用清单文件声明服务的详细信息，请参阅 <service> 元素参考文档。</service></p>
<p>您还可将其他属性包括在 <service> 元素中，以定义一些特性，如启动服务及其运行所在进程所需的权限。android:name 属性是唯一必需的属性，用于指定服务的类名。应用一旦发布，即不应更改此类名，如若不然，可能会存在因依赖显式 Intent 启动或绑定服务而破坏代码的风险（请阅读博客文章Things That Cannot Change[不能更改的内容]）。</service></p>
<p>为了确保应用的安全性，请始终使用显式 Intent 启动或绑定 Service，且不要为服务声明 Intent 过滤器。 启动哪个服务存在一定的不确定性，而如果对这种不确定性的考量非常有必要，则可为服务提供 Intent 过滤器并从 Intent 中排除相应的组件名称，但随后必须使用 setPackage() 方法设置 Intent 的软件包，这样可以充分消除目标服务的不确定性。</p>
<p>此外，还可以通过添加 android:exported 属性并将其设置为 “false”，确保服务仅适用于您的应用。这可以有效阻止其他应用启动您的服务，即便在使用显式 Intent 时也如此。</p>
<h1 id="创建启动服务"><a href="#创建启动服务" class="headerlink" title="创建启动服务"></a>创建启动服务</h1><p>启动服务由另一个组件通过调用 startService() 启动，这会导致调用服务的 onStartCommand() 方法。</p>
<p>服务启动之后，其生命周期即独立于启动它的组件，并且可以在后台无限期地运行，即使启动服务的组件已被销毁也不受影响。 因此，服务应通过调用 stopSelf() 结束工作来自行停止运行，或者由另一个组件通过调用 stopService() 来停止它。</p>
<p>应用组件（如 Activity）可以通过调用 startService() 方法并传递 Intent 对象 （指定服务并包含待使用服务的所有数据）来启动服务。服务通过 onStartCommand() 方法接收此 Intent。</p>
<p>例如，假设某 Activity 需要将一些数据保存到在线数据库中。该 Activity 可以启动一个协同服务，并通过向 startService() 传递一个 Intent，为该服务提供要保存的数据。服务通过 onStartCommand() 接收 Intent，连接到 Internet 并执行数据库事务。事务完成之后，服务会自行停止运行并随即被销毁。</p>
<ul>
<li><p><strong>注意：</strong></p>
<blockquote>
<p>默认情况下，服务与服务声明所在的应用运行于同一进程，而且运行于该应用的主线程中。 因此，如果服务在用户与来自同一应用的 Activity 进行交互时执行密集型或阻止性操作，则会降低 Activity 性能。 为了避免影响应用性能，您应在服务内启动新线程。</p>
</blockquote>
</li>
</ul>
<p>从传统上讲，您可以扩展两个类来创建启动服务：</p>
<ul>
<li><p>Service</p>
<blockquote>
<p>这是适用于所有服务的基类。扩展此类时，必须创建一个用于执行所有服务工作的新线程，因为默认情况下，服务将使用应用的主线程，这会降低应用正在运行的所有 Activity 的性能。</p>
</blockquote>
</li>
<li><p>IntentService</p>
<blockquote>
<p>这是 Service 的子类，它使用工作线程逐一处理所有启动请求。如果您不要求服务同时处理多个请求，这是最好的选择。 您只需实现 onHandleIntent() 方法即可，该方法会接收每个启动请求的 Intent，使您能够执行后台工作。</p>
</blockquote>
</li>
</ul>
<p>下文介绍如何使用其中任一类实现服务。</p>
<h2 id="扩展-IntentService-类"><a href="#扩展-IntentService-类" class="headerlink" title="扩展 IntentService 类"></a>扩展 IntentService 类</h2><p>由于大多数启动服务都不必同时处理多个请求（实际上，这种多线程情况可能很危险），因此使用 IntentService 类实现服务也许是最好的选择。</p>
<p>IntentService 执行以下操作：</p>
<ul>
<li>创建默认的工作线程，用于在应用的主线程外执行传递给 onStartCommand() 的所有 Intent。</li>
<li>创建工作队列，用于将一个 Intent 逐一传递给 onHandleIntent() 实现，这样您就永远不必担心多线程问题。</li>
<li>在处理完所有启动请求后停止服务，因此您永远不必调用 stopSelf()。</li>
<li>提供 onBind() 的默认实现（返回 null）。</li>
<li>提供 onStartCommand() 的默认实现，可将 Intent 依次发送到工作队列和 onHandleIntent() 实现。</li>
</ul>
<p>综上所述，您只需实现 onHandleIntent() 来完成客户端提供的工作即可。（不过，您还需要为服务提供小型构造函数。）</p>
<p>以下是 IntentService 的实现示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloIntentService</span> <span class="keyword">extends</span> <span class="title">IntentService</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * A constructor is required, and must call the super IntentService(String)</span></div><div class="line"><span class="comment">   * constructor with a name for the worker thread.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">HelloIntentService</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="keyword">super</span>(<span class="string">"HelloIntentService"</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * The IntentService calls this method from the default worker thread with</span></div><div class="line"><span class="comment">   * the intent that started the service. When this method returns, IntentService</span></div><div class="line"><span class="comment">   * stops the service, as appropriate.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onHandleIntent</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">      <span class="comment">// Normally we would do some work here, like download a file.</span></div><div class="line">      <span class="comment">// For our sample, we just sleep for 5 seconds.</span></div><div class="line">      <span class="keyword">long</span> endTime = System.currentTimeMillis() + <span class="number">5</span>*<span class="number">1000</span>;</div><div class="line">      <span class="keyword">while</span> (System.currentTimeMillis() &lt; endTime) &#123;</div><div class="line">          <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">              <span class="keyword">try</span> &#123;</div><div class="line">                  wait(endTime - System.currentTimeMillis());</div><div class="line">              &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">              &#125;</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>您只需要一个构造函数和一个 onHandleIntent() 实现即可。</p>
<p>如果您决定还重写其他回调方法（如 onCreate()、onStartCommand() 或 onDestroy()），请确保调用超类实现，以便 IntentService 能够妥善处理工作线程的生命周期。</p>
<p>例如，onStartCommand() 必须返回默认实现（即，如何将 Intent 传递给 onHandleIntent()）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</div><div class="line">    Toast.makeText(<span class="keyword">this</span>, <span class="string">"service starting"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onStartCommand(intent,flags,startId);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>除 onHandleIntent() 之外，您无需从中调用超类的唯一方法就是 onBind()（仅当服务允许绑定时，才需要实现该方法）。</p>
<p>在下一部分中，您将了解如何在扩展 Service 基类时实现同类服务。该基类包含更多代码，但如需同时处理多个启动请求，则更适合使用该基类。</p>
<h2 id="扩展服务类"><a href="#扩展服务类" class="headerlink" title="扩展服务类"></a>扩展服务类</h2><p>正如上一部分中所述，使用 IntentService 显著简化了启动服务的实现。但是，若要求服务执行多线程（而不是通过工作队列处理启动请求），则可扩展 Service 类来处理每个 Intent。</p>
<p>为了便于比较，以下提供了 Service 类实现的代码示例，该类执行的工作与上述使用 IntentService 的示例完全相同。也就是说，对于每个启动请求，它均使用工作线程执行作业，且每次仅处理一个请求。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> Looper mServiceLooper;</div><div class="line">  <span class="keyword">private</span> ServiceHandler mServiceHandler;</div><div class="line"></div><div class="line">  <span class="comment">// Handler that receives messages from the thread</span></div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="title">ServiceHandler</span><span class="params">(Looper looper)</span> </span>&#123;</div><div class="line">          <span class="keyword">super</span>(looper);</div><div class="line">      &#125;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">          <span class="comment">// Normally we would do some work here, like download a file.</span></div><div class="line">          <span class="comment">// For our sample, we just sleep for 5 seconds.</span></div><div class="line">          <span class="keyword">long</span> endTime = System.currentTimeMillis() + <span class="number">5</span>*<span class="number">1000</span>;</div><div class="line">          <span class="keyword">while</span> (System.currentTimeMillis() &lt; endTime) &#123;</div><div class="line">              <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">                  <span class="keyword">try</span> &#123;</div><div class="line">                      wait(endTime - System.currentTimeMillis());</div><div class="line">                  &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">                  &#125;</div><div class="line">              &#125;</div><div class="line">          &#125;</div><div class="line">          <span class="comment">// Stop the service using the startId, so that we don't stop</span></div><div class="line">          <span class="comment">// the service in the middle of handling another job</span></div><div class="line">          stopSelf(msg.arg1);</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// Start up the thread running the service.  Note that we create a</span></div><div class="line">    <span class="comment">// separate thread because the service normally runs in the process's</span></div><div class="line">    <span class="comment">// main thread, which we don't want to block.  We also make it</span></div><div class="line">    <span class="comment">// background priority so CPU-intensive work will not disrupt our UI.</span></div><div class="line">    HandlerThread thread = <span class="keyword">new</span> HandlerThread(<span class="string">"ServiceStartArguments"</span>,</div><div class="line">            Process.THREAD_PRIORITY_BACKGROUND);</div><div class="line">    thread.start();</div><div class="line"></div><div class="line">    <span class="comment">// Get the HandlerThread's Looper and use it for our Handler</span></div><div class="line">    mServiceLooper = thread.getLooper();</div><div class="line">    mServiceHandler = <span class="keyword">new</span> ServiceHandler(mServiceLooper);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</div><div class="line">      Toast.makeText(<span class="keyword">this</span>, <span class="string">"service starting"</span>, Toast.LENGTH_SHORT).show();</div><div class="line"></div><div class="line">      <span class="comment">// For each start request, send a message to start a job and deliver the</span></div><div class="line">      <span class="comment">// start ID so we know which request we're stopping when we finish the job</span></div><div class="line">      Message msg = mServiceHandler.obtainMessage();</div><div class="line">      msg.arg1 = startId;</div><div class="line">      mServiceHandler.sendMessage(msg);</div><div class="line"></div><div class="line">      <span class="comment">// If we get killed, after returning from here, restart</span></div><div class="line">      <span class="keyword">return</span> START_STICKY;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">      <span class="comment">// We don't provide binding, so return null</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">    Toast.makeText(<span class="keyword">this</span>, <span class="string">"service done"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>正如您所见，与使用 IntentService 相比，这需要执行更多工作。</p>
<p>但是，因为是由您自己处理对 onStartCommand() 的每个调用，因此可以同时执行多个请求。此示例并未这样做，但如果您希望如此，则可为每个请求创建一个新线程，然后立即运行这些线程（而不是等待上一个请求完成）。</p>
<p>请注意，onStartCommand() 方法必须返回整型数。整型数是一个值，用于描述系统应该如何在服务终止的情况下继续运行服务（如上所述，IntentService 的默认实现将为您处理这种情况，不过您可以对其进行修改）。从 onStartCommand() 返回的值必须是以下常量之一：</p>
<ul>
<li><p>START_NOT_STICKY</p>
<blockquote>
<p>如果系统在 onStartCommand() 返回后终止服务，则除非有挂起 Intent 要传递，否则系统不会重建服务。这是最安全的选项，可以避免在不必要时以及应用能够轻松重启所有未完成的作业时运行服务。</p>
</blockquote>
</li>
<li><p>START_STICKY</p>
<blockquote>
<p>如果系统在 onStartCommand() 返回后终止服务，则会重建服务并调用 onStartCommand()，但绝对不会重新传递最后一个 Intent。相反，除非有挂起 Intent 要启动服务（在这种情况下，将传递这些 Intent ），否则系统会通过空 Intent 调用 onStartCommand()。这适用于不执行命令、但无限期运行并等待作业的媒体播放器（或类似服务）。</p>
</blockquote>
</li>
<li><p>START_REDELIVER_INTENT</p>
<blockquote>
<p>如果系统在 onStartCommand() 返回后终止服务，则会重建服务，并通过传递给服务的最后一个 Intent 调用 onStartCommand()。任何挂起 Intent 均依次传递。这适用于主动执行应该立即恢复的作业（例如下载文件）的服务。</p>
</blockquote>
</li>
</ul>
<p>有关这些返回值的更多详细信息，请查阅每个常量链接的参考文档。</p>
<h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><p>您可以通过将 Intent（指定要启动的服务）传递给 startService()，从 Activity 或其他应用组件启动服务。Android 系统调用服务的 onStartCommand() 方法，并向其传递 Intent。（切勿直接调用 onStartCommand()。）</p>
<p>例如，Activity 可以结合使用显式 Intent 与 startService()，启动上文中的示例服务 (HelloSevice)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, HelloService.class);</div><div class="line">startService(intent);</div></pre></td></tr></table></figure>
<p>startService() 方法将立即返回，且 Android 系统调用服务的 onStartCommand() 方法。如果服务尚未运行，则系统会先调用 onCreate()，然后再调用 onStartCommand()。</p>
<p>如果服务亦未提供绑定，则使用 startService() 传递的 Intent 是应用组件与服务之间唯一的通信模式。但是，如果您希望服务返回结果，则启动服务的客户端可以为广播创建一个 PendingIntent （使用 getBroadcast()），并通过启动服务的 Intent 传递给服务。然后，服务就可以使用广播传递结果。</p>
<p>多个服务启动请求会导致多次对服务的 onStartCommand() 进行相应的调用。但是，要停止服务，只需一个服务停止请求（使用 stopSelf() 或 stopService()）即可。</p>
<h2 id="停止服务"><a href="#停止服务" class="headerlink" title="停止服务"></a>停止服务</h2><p>启动服务必须管理自己的生命周期。也就是说，除非系统必须回收内存资源，否则系统不会停止或销毁服务，而且服务在 onStartCommand() 返回后会继续运行。因此，服务必须通过调用 stopSelf() 自行停止运行，或者由另一个组件通过调用 stopService() 来停止它。</p>
<p>一旦请求使用 stopSelf() 或 stopService() 停止服务，系统就会尽快销毁服务。</p>
<p>但是，如果服务同时处理多个 onStartCommand() 请求，则您不应在处理完一个启动请求之后停止服务，因为您可能已经收到了新的启动请求（在第一个请求结束时停止服务会终止第二个请求）。为了避免这一问题，您可以使用 stopSelf(int) 确保服务停止请求始终基于最近的启动请求。也就说，在调用 stopSelf(int) 时，传递与停止请求的 ID 对应的启动请求的 ID（传递给 onStartCommand() 的 startId） 。然后，如果在您能够调用 stopSelf(int) 之前服务收到了新的启动请求， ID 就不匹配，服务也就不会停止。</p>
<ul>
<li><p><strong>注意：</strong></p>
<blockquote>
<p>为了避免浪费系统资源和消耗电池电量，应用必须在工作完成之后停止其服务。 如有必要，其他组件可以通过调用 stopService() 来停止服务。即使为服务启用了绑定，一旦服务收到对 onStartCommand() 的调用，您始终仍须亲自停止服务。</p>
</blockquote>
</li>
</ul>
<p>如需了解有关服务生命周期的详细信息，请参阅下面有关管理服务生命周期的部分。</p>
<h1 id="创建绑定服务"><a href="#创建绑定服务" class="headerlink" title="创建绑定服务"></a>创建绑定服务</h1><p>绑定服务允许应用组件通过调用 bindService() 与其绑定，以便创建长期连接（通常不允许组件通过调用 startService() 来启动它）。</p>
<p>如需与 Activity 和其他应用组件中的服务进行交互，或者需要通过进程间通信 (IPC) 向其他应用公开某些应用功能，则应创建绑定服务。</p>
<p>要创建绑定服务，必须实现 onBind() 回调方法以返回 IBinder，用于定义与服务通信的接口。然后，其他应用组件可以调用 bindService() 来检索该接口，并开始对服务调用方法。服务只用于与其绑定的应用组件，因此如果没有组件绑定到服务，则系统会销毁服务（您不必按通过 onStartCommand() 启动的服务那样来停止绑定服务）。</p>
<p>要创建绑定服务，首先必须定义指定客户端如何与服务通信的接口。 服务与客户端之间的这个接口必须是 IBinder 的实现，并且服务必须从 onBind() 回调方法返回它。一旦客户端收到 IBinder，即可开始通过该接口与服务进行交互。</p>
<p>多个客户端可以同时绑定到服务。客户端完成与服务的交互后，会调用 unbindService() 取消绑定。一旦没有客户端绑定到该服务，系统就会销毁它。</p>
<p>有多种方法实现绑定服务，其实现比启动服务更为复杂，因此绑定服务将在有关绑定服务的单独文档中专门讨论。</p>
<h1 id="向用户发送通知"><a href="#向用户发送通知" class="headerlink" title="向用户发送通知"></a>向用户发送通知</h1><p>一旦运行起来，服务即可使用 Toast 通知或状态栏通知来通知用户所发生的事件。</p>
<p>Toast 通知是指出现在当前窗口的表面、片刻随即消失不见的消息，而状态栏通知则在状态栏提供内含消息的图标，用户可以选择该图标来采取操作（例如启动 Activity）。</p>
<p>通常，当某些后台工作已经完成（例如文件下载完成）且用户现在可以对其进行操作时，状态栏通知是最佳方法。 当用户从展开视图中选定通知时，通知即可启动 Activity（例如查看已下载的文件）。</p>
<p>如需了解详细信息，请参阅 Toast 通知或状态栏通知开发者指南。</p>
<h1 id="在前台运行服务"><a href="#在前台运行服务" class="headerlink" title="在前台运行服务"></a>在前台运行服务</h1><p>前台服务被认为是用户主动意识到的一种服务，因此在内存不足时，系统也不会考虑将其终止。 前台服务必须为状态栏提供通知，状态栏位于“正在进行”标题下方，这意味着除非服务停止或从前台删除，否则不能清除通知。</p>
<p>例如，应该将从服务播放音乐的音乐播放器设置为在前台运行，这是因为用户明确意识到其操作。 状态栏中的通知可能表示正在播放的歌曲，并允许用户启动 Activity 来与音乐播放器进行交互。</p>
<p>要请求让服务运行于前台，请调用 startForeground()。此方法取两个参数：唯一标识通知的整型数和状态栏的 Notification。例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Notification notification = <span class="keyword">new</span> Notification(R.drawable.icon,getText(R.string.ticker_text), System.currentTimeMillis());</div><div class="line">Intent notificationIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, ExampleActivity.class);</div><div class="line">PendingIntent pendingIntent = PendingIntent.getActivity(<span class="keyword">this</span>, <span class="number">0</span>, notificationIntent, <span class="number">0</span>);</div><div class="line">notification.setLatestEventInfo(<span class="keyword">this</span>, getText(R.string.notification_title), getText(R.string.notification_message), pendingIntent);</div><div class="line">startForeground(ONGOING_NOTIFICATION_ID, notification);</div></pre></td></tr></table></figure>
<ul>
<li><p><strong>注意：</strong></p>
<blockquote>
<p>提供给 startForeground() 的整型 ID 不得为 0。</p>
</blockquote>
</li>
</ul>
<p>要从前台删除服务，请调用 stopForeground()。此方法取一个布尔值，指示是否也删除状态栏通知。 此方法绝对不会停止服务。 但是，如果您在服务正在前台运行时将其停止，则通知也会被删除。</p>
<p>如需了解有关通知的详细信息，请参阅创建状态栏通知。</p>
<h1 id="管理服务生命周期"><a href="#管理服务生命周期" class="headerlink" title="管理服务生命周期"></a>管理服务生命周期</h1><p>服务的生命周期比 Activity 的生命周期要简单得多。但是，密切关注如何创建和销毁服务反而更加重要，因为服务可以在用户没有意识到的情况下运行于后台。</p>
<p>服务生命周期（从创建到销毁）可以遵循两条不同的路径：</p>
<ul>
<li><p>启动服务</p>
<blockquote>
<p>该服务在其他组件调用 startService() 时创建，然后无限期运行，且必须通过调用 stopSelf() 来自行停止运行。此外，其他组件也可以通过调用 stopService() 来停止服务。服务停止后，系统会将其销毁。</p>
</blockquote>
</li>
<li><p>绑定服务</p>
<blockquote>
<p>该服务在另一个组件（客户端）调用 bindService() 时创建。然后，客户端通过 IBinder 接口与服务进行通信。客户端可以通过调用 unbindService() 关闭连接。多个客户端可以绑定到相同服务，而且当所有绑定全部取消后，系统即会销毁该服务。 （服务不必自行停止运行。）</p>
</blockquote>
</li>
</ul>
<p>这两条路径并非完全独立。也就是说，您可以绑定到已经使用 startService() 启动的服务。例如，可以通过使用 Intent（标识要播放的音乐）调用 startService() 来启动后台音乐服务。随后，可能在用户需要稍加控制播放器或获取有关当前播放歌曲的信息时，Activity 可以通过调用 bindService() 绑定到服务。在这种情况下，除非所有客户端均取消绑定，否则 stopService() 或 stopSelf() 不会真正停止服务。</p>
<h2 id="实现生命周期回调"><a href="#实现生命周期回调" class="headerlink" title="实现生命周期回调"></a>实现生命周期回调</h2><p>与 Activity 类似，服务也拥有生命周期回调方法，您可以实现这些方法来监控服务状态的变化并适时执行工作。 以下框架服务展示了每种生命周期方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> mStartMode;       <span class="comment">// indicates how to behave if the service is killed</span></div><div class="line">    IBinder mBinder;      <span class="comment">// interface for clients that bind</span></div><div class="line">    <span class="keyword">boolean</span> mAllowRebind; <span class="comment">// indicates whether onRebind should be used</span></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// The service is being created</span></div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</div><div class="line">        <span class="comment">// The service is starting, due to a call to startService()</span></div><div class="line">        <span class="keyword">return</span> mStartMode;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">        <span class="comment">// A client is binding to the service with bindService()</span></div><div class="line">        <span class="keyword">return</span> mBinder;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onUnbind</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">        <span class="comment">// All clients have unbound with unbindService()</span></div><div class="line">        <span class="keyword">return</span> mAllowRebind;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRebind</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">        <span class="comment">// A client is binding to the service with bindService(),</span></div><div class="line">        <span class="comment">// after onUnbind() has already been called</span></div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// The service is no longer used and is being destroyed</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p><strong>注：</strong></p>
<blockquote>
<p>与 Activity 生命周期回调方法不同，您不需要调用这些回调方法的超类实现。</p>
</blockquote>
<p>  <img src="http://img.blog.csdn.net/20160415172440660" alt="这里写图片描述"></p>
</li>
</ul>
<p>图 2. 服务生命周期左图显示了使用 startService() 所创建的服务的生命周期，右图显示了使用 bindService() 所创建的服务的生命周期。</p>
<p>通过实现这些方法，您可以监控服务生命周期的两个嵌套循环：</p>
<ul>
<li><p>服务的整个生命周期从调用 onCreate() 开始起，到 onDestroy() 返回时结束。与 Activity 类似，服务也在 onCreate() 中完成初始设置，并在 onDestroy() 中释放所有剩余资源。例如，音乐播放服务可以在 onCreate() 中创建用于播放音乐的线程，然后在 onDestroy() 中停止该线程。无论服务是通过 startService() 还是 bindService() 创建，都会为所有服务调用 onCreate() 和 onDestroy() 方法。</p>
</li>
<li><p>服务的有效生命周期从调用 onStartCommand() 或 onBind() 方法开始。每种方法均有 Intent 对象，该对象分别传递到 startService() 或 bindService()。<br>对于启动服务，有效生命周期与整个生命周期同时结束（即便是在 onStartCommand() 返回之后，服务仍然处于活动状态）。对于绑定服务，有效生命周期在 onUnbind() 返回时结束。</p>
</li>
</ul>
<ul>
<li><strong>注：</strong><blockquote>
<p>尽管启动服务是通过调用 stopSelf() 或 stopService() 来停止，但是该服务并无相应的回调（没有 onStop() 回调）。因此，除非服务绑定到客户端，否则在服务停止时，系统会将其销毁—onDestroy() 是接收到的唯一回调。</p>
</blockquote>
</li>
</ul>
<p>图 2 说明了服务的典型回调方法。尽管该图分开介绍通过 startService() 创建的服务和通过 bindService() 创建的服务，但是请记住，不管启动方式如何，任何服务均有可能允许客户端与其绑定。因此，最初使用 onStartCommand()（通过客户端调用 startService()）启动的服务仍可接收对 onBind() 的调用（当客户端调用 bindService() 时）。</p>
<p>如需了解有关创建提供绑定的服务的详细信息，请参阅绑定服务文档，该文档的管理绑定服务的生命周期部分提供了有关 onRebind() 回调方法的更多信息。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/30/2015-08-30-科大讯飞离线语音合成（语记）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/30/2015-08-30-科大讯飞离线语音合成（语记）/" itemprop="url">科大讯飞离线语音合成（语记）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-30T18:14:13+08:00">
                2015-08-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/语音/" itemprop="url" rel="index">
                    <span itemprop="name">语音</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/08/30/2015-08-30-科大讯飞离线语音合成（语记）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/08/30/2015-08-30-科大讯飞离线语音合成（语记）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="离线语音合成（语记）"><a href="#离线语音合成（语记）" class="headerlink" title="离线语音合成（语记）"></a>离线语音合成（语记）</h1><p>讯飞的语音合成有三种方式</p>
<ol>
<li>在线语音合成（免费）</li>
<li>离线使用语记语音合成（免费，需要本地装一个语记App并且下载离线资源）</li>
<li>使用讯飞离线语音包（付费）</li>
</ol>
<p><strong>这里使用语记实现离线语音合成</strong></p>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20150830135809695" alt="效果图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="http://download.csdn.net/detail/q4878802/9063593" target="_blank" rel="external">下载地址（Android Studio工程）：http://download.csdn.net/detail/q4878802/9063593</a></p>
<h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>使用<strong>语记</strong>实现离线语音合成和在线语音合成的步骤非常相似，下载SDK的方式是一样的，一样是选择<strong>在线语音合成</strong>，只不过是使用<strong>离线引擎</strong>就可以借用语音合成语音了。 </p>
<p><a href="http://blog.csdn.net/q4878802/article/details/48092495" target="_blank" rel="external">在线语音合成地址：http://blog.csdn.net/q4878802/article/details/48092495</a></p>
<p><strong>下面说说和在线语音合成不用的地方</strong></p>
<h2 id="1-下载并安装语记，下载离线资源"><a href="#1-下载并安装语记，下载离线资源" class="headerlink" title="1. 下载并安装语记，下载离线资源"></a>1. 下载并安装语记，下载离线资源</h2><p>离线语音听写的文章里有介绍，<a href="离线语音听写">地址： http://blog.csdn.net/q4878802/article/details/47834601</a></p>
<h2 id="2-网络权限就可以删掉了，本地合成不需要联网，但是获取网络状态的权限一定要有。"><a href="#2-网络权限就可以删掉了，本地合成不需要联网，但是获取网络状态的权限一定要有。" class="headerlink" title="2. 网络权限就可以删掉了，本地合成不需要联网，但是获取网络状态的权限一定要有。"></a>2. 网络权限就可以删掉了，本地合成不需要联网，但是获取网络状态的权限一定要有。</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_NETWORK_STATE"</span> /&gt;</div></pre></td></tr></table></figure>
<h2 id="3-将识别引擎改为本地引擎"><a href="#3-将识别引擎改为本地引擎" class="headerlink" title="3.  将识别引擎改为本地引擎"></a>3.  将识别引擎改为本地引擎</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 引擎类型 本地</span></div><div class="line">mTts.setParameter(SpeechConstant.ENGINE_TYPE, SpeechConstant.TYPE_LOCAL);</div></pre></td></tr></table></figure>
<h2 id="4-在Application初始化的类里把引擎模式设置的参数注释掉"><a href="#4-在Application初始化的类里把引擎模式设置的参数注释掉" class="headerlink" title="4. 在Application初始化的类里把引擎模式设置的参数注释掉"></a>4. 在Application初始化的类里把引擎模式设置的参数注释掉</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// param.append(",");</span></div><div class="line"><span class="comment">// param.append(SpeechConstant.ENGINE_MODE + "=" + SpeechConstant.MODE_MSC);</span></div></pre></td></tr></table></figure>
<p><strong>SpeechConstant.MODE_MSC 参数意思是使用离线包资源，如果离线包资源找不到会走网络识别，如果设置这种模式是不会使用语记（语音+）的</strong>如果使用离线包，就需要这条参数。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/30/2015-08-30-科大讯飞离线语音合成/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/30/2015-08-30-科大讯飞离线语音合成/" itemprop="url">科大讯飞离线语音合成</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-30T18:06:35+08:00">
                2015-08-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/语音/" itemprop="url" rel="index">
                    <span itemprop="name">语音</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/08/30/2015-08-30-科大讯飞离线语音合成/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/08/30/2015-08-30-科大讯飞离线语音合成/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="离线语音合成（离线资源包）"><a href="#离线语音合成（离线资源包）" class="headerlink" title="离线语音合成（离线资源包）"></a>离线语音合成（离线资源包）</h1><p>讯飞的语音合成有三种方式</p>
<ol>
<li>在线语音合成（免费）</li>
<li>离线使用语记语音合成（免费，需要本地装一个语记App并且下载离线资源）</li>
<li>使用讯飞离线语音包（付费）</li>
</ol>
<p><strong>这里使用离线资源包实现离线语音合成，因为正式版是要付费的，所以这里使用试用的离线包（35天试用期、3个装机量）。</strong></p>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20150830151323997" alt="效果图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="http://download.csdn.net/detail/q4878802/9063779" target="_blank" rel="external">下载地址（Android Studio工程）：http://download.csdn.net/detail/q4878802/9063779</a></p>
<h1 id="开通服务，下载SDK"><a href="#开通服务，下载SDK" class="headerlink" title="开通服务，下载SDK"></a>开通服务，下载SDK</h1><p>之前已经介绍过，<a href="http://blog.csdn.net/q4878802/article/details/47762169#t8" target="_blank" rel="external">地址：http://blog.csdn.net/q4878802/article/details/47762169#t8</a></p>
<h1 id="将SDK里提供的jar包、so库、离线资源都拷贝到我们的工程（Android-Studio工程）"><a href="#将SDK里提供的jar包、so库、离线资源都拷贝到我们的工程（Android-Studio工程）" class="headerlink" title="将SDK里提供的jar包、so库、离线资源都拷贝到我们的工程（Android Studio工程）"></a>将SDK里提供的jar包、so库、离线资源都拷贝到我们的工程（Android Studio工程）</h1><p>创建的工程默认可能没有jniLibs和assets目录，我们要自己在main下创建这两个目录</p>
<p><img src="http://img.blog.csdn.net/20150830151347864" alt="导入SDK"></p>
<h1 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h1><p>在清单文件中application标签下添加name属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android:name=<span class="string">".InitApplication"</span></div></pre></td></tr></table></figure>
<p>初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.kongqw.kqwspeechcompounddemo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Application;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechConstant;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechUtility;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Created by kongqw on 2015/8/29.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InitApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"InitApplication"</span>, Toast.LENGTH_LONG).show();</div><div class="line">        <span class="comment">// 应用程序入口处调用,避免手机内存过小,杀死后台进程后通过历史intent进入Activity造成SpeechUtility对象为null</span></div><div class="line">        <span class="comment">// 如在Application中调用初始化，需要在Mainifest中注册该Applicaiton</span></div><div class="line">        <span class="comment">// 注意：此接口在非主进程调用会返回null对象，如需在非主进程使用语音功能，请增加参数：SpeechConstant.FORCE_LOGIN+"=true"</span></div><div class="line">        <span class="comment">// 参数间使用“,”分隔。</span></div><div class="line">        <span class="comment">// 设置你申请的应用appid</span></div><div class="line">        StringBuffer param = <span class="keyword">new</span> StringBuffer();</div><div class="line">        param.append(<span class="string">"appid=55d33f09"</span>);</div><div class="line">        param.append(<span class="string">","</span>);</div><div class="line">        param.append(SpeechConstant.ENGINE_MODE + <span class="string">"="</span> + SpeechConstant.MODE_MSC);</div><div class="line">        <span class="comment">// param.append(",");</span></div><div class="line">        <span class="comment">// param.append(SpeechConstant.FORCE_LOGIN + "=true");</span></div><div class="line">        SpeechUtility.createUtility(InitApplication.<span class="keyword">this</span>, param.toString());</div><div class="line"></div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="语音合成工具类"><a href="#语音合成工具类" class="headerlink" title="语音合成工具类"></a>语音合成工具类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.kongqw.kqwspeechcompounddemo.engine;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.ErrorCode;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.InitListener;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechConstant;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechError;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechSynthesizer;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SynthesizerListener;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.util.ResourceUtil;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.util.ResourceUtil.RESOURCE_TYPE;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 语音合成器</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> kongqw</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KqwSpeechSynthesizer</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// Log标签</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"KqwSpeechSynthesizer"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Context mContext;</div><div class="line"></div><div class="line">    <span class="comment">// 语音合成对象</span></div><div class="line">    <span class="keyword">private</span> SpeechSynthesizer mTts;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">KqwSpeechSynthesizer</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        mContext = context;</div><div class="line">        <span class="comment">// 初始化合成对象</span></div><div class="line">        mTts = SpeechSynthesizer.createSynthesizer(context, <span class="keyword">new</span> InitListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onInit</span><span class="params">(<span class="keyword">int</span> code)</span> </span>&#123;</div><div class="line">                Log.d(TAG, <span class="string">"InitListener init() code = "</span> + code);</div><div class="line">                <span class="keyword">if</span> (code != ErrorCode.SUCCESS) &#123;</div><div class="line">                    Toast.makeText(mContext, <span class="string">"初始化失败,错误码："</span> + code, Toast.LENGTH_SHORT).show();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 开始语音合成</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> text</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(String text)</span> </span>&#123;</div><div class="line">        <span class="comment">// 设置参数</span></div><div class="line">        setParam();</div><div class="line">        <span class="keyword">int</span> code = mTts.startSpeaking(text, mTtsListener);</div><div class="line">        <span class="keyword">if</span> (code != ErrorCode.SUCCESS) &#123;</div><div class="line">            Toast.makeText(mContext, <span class="string">"语音合成失败,错误码: "</span> + code, Toast.LENGTH_SHORT).show();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 合成回调监听。</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> SynthesizerListener mTtsListener = <span class="keyword">new</span> SynthesizerListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSpeakBegin</span><span class="params">()</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"开始合成"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSpeakPaused</span><span class="params">()</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"暂停合成"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSpeakResumed</span><span class="params">()</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"继续合成"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBufferProgress</span><span class="params">(<span class="keyword">int</span> percent, <span class="keyword">int</span> beginPos, <span class="keyword">int</span> endPos, String info)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"传冲进度 ："</span> + percent);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSpeakProgress</span><span class="params">(<span class="keyword">int</span> percent, <span class="keyword">int</span> beginPos, <span class="keyword">int</span> endPos)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"合成进度 ： "</span> + percent);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">(SpeechError error)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (error == <span class="keyword">null</span>) &#123;</div><div class="line">                Log.i(TAG, <span class="string">"合成完成"</span>);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error != <span class="keyword">null</span>) &#123;</div><div class="line">                Log.i(TAG, <span class="string">"error : "</span> + error.toString());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(<span class="keyword">int</span> arg0, <span class="keyword">int</span> arg1, <span class="keyword">int</span> arg2, Bundle arg3)</span> </span>&#123;</div><div class="line">            <span class="comment">// TODO Auto-generated method stub</span></div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 参数设置</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setParam</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 清空参数</span></div><div class="line">        mTts.setParameter(SpeechConstant.PARAMS, <span class="keyword">null</span>);</div><div class="line">        <span class="comment">// 设置使用本地引擎</span></div><div class="line">        mTts.setParameter(SpeechConstant.ENGINE_TYPE, SpeechConstant.TYPE_LOCAL);</div><div class="line">        <span class="comment">// 设置发音人资源路径</span></div><div class="line">        mTts.setParameter(ResourceUtil.TTS_RES_PATH, getResourcePath());</div><div class="line">        <span class="comment">// 设置发音人</span></div><div class="line">        mTts.setParameter(SpeechConstant.VOICE_NAME, <span class="string">"xiaoyan"</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 设置语速</span></div><div class="line">        mTts.setParameter(SpeechConstant.SPEED, <span class="string">"50"</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 设置音调</span></div><div class="line">        mTts.setParameter(SpeechConstant.PITCH, <span class="string">"50"</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 设置音量</span></div><div class="line">        mTts.setParameter(SpeechConstant.VOLUME, <span class="string">"50"</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 设置播放器音频流类型</span></div><div class="line">        mTts.setParameter(SpeechConstant.STREAM_TYPE, <span class="string">"3"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 获取发音人资源路径</span></div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getResourcePath</span><span class="params">()</span> </span>&#123;</div><div class="line">        StringBuffer tempBuffer = <span class="keyword">new</span> StringBuffer();</div><div class="line">        <span class="comment">// 合成通用资源</span></div><div class="line">        tempBuffer.append(ResourceUtil.generateResourcePath(mContext, RESOURCE_TYPE.assets, <span class="string">"tts/common.jet"</span>));</div><div class="line">        tempBuffer.append(<span class="string">";"</span>);</div><div class="line">        <span class="comment">// 发音人资源</span></div><div class="line">        tempBuffer.append(ResourceUtil.generateResourcePath(mContext, RESOURCE_TYPE.assets, <span class="string">"tts/xiaoyan.jet"</span>));</div><div class="line">        <span class="keyword">return</span> tempBuffer.toString();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.kongqw.kqwspeechcompounddemo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Activity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.EditText;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.example.kongqw.kqwspeechcompounddemo.engine.KqwSpeechSynthesizer;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> EditText mEtText;</div><div class="line">    <span class="keyword">private</span> KqwSpeechSynthesizer mKqwSpeechSynthesizer;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        mEtText = (EditText) findViewById(R.id.et_text);</div><div class="line"></div><div class="line">        <span class="comment">// 初始化语音合成对象</span></div><div class="line">        mKqwSpeechSynthesizer = <span class="keyword">new</span> KqwSpeechSynthesizer(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 开始合成</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> view</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"开始合成 : "</span> + mEtText.getText().toString().trim(), Toast.LENGTH_SHORT).show();</div><div class="line">        mKqwSpeechSynthesizer.start(mEtText.getText().toString().trim());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="XML页面布局"><a href="#XML页面布局" class="headerlink" title="XML页面布局"></a>XML页面布局</h1><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;RelativeLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    android:layout_width=<span class="string">"match_parent"</span></div><div class="line">    android:layout_height=<span class="string">"match_parent"</span></div><div class="line">    android:paddingBottom=<span class="string">"@dimen/activity_vertical_margin"</span></div><div class="line">    android:paddingLeft=<span class="string">"@dimen/activity_horizontal_margin"</span></div><div class="line">    android:paddingRight=<span class="string">"@dimen/activity_horizontal_margin"</span></div><div class="line">    android:paddingTop=<span class="string">"@dimen/activity_vertical_margin"</span></div><div class="line">    tools:context=<span class="string">".MainActivity"</span>&gt;</div><div class="line"></div><div class="line">    &lt;EditText</div><div class="line">        android:id=<span class="string">"@+id/et_text"</span></div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">        android:hint=<span class="string">"语音合成的内容"</span></div><div class="line">        android:textSize=<span class="string">"20dp"</span> /&gt;</div><div class="line"></div><div class="line">    &lt;Button</div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">        android:layout_below=<span class="string">"@+id/et_text"</span></div><div class="line">        android:gravity=<span class="string">"center"</span></div><div class="line">        android:onClick=<span class="string">"start"</span></div><div class="line">        android:text=<span class="string">"语音合成"</span></div><div class="line">        android:textSize=<span class="string">"20dp"</span> /&gt;</div><div class="line"></div><div class="line">&lt;/RelativeLayout&gt;</div></pre></td></tr></table></figure>
<h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>因为我用的是离线资源包，试用期是有35天并且只有3个装机量，所以如果直接使用我的demo可能会有问题，如果要自己再创建一个工程，千万不要忘记替换APPID、库、离线资源。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/30/2015-08-30-科大讯飞语义识别/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/30/2015-08-30-科大讯飞语义识别/" itemprop="url">科大讯飞语义识别</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-30T18:00:28+08:00">
                2015-08-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/语音/" itemprop="url" rel="index">
                    <span itemprop="name">语音</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/08/30/2015-08-30-科大讯飞语义识别/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/08/30/2015-08-30-科大讯飞语义识别/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20150830192344935" alt="效果图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="http://download.csdn.net/detail/q4878802/9064463" target="_blank" rel="external">下载地址（Android Studio工程）：http://download.csdn.net/detail/q4878802/9064463</a></p>
<h1 id="语义测试接口"><a href="#语义测试接口" class="headerlink" title="语义测试接口"></a>语义测试接口</h1><p><a href="http://osp.voicecloud.cn/index.php/default/quicktest/index" target="_blank" rel="external">地址：http://osp.voicecloud.cn/index.php/default/quicktest/index</a></p>
<p><img src="http://img.blog.csdn.net/20150830192012967" alt="测试接口"></p>
<h1 id="开通服务，下载SDK"><a href="#开通服务，下载SDK" class="headerlink" title="开通服务，下载SDK"></a>开通服务，下载SDK</h1><p>之前已经介绍过，<a href="http://blog.csdn.net/q4878802/article/details/47762169#t8" target="_blank" rel="external">地址：http://blog.csdn.net/q4878802/article/details/47762169#t8</a></p>
<p>这里说一下，进入到SDK的下载界面，你发现找不到语义的服务，而在我们开通服务的时候都是默认就帮我们把语义的服务开启了，可能是因为语义是只能用网络的，没有本地的资源，所以只要选择一个在线的功能，使用的jar包应该都是一样的，为什么没有直接下载语义的SDK我也不是很清楚，但是都可以用。</p>
<h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>之前的工程都是在Eclipse下演示的，随着Android Studio的普及，我这里也开始使用Android Studio写Demo，虽然导入jar包和so库的过程可能不太一样，但是整体的流程是一样的。</p>
<h1 id="将jar包和so库导入Android-Studio工程"><a href="#将jar包和so库导入Android-Studio工程" class="headerlink" title="将jar包和so库导入Android Studio工程"></a>将jar包和so库导入Android Studio工程</h1><blockquote>
<p>将jar包copy到libs目录下</p>
<p>在main目录下创建jniLibs目录，将so文件copy过来</p>
</blockquote>
<p><img src="http://img.blog.csdn.net/20150830192037319" alt="将jar包copy到libs目录下"></p>
<h1 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h1><blockquote>
<p>在清单文件中application标签下添加name属性</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android:name=<span class="string">".InitApplication"</span></div></pre></td></tr></table></figure>
<p>初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.kongqw.kqwunderstanddemo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Application;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechConstant;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechUtility;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Created by kongqw on 2015/8/29.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InitApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"InitApplication"</span>, Toast.LENGTH_LONG).show();</div><div class="line">        <span class="comment">// 应用程序入口处调用,避免手机内存过小,杀死后台进程后通过历史intent进入Activity造成SpeechUtility对象为null</span></div><div class="line">        <span class="comment">// 如在Application中调用初始化，需要在Mainifest中注册该Applicaiton</span></div><div class="line">        <span class="comment">// 注意：此接口在非主进程调用会返回null对象，如需在非主进程使用语音功能，请增加参数：SpeechConstant.FORCE_LOGIN+"=true"</span></div><div class="line">        <span class="comment">// 参数间使用“,”分隔。</span></div><div class="line">        <span class="comment">// 设置你申请的应用appid</span></div><div class="line">        StringBuffer param = <span class="keyword">new</span> StringBuffer();</div><div class="line">        param.append(<span class="string">"appid=55d33f09"</span>);</div><div class="line">        param.append(<span class="string">","</span>);</div><div class="line">        param.append(SpeechConstant.ENGINE_MODE + <span class="string">"="</span> + SpeechConstant.MODE_MSC);</div><div class="line">        <span class="comment">// param.append(",");</span></div><div class="line">        <span class="comment">// param.append(SpeechConstant.FORCE_LOGIN + "=true");</span></div><div class="line">        SpeechUtility.createUtility(InitApplication.<span class="keyword">this</span>, param.toString());</div><div class="line"></div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="语义理解工具类"><a href="#语义理解工具类" class="headerlink" title="语义理解工具类"></a>语义理解工具类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.kongqw.kqwunderstanddemo.engine;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.text.TextUtils;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.ErrorCode;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.InitListener;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechError;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.TextUnderstander;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.TextUnderstanderListener;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.UnderstanderResult;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 科大讯飞语义理解</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> kongqw</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">KqwUnderstander</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">result</span><span class="params">(String json)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">// 上下文</span></div><div class="line">    <span class="keyword">private</span> Context mContext;</div><div class="line">    <span class="comment">// Log标记</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"KqwUnderstander"</span>;</div><div class="line">    <span class="comment">// 语义理解对象（文本到语义）。</span></div><div class="line">    <span class="keyword">private</span> TextUnderstander mTextUnderstander;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 构造方法</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">KqwUnderstander</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="comment">// 上下文</span></div><div class="line">        mContext = context;</div><div class="line"></div><div class="line">        <span class="comment">// 初始化语义理解对象</span></div><div class="line">        mTextUnderstander = TextUnderstander.createTextUnderstander(context, textUnderstanderListener);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// TODO  返回科大讯飞返回Json的实体类的对象</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">textUnderstander</span><span class="params">(String text)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mTextUnderstander.isUnderstanding()) &#123;</div><div class="line">            mTextUnderstander.cancel();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">int</span> ret = mTextUnderstander.understandText(text, textListener);</div><div class="line">            <span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</div><div class="line">                Toast.makeText(mContext, <span class="string">"语义理解失败,错误码:"</span> + ret, Toast.LENGTH_SHORT).show();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 初始化监听器（文本到语义）。</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> InitListener textUnderstanderListener = <span class="keyword">new</span> InitListener() &#123;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onInit</span><span class="params">(<span class="keyword">int</span> code)</span> </span>&#123;</div><div class="line">            Log.d(TAG, <span class="string">"textUnderstanderListener init() code = "</span> + code);</div><div class="line">            <span class="keyword">if</span> (code != ErrorCode.SUCCESS) &#123;</div><div class="line">                Toast.makeText(mContext, <span class="string">"初始化失败,错误码："</span> + code, Toast.LENGTH_SHORT).show();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> TextUnderstanderListener textListener = <span class="keyword">new</span> TextUnderstanderListener() &#123;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResult</span><span class="params">(<span class="keyword">final</span> UnderstanderResult result)</span> </span>&#123;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != result) &#123;</div><div class="line">                <span class="comment">// 显示</span></div><div class="line">                Log.d(TAG, <span class="string">"understander result："</span> + result.getResultString());</div><div class="line">                <span class="comment">// Toast.makeText(mContext, "understander result：" + result.getResultString(), Toast.LENGTH_SHORT).show();</span></div><div class="line">                String text = result.getResultString();</div><div class="line">                <span class="keyword">if</span> (!TextUtils.isEmpty(text)) &#123;</div><div class="line">                    result(text);</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                Log.d(TAG, <span class="string">"understander result:null"</span>);</div><div class="line">                Toast.makeText(mContext, <span class="string">"识别结果不正确。"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(SpeechError error)</span> </span>&#123;</div><div class="line">            Toast.makeText(mContext, <span class="string">"onError Code："</span> + error.getErrorCode(), Toast.LENGTH_SHORT).show();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.kongqw.kqwunderstanddemo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Activity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.EditText;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.example.kongqw.kqwunderstanddemo.engine.KqwUnderstander;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> EditText mEtText;</div><div class="line">    <span class="keyword">private</span> KqwUnderstander mKqwUnderstander;</div><div class="line">    <span class="keyword">private</span> TextView mTvShow;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        mEtText = (EditText) findViewById(R.id.et_text);</div><div class="line"></div><div class="line">        mTvShow = (TextView) findViewById(R.id.tv_show);</div><div class="line"></div><div class="line">        <span class="comment">// 初始化语音合成对象</span></div><div class="line">        mKqwUnderstander = <span class="keyword">new</span> KqwUnderstander(<span class="keyword">this</span>) &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">result</span><span class="params">(String json)</span> </span>&#123;</div><div class="line">                mTvShow.setText(json);</div><div class="line">                <span class="comment">// Toast.makeText(MainActivity.this, "json = " + json, Toast.LENGTH_SHORT).show();</span></div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 语义理解</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> view</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"语义理解 : "</span> + mEtText.getText().toString().trim(), Toast.LENGTH_SHORT).show();</div><div class="line">        mKqwUnderstander.textUnderstander(mEtText.getText().toString().trim());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="XML页面布局"><a href="#XML页面布局" class="headerlink" title="XML页面布局"></a>XML页面布局</h1><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">&lt;RelativeLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    android:layout_width=<span class="string">"match_parent"</span></div><div class="line">    android:layout_height=<span class="string">"match_parent"</span></div><div class="line">    android:paddingBottom=<span class="string">"@dimen/activity_vertical_margin"</span></div><div class="line">    android:paddingLeft=<span class="string">"@dimen/activity_horizontal_margin"</span></div><div class="line">    android:paddingRight=<span class="string">"@dimen/activity_horizontal_margin"</span></div><div class="line">    android:paddingTop=<span class="string">"@dimen/activity_vertical_margin"</span></div><div class="line">    tools:context=<span class="string">".MainActivity"</span>&gt;</div><div class="line"></div><div class="line">    &lt;EditText</div><div class="line">        android:id=<span class="string">"@+id/et_text"</span></div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">        android:text=<span class="string">"上帝到西二旗怎么走"</span></div><div class="line">        android:textSize=<span class="string">"20dp"</span> /&gt;</div><div class="line"></div><div class="line">    &lt;Button</div><div class="line">        android:id=<span class="string">"@+id/button"</span></div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">        android:layout_below=<span class="string">"@+id/et_text"</span></div><div class="line">        android:gravity=<span class="string">"center"</span></div><div class="line">        android:onClick=<span class="string">"start"</span></div><div class="line">        android:text=<span class="string">"语义理解"</span></div><div class="line">        android:textSize=<span class="string">"20dp"</span> /&gt;</div><div class="line"></div><div class="line">    &lt;ScrollView</div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"match_parent"</span></div><div class="line">        android:layout_below=<span class="string">"@+id/button"</span>&gt;</div><div class="line"></div><div class="line">        &lt;TextView</div><div class="line">            android:id=<span class="string">"@+id/tv_show"</span></div><div class="line">            android:layout_width=<span class="string">"match_parent"</span></div><div class="line">            android:layout_height=<span class="string">"match_parent"</span> /&gt;</div><div class="line">    &lt;/ScrollView&gt;</div><div class="line">&lt;/RelativeLayout&gt;</div></pre></td></tr></table></figure>
<h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><p>在使用语义之前一定要开通对应的语义场景</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/29/2015-08-29-科大讯飞在线语音合成/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/29/2015-08-29-科大讯飞在线语音合成/" itemprop="url">科大讯飞在线语音合成</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-29T18:19:12+08:00">
                2015-08-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/语音/" itemprop="url" rel="index">
                    <span itemprop="name">语音</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/08/29/2015-08-29-科大讯飞在线语音合成/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/08/29/2015-08-29-科大讯飞在线语音合成/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20150829221013499" alt="效果图"><br><img src="http://img.blog.csdn.net/20150829221023070" alt="效果图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="http://download.csdn.net/detail/q4878802/9062261" target="_blank" rel="external">下载地址（Android Studio工程）：http://download.csdn.net/detail/q4878802/9062261</a></p>
<h1 id="下载SDK"><a href="#下载SDK" class="headerlink" title="下载SDK"></a>下载SDK</h1><h2 id="1-选择服务"><a href="#1-选择服务" class="headerlink" title="1. 选择服务"></a>1. 选择服务</h2><p><img src="http://img.blog.csdn.net/20150829221039284" alt="选择服务"></p>
<h2 id="2-选择平台"><a href="#2-选择平台" class="headerlink" title="2. 选择平台"></a>2. 选择平台</h2><p><img src="http://img.blog.csdn.net/20150829221049027" alt="选择平台"></p>
<h2 id="3-选择应用"><a href="#3-选择应用" class="headerlink" title="3. 选择应用"></a>3. 选择应用</h2><p><img src="http://img.blog.csdn.net/20150829221100011" alt="选择应用"></p>
<h2 id="4-下载SDK"><a href="#4-下载SDK" class="headerlink" title="4. 下载SDK"></a>4. 下载SDK</h2><h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>之前的工程都是在Eclipse下演示的，随着Android Studio的普及，我这里也开始使用Android Studio写Demo，虽然细节导入jar包和so库的过程可能不太一样，但是整体的流程是一样的。</p>
<h1 id="将jar包和so库导入Android-Studio工程"><a href="#将jar包和so库导入Android-Studio工程" class="headerlink" title="将jar包和so库导入Android Studio工程"></a>将jar包和so库导入Android Studio工程</h1><p>将jar包copy到libs目录下<br>在main目录下创建jniLibs目录，将so文件copy过来</p>
<p><img src="http://img.blog.csdn.net/20150829221123212" alt="导入SDK"></p>
<h1 id="添加网络权限"><a href="#添加网络权限" class="headerlink" title="添加网络权限"></a>添加网络权限</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_NETWORK_STATE"</span> /&gt;</div><div class="line">&lt;uses-permission android:name=<span class="string">"android.permission.INTERNET"</span>/&gt;</div></pre></td></tr></table></figure>
<h1 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h1><p>在清单文件中application标签下添加name属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android:name=<span class="string">".InitApplication"</span></div></pre></td></tr></table></figure>
<p>初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.kongqw.kqwspeechcompounddemo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Application;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechConstant;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechUtility;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Created by kongqw on 2015/8/29.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InitApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"InitApplication"</span>, Toast.LENGTH_LONG).show();</div><div class="line">        <span class="comment">// 应用程序入口处调用,避免手机内存过小,杀死后台进程后通过历史intent进入Activity造成SpeechUtility对象为null</span></div><div class="line">        <span class="comment">// 如在Application中调用初始化，需要在Mainifest中注册该Applicaiton</span></div><div class="line">        <span class="comment">// 注意：此接口在非主进程调用会返回null对象，如需在非主进程使用语音功能，请增加参数：SpeechConstant.FORCE_LOGIN+"=true"</span></div><div class="line">        <span class="comment">// 参数间使用“,”分隔。</span></div><div class="line">        <span class="comment">// 设置你申请的应用appid</span></div><div class="line">        StringBuffer param = <span class="keyword">new</span> StringBuffer();</div><div class="line">        param.append(<span class="string">"appid=55d33f09"</span>);</div><div class="line">        param.append(<span class="string">","</span>);</div><div class="line">        param.append(SpeechConstant.ENGINE_MODE + <span class="string">"="</span> + SpeechConstant.MODE_MSC);</div><div class="line">        <span class="comment">// param.append(",");</span></div><div class="line">        <span class="comment">// param.append(SpeechConstant.FORCE_LOGIN + "=true");</span></div><div class="line">        SpeechUtility.createUtility(InitApplication.<span class="keyword">this</span>, param.toString());</div><div class="line"></div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="语音合成工具类"><a href="#语音合成工具类" class="headerlink" title="语音合成工具类"></a>语音合成工具类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.kongqw.kqwspeechcompounddemo.engine;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.text.TextUtils;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.ErrorCode;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.InitListener;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechConstant;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechError;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechSynthesizer;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SynthesizerListener;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 语音合成的类 发音人明细http://bbs.xfyun.cn/forum.php?mod=viewthread&amp;tid=367</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> kongqw</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KqwSpeechCompound</span> </span>&#123;</div><div class="line">    <span class="comment">// Log标签</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"KqwSpeechCompound"</span>;</div><div class="line">    <span class="comment">// 上下文</span></div><div class="line">    <span class="keyword">private</span> Context mContext;</div><div class="line">    <span class="comment">// 语音合成对象</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SpeechSynthesizer mTts;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 发音人</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String[] COLOUD_VOICERS_ENTRIES = &#123;<span class="string">"小燕"</span>, <span class="string">"小宇"</span>, <span class="string">"凯瑟琳"</span>, <span class="string">"亨利"</span>, <span class="string">"玛丽"</span>, <span class="string">"小研"</span>, <span class="string">"小琪"</span>, <span class="string">"小峰"</span>, <span class="string">"小梅"</span>, <span class="string">"小莉"</span>, <span class="string">"小蓉"</span>, <span class="string">"小芸"</span>, <span class="string">"小坤"</span>, <span class="string">"小强 "</span>, <span class="string">"小莹"</span>,</div><div class="line">            <span class="string">"小新"</span>, <span class="string">"楠楠"</span>, <span class="string">"老孙"</span>,&#125;;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String[] COLOUD_VOICERS_VALUE = &#123;<span class="string">"xiaoyan"</span>, <span class="string">"xiaoyu"</span>, <span class="string">"catherine"</span>, <span class="string">"henry"</span>, <span class="string">"vimary"</span>, <span class="string">"vixy"</span>, <span class="string">"xiaoqi"</span>, <span class="string">"vixf"</span>, <span class="string">"xiaomei"</span>,</div><div class="line">            <span class="string">"xiaolin"</span>, <span class="string">"xiaorong"</span>, <span class="string">"xiaoqian"</span>, <span class="string">"xiaokun"</span>, <span class="string">"xiaoqiang"</span>, <span class="string">"vixying"</span>, <span class="string">"xiaoxin"</span>, <span class="string">"nannan"</span>, <span class="string">"vils"</span>,&#125;;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 构造方法</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">KqwSpeechCompound</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="comment">// 上下文</span></div><div class="line">        mContext = context;</div><div class="line">        <span class="comment">// 初始化合成对象</span></div><div class="line">        mTts = SpeechSynthesizer.createSynthesizer(mContext, <span class="keyword">new</span> InitListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onInit</span><span class="params">(<span class="keyword">int</span> code)</span> </span>&#123;</div><div class="line">                <span class="keyword">if</span> (code != ErrorCode.SUCCESS) &#123;</div><div class="line">                    Log.i(TAG, <span class="string">"初始化失败,错误码："</span> + code);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 开始合成</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> text</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">speaking</span><span class="params">(String text)</span> </span>&#123;</div><div class="line">        <span class="comment">// 非空判断</span></div><div class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(text)) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> code = mTts.startSpeaking(text, mTtsListener);</div><div class="line">        <span class="keyword">if</span> (code != ErrorCode.SUCCESS) &#123;</div><div class="line">            <span class="keyword">if</span> (code == ErrorCode.ERROR_COMPONENT_NOT_INSTALLED) &#123;</div><div class="line">                Toast.makeText(mContext, <span class="string">"没有安装语音+ code = "</span> + code, Toast.LENGTH_SHORT).show();</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                Toast.makeText(mContext, <span class="string">"语音合成失败,错误码: "</span> + code, Toast.LENGTH_SHORT).show();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">     * 停止语音播报</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">stopSpeaking</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 对象非空并且正在说话</span></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mTts &amp;&amp; mTts.isSpeaking()) &#123;</div><div class="line">            <span class="comment">// 停止说话</span></div><div class="line">            mTts.stopSpeaking();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 判断当前有没有说话</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSpeaking</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mTts) &#123;</div><div class="line">            <span class="keyword">return</span> mTts.isSpeaking();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 合成回调监听。</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> SynthesizerListener mTtsListener = <span class="keyword">new</span> SynthesizerListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSpeakBegin</span><span class="params">()</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"开始播放"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSpeakPaused</span><span class="params">()</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"暂停播放"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSpeakResumed</span><span class="params">()</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"继续播放"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBufferProgress</span><span class="params">(<span class="keyword">int</span> percent, <span class="keyword">int</span> beginPos, <span class="keyword">int</span> endPos, String info)</span> </span>&#123;</div><div class="line">            <span class="comment">// TODO 缓冲的进度</span></div><div class="line">            Log.i(TAG, <span class="string">"缓冲 : "</span> + percent);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSpeakProgress</span><span class="params">(<span class="keyword">int</span> percent, <span class="keyword">int</span> beginPos, <span class="keyword">int</span> endPos)</span> </span>&#123;</div><div class="line">            <span class="comment">// TODO 说话的进度</span></div><div class="line">            Log.i(TAG, <span class="string">"合成 : "</span> + percent);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">(SpeechError error)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (error == <span class="keyword">null</span>) &#123;</div><div class="line">                Log.i(TAG, <span class="string">"播放完成"</span>);</div><div class="line"></div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error != <span class="keyword">null</span>) &#123;</div><div class="line">                Log.i(TAG, error.getPlainDescription(<span class="keyword">true</span>));</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(<span class="keyword">int</span> eventType, <span class="keyword">int</span> arg1, <span class="keyword">int</span> arg2, Bundle obj)</span> </span>&#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 参数设置</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setParam</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 清空参数</span></div><div class="line">        mTts.setParameter(SpeechConstant.PARAMS, <span class="keyword">null</span>);</div><div class="line">        <span class="comment">// 引擎类型 网络</span></div><div class="line">        mTts.setParameter(SpeechConstant.ENGINE_TYPE, SpeechConstant.TYPE_CLOUD);</div><div class="line">        <span class="comment">// 设置发音人</span></div><div class="line">        mTts.setParameter(SpeechConstant.VOICE_NAME, COLOUD_VOICERS_VALUE[<span class="number">0</span>]);</div><div class="line">        <span class="comment">// 设置语速</span></div><div class="line">        mTts.setParameter(SpeechConstant.SPEED, <span class="string">"50"</span>);</div><div class="line">        <span class="comment">// 设置音调</span></div><div class="line">        mTts.setParameter(SpeechConstant.PITCH, <span class="string">"50"</span>);</div><div class="line">        <span class="comment">// 设置音量</span></div><div class="line">        mTts.setParameter(SpeechConstant.VOLUME, <span class="string">"100"</span>);</div><div class="line">        <span class="comment">// 设置播放器音频流类型</span></div><div class="line">        mTts.setParameter(SpeechConstant.STREAM_TYPE, <span class="string">"3"</span>);</div><div class="line"></div><div class="line">        <span class="comment">// mTts.setParameter(SpeechConstant.TTS_AUDIO_PATH, Environment.getExternalStorageDirectory() + "/KRobot/wavaudio.pcm");</span></div><div class="line">        <span class="comment">// 背景音乐  1有 0 无</span></div><div class="line">        <span class="comment">// mTts.setParameter("bgs", "1");</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.kongqw.kqwspeechcompounddemo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Activity;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.view.Menu;</div><div class="line"><span class="keyword">import</span> android.view.MenuItem;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.EditText;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.example.kongqw.kqwspeechcompounddemo.engine.KqwSpeechCompound;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> EditText mEtText;</div><div class="line">    <span class="keyword">private</span> KqwSpeechCompound mKqwSpeechCompound;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        mEtText = (EditText) findViewById(R.id.et_text);</div><div class="line"></div><div class="line">        <span class="comment">// 初始化语音合成对象</span></div><div class="line">        mKqwSpeechCompound = <span class="keyword">new</span> KqwSpeechCompound(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 开始合成</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> view</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"开始合成 : "</span> + mEtText.getText().toString().trim(), Toast.LENGTH_SHORT).show();</div><div class="line">        mKqwSpeechCompound.speaking(mEtText.getText().toString().trim());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="XML页面布局"><a href="#XML页面布局" class="headerlink" title="XML页面布局"></a>XML页面布局</h1><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;RelativeLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    android:layout_width=<span class="string">"match_parent"</span></div><div class="line">    android:layout_height=<span class="string">"match_parent"</span></div><div class="line">    android:paddingBottom=<span class="string">"@dimen/activity_vertical_margin"</span></div><div class="line">    android:paddingLeft=<span class="string">"@dimen/activity_horizontal_margin"</span></div><div class="line">    android:paddingRight=<span class="string">"@dimen/activity_horizontal_margin"</span></div><div class="line">    android:paddingTop=<span class="string">"@dimen/activity_vertical_margin"</span></div><div class="line">    tools:context=<span class="string">".MainActivity"</span>&gt;</div><div class="line"></div><div class="line">    &lt;EditText</div><div class="line">        android:id=<span class="string">"@+id/et_text"</span></div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">        android:hint=<span class="string">"语音合成的内容"</span></div><div class="line">        android:textSize=<span class="string">"20dp"</span> /&gt;</div><div class="line"></div><div class="line">    &lt;Button</div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">        android:layout_below=<span class="string">"@+id/et_text"</span></div><div class="line">        android:gravity=<span class="string">"center"</span></div><div class="line">        android:onClick=<span class="string">"start"</span></div><div class="line">        android:text=<span class="string">"语音合成"</span></div><div class="line">        android:textSize=<span class="string">"20dp"</span> /&gt;</div><div class="line">    </div><div class="line">&lt;/RelativeLayout&gt;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/21/2015-08-21-科大讯飞语音识别/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/21/2015-08-21-科大讯飞语音识别/" itemprop="url">科大讯飞语音识别</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-21T18:31:38+08:00">
                2015-08-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/语音/" itemprop="url" rel="index">
                    <span itemprop="name">语音</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/08/21/2015-08-21-科大讯飞语音识别/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/08/21/2015-08-21-科大讯飞语音识别/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="离线语音识别（语记）"><a href="#离线语音识别（语记）" class="headerlink" title="离线语音识别（语记）"></a>离线语音识别（语记）</h1><h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img src="http://img.blog.csdn.net/20150821144538468" alt="效果图"></p>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p>下载地址：<a href="http://download.csdn.net/detail/q4878802/9032149" target="_blank" rel="external">http://download.csdn.net/detail/q4878802/9032149</a></p>
<h2 id="下载语记并安装离线资源"><a href="#下载语记并安装离线资源" class="headerlink" title="下载语记并安装离线资源"></a>下载语记并安装离线资源</h2><p><img src="http://img.blog.csdn.net/20150821144800352" alt="下载语记并安装离线资源"></p>
<h2 id="集成"><a href="#集成" class="headerlink" title="集成"></a>集成</h2><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>在清单文件中<strong>application</strong>标签下添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android:name=<span class="string">"InitKqwSpeech"</span></div></pre></td></tr></table></figure>
<p>初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.kqwlocalspeechdemo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechConstant;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechUtility;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Application;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InitKqwSpeech</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// 应用程序入口处调用,避免手机内存过小,杀死后台进程后通过历史intent进入Activity造成SpeechUtility对象为null</span></div><div class="line">		<span class="comment">// 如在Application中调用初始化，需要在Mainifest中注册该Applicaiton</span></div><div class="line">		<span class="comment">// 注意：此接口在非主进程调用会返回null对象，如需在非主进程使用语音功能，请增加参数：SpeechConstant.FORCE_LOGIN+"=true"</span></div><div class="line">		<span class="comment">// 参数间使用“,”分隔。</span></div><div class="line">		<span class="comment">// 设置你申请的应用appid</span></div><div class="line">		StringBuffer param = <span class="keyword">new</span> StringBuffer();</div><div class="line">		param.append(<span class="string">"appid=55d33f09"</span>);</div><div class="line">		param.append(<span class="string">","</span>);</div><div class="line">		param.append(SpeechConstant.ENGINE_MODE + <span class="string">"="</span> + SpeechConstant.MODE_MSC);</div><div class="line">		<span class="comment">// param.append(",");</span></div><div class="line">		<span class="comment">// param.append(SpeechConstant.FORCE_LOGIN + "=true");</span></div><div class="line">		SpeechUtility.createUtility(InitKqwSpeech.<span class="keyword">this</span>, param.toString());</div><div class="line"></div><div class="line">		<span class="keyword">super</span>.onCreate();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="语音听写工具类"><a href="#语音听写工具类" class="headerlink" title="语音听写工具类"></a>语音听写工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.kqwlocalspeechdemo.engine;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.example.kqwlocalspeechdemo.utils.JsonUtils;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.ErrorCode;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.InitListener;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.RecognizerListener;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.RecognizerResult;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechConstant;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechError;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechRecognizer;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">KqwSpeechRecognizer</span> </span>&#123;</div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * 初始化的回调</span></div><div class="line"><span class="comment">	 * </span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> flag</span></div><div class="line"><span class="comment">	 *            true 初始化成功 false 初始化失败</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">initListener</span><span class="params">(<span class="keyword">boolean</span> flag)</span></span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">resultData</span><span class="params">(String data)</span></span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">speechLog</span><span class="params">(String log)</span></span>;</div><div class="line"></div><div class="line">	<span class="comment">// 语音听写对象</span></div><div class="line">	<span class="keyword">private</span> SpeechRecognizer mIat;</div><div class="line">	<span class="comment">// TAG标签</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String TAG = <span class="string">"KqwSpeechRecognizer"</span>;</div><div class="line">	<span class="comment">// 上下文</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Context mContext;	</div><div class="line"></div><div class="line">	<span class="comment">// SharedPreferences</span></div><div class="line">	<span class="comment">// private SharedPreferences mSharedPreferences;</span></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">KqwSpeechRecognizer</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">		<span class="comment">// 获取上下文</span></div><div class="line">		mContext = context;</div><div class="line">		<span class="comment">// 初始化识别对象</span></div><div class="line">		mIat = SpeechRecognizer.createRecognizer(context, <span class="keyword">new</span> InitListener() &#123;</div><div class="line"></div><div class="line">			<span class="meta">@Override</span></div><div class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onInit</span><span class="params">(<span class="keyword">int</span> code)</span> </span>&#123;</div><div class="line">				Log.d(TAG, <span class="string">"SpeechRecognizer init() code = "</span> + code);</div><div class="line">				<span class="keyword">if</span> (code != ErrorCode.SUCCESS) &#123;</div><div class="line">					initListener(<span class="keyword">false</span>);</div><div class="line">					Toast.makeText(mContext, <span class="string">"初始化失败,错误码："</span> + code, Toast.LENGTH_SHORT).show();</div><div class="line">				&#125; <span class="keyword">else</span> &#123;</div><div class="line">					initListener(<span class="keyword">true</span>);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * 开始录音</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startListening</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// 设置参数</span></div><div class="line">		setParam();</div><div class="line">		<span class="comment">// 不显示听写对话框</span></div><div class="line">		<span class="keyword">int</span> ret = mIat.startListening(recognizerListener);</div><div class="line">		<span class="keyword">if</span> (ret != ErrorCode.SUCCESS) &#123;</div><div class="line">			Toast.makeText(mContext, <span class="string">"听写失败,错误码："</span> + ret, Toast.LENGTH_SHORT).show();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * 停止录音并获取录入的文字</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">null</span> != mIat) &#123;</div><div class="line">			<span class="comment">// mIat.cancel();</span></div><div class="line">			mIat.stopListening();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * 听写监听器。</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="keyword">private</span> RecognizerListener recognizerListener = <span class="keyword">new</span> RecognizerListener() &#123;</div><div class="line"></div><div class="line">		StringBuffer resultText;</div><div class="line"></div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBeginOfSpeech</span><span class="params">()</span> </span>&#123;</div><div class="line">			speechLog(<span class="string">"开始说话"</span>);</div><div class="line">			Log.i(TAG, <span class="string">"开始说话"</span>);</div><div class="line">			resultText = <span class="keyword">new</span> StringBuffer();</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(SpeechError error)</span> </span>&#123;</div><div class="line">			Log.i(TAG, error.getPlainDescription(<span class="keyword">true</span>));</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEndOfSpeech</span><span class="params">()</span> </span>&#123;</div><div class="line">			speechLog(<span class="string">"结束说话"</span>);</div><div class="line">			Log.i(TAG, <span class="string">"结束说话"</span>);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResult</span><span class="params">(RecognizerResult results, <span class="keyword">boolean</span> isLast)</span> </span>&#123;</div><div class="line">			Log.d(TAG, results.getResultString());</div><div class="line">			String text = JsonUtils.parseIatResult(results.getResultString());</div><div class="line">			resultText.append(text);</div><div class="line">			<span class="keyword">if</span> (isLast) &#123;</div><div class="line">				<span class="comment">// 最后的结果</span></div><div class="line">				resultData(resultText.toString().trim());</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onVolumeChanged</span><span class="params">(<span class="keyword">int</span> volume, <span class="keyword">byte</span>[] data)</span> </span>&#123;</div><div class="line">			speechLog(<span class="string">"当前正在说话，音量大小："</span> + volume);</div><div class="line">			Log.i(TAG, <span class="string">"当前正在说话，音量大小："</span> + volume);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(<span class="keyword">int</span> eventType, <span class="keyword">int</span> arg1, <span class="keyword">int</span> arg2, Bundle obj)</span> </span>&#123;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">	&#125;;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * 参数设置</span></div><div class="line"><span class="comment">	 * </span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> param</span></div><div class="line"><span class="comment">	 * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParam</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// 清空参数</span></div><div class="line">		mIat.setParameter(SpeechConstant.PARAMS, <span class="keyword">null</span>);</div><div class="line">		<span class="comment">// 设置听写引擎</span></div><div class="line">		mIat.setParameter(SpeechConstant.ENGINE_TYPE, SpeechConstant.TYPE_CLOUD);</div><div class="line">		<span class="comment">// 设置返回结果格式</span></div><div class="line">		mIat.setParameter(SpeechConstant.RESULT_TYPE, <span class="string">"json"</span>);</div><div class="line">		<span class="comment">// 设置语言</span></div><div class="line">		mIat.setParameter(SpeechConstant.LANGUAGE, <span class="string">"zh_cn"</span>);</div><div class="line">		<span class="comment">// 设置语言区域</span></div><div class="line">		mIat.setParameter(SpeechConstant.ACCENT, <span class="string">"zh_cn"</span>);</div><div class="line">		<span class="comment">// 设置语音前端点</span></div><div class="line">		mIat.setParameter(SpeechConstant.VAD_BOS, <span class="string">"4000"</span>);</div><div class="line">		<span class="comment">// 设置语音后端点</span></div><div class="line">		mIat.setParameter(SpeechConstant.VAD_EOS, <span class="string">"1000"</span>);</div><div class="line">		<span class="comment">// 设置标点符号</span></div><div class="line">		mIat.setParameter(SpeechConstant.ASR_PTT, <span class="string">"1"</span>);</div><div class="line">		<span class="comment">// 设置音频保存路径</span></div><div class="line">		<span class="comment">// mIat.setParameter(SpeechConstant.ASR_AUDIO_PATH,</span></div><div class="line">		<span class="comment">// Environment.getExternalStorageDirectory() + "/iflytek/wavaudio.pcm");</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.kqwlocalspeechdemo.utils;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.json.JSONArray;</div><div class="line"><span class="keyword">import</span> org.json.JSONObject;</div><div class="line"><span class="keyword">import</span> org.json.JSONTokener;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonUtils</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">parseIatResult</span><span class="params">(String json)</span> </span>&#123;</div><div class="line">		StringBuffer ret = <span class="keyword">new</span> StringBuffer();</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			JSONTokener tokener = <span class="keyword">new</span> JSONTokener(json);</div><div class="line">			JSONObject joResult = <span class="keyword">new</span> JSONObject(tokener);</div><div class="line"></div><div class="line">			JSONArray words = joResult.getJSONArray(<span class="string">"ws"</span>);</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; words.length(); i++) &#123;</div><div class="line">				<span class="comment">// 转写结果词，默认使用第一个结果</span></div><div class="line">				JSONArray items = words.getJSONObject(i).getJSONArray(<span class="string">"cw"</span>);</div><div class="line">				JSONObject obj = items.getJSONObject(<span class="number">0</span>);</div><div class="line">				ret.append(obj.getString(<span class="string">"w"</span>));</div><div class="line">				<span class="comment">// 如果需要多候选结果，解析数组其他字段</span></div><div class="line">				<span class="comment">// for(int j = 0; j &lt; items.length(); j++)</span></div><div class="line">				<span class="comment">// &#123;</span></div><div class="line">				<span class="comment">// JSONObject obj = items.getJSONObject(j);</span></div><div class="line">				<span class="comment">// ret.append(obj.getString("w"));</span></div><div class="line">				<span class="comment">// &#125;</span></div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> ret.toString();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.kqwlocalspeechdemo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.example.kqwlocalspeechdemo.engine.KqwSpeechRecognizer;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Activity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> TextView mTvResult;</div><div class="line">	<span class="keyword">private</span> TextView mTvLog;</div><div class="line">	<span class="keyword">private</span> KqwSpeechRecognizer mKqwSpeechRecognizer;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">		setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">		mTvResult = (TextView) findViewById(R.id.tv_result);</div><div class="line">		mTvLog = (TextView) findViewById(R.id.tv_log);</div><div class="line"></div><div class="line">		<span class="comment">// 初始化语音听写识别器</span></div><div class="line">		mKqwSpeechRecognizer = <span class="keyword">new</span> KqwSpeechRecognizer(<span class="keyword">this</span>) &#123;</div><div class="line"></div><div class="line">			<span class="meta">@Override</span></div><div class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">speechLog</span><span class="params">(String log)</span> </span>&#123;</div><div class="line">				mTvLog.setText(log);</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			<span class="meta">@Override</span></div><div class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">resultData</span><span class="params">(String data)</span> </span>&#123;</div><div class="line">				mTvResult.setText(data);</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			<span class="meta">@Override</span></div><div class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initListener</span><span class="params">(<span class="keyword">boolean</span> flag)</span> </span>&#123;</div><div class="line">				<span class="keyword">if</span>(flag)&#123;</div><div class="line">					Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"初始化成功"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">				&#125; <span class="keyword">else</span> &#123;</div><div class="line">					Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"初始化失败"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * 开始识别按钮</span></div><div class="line"><span class="comment">	 * </span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> view</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">		mTvResult.setText(<span class="keyword">null</span>);</div><div class="line">		<span class="comment">// 开始识别</span></div><div class="line">		mKqwSpeechRecognizer.startListening();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="页面布局"><a href="#页面布局" class="headerlink" title="页面布局"></a>页面布局</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">&lt;RelativeLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    android:layout_width=<span class="string">"match_parent"</span></div><div class="line">    android:layout_height=<span class="string">"match_parent"</span></div><div class="line">    android:paddingBottom=<span class="string">"@dimen/activity_vertical_margin"</span></div><div class="line">    android:paddingLeft=<span class="string">"@dimen/activity_horizontal_margin"</span></div><div class="line">    android:paddingRight=<span class="string">"@dimen/activity_horizontal_margin"</span></div><div class="line">    android:paddingTop=<span class="string">"@dimen/activity_vertical_margin"</span></div><div class="line">    tools:context=<span class="string">"com.example.kqwlocalspeechdemo.MainActivity"</span> &gt;</div><div class="line"></div><div class="line">    &lt;Button</div><div class="line">        android:id=<span class="string">"@+id/bt_start"</span></div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">        android:layout_alignParentBottom=<span class="string">"true"</span></div><div class="line">        android:onClick=<span class="string">"start"</span></div><div class="line">        android:text=<span class="string">"开始录音"</span> /&gt;</div><div class="line"></div><div class="line">    &lt;TextView</div><div class="line">        android:id=<span class="string">"@+id/tv_log"</span></div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">        android:layout_above=<span class="string">"@id/bt_start"</span></div><div class="line">        android:gravity=<span class="string">"center"</span></div><div class="line">        android:text=<span class="string">"录音信息"</span> /&gt;</div><div class="line"></div><div class="line">    &lt;ScrollView</div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"match_parent"</span></div><div class="line">        android:layout_above=<span class="string">"@id/tv_log"</span> &gt;</div><div class="line"></div><div class="line">        &lt;TextView</div><div class="line">            android:id=<span class="string">"@+id/tv_result"</span></div><div class="line">            android:layout_width=<span class="string">"match_parent"</span></div><div class="line">            android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">            android:text=<span class="string">"返回结果"</span> /&gt;</div><div class="line">    &lt;/ScrollView&gt;</div><div class="line"></div><div class="line">&lt;/RelativeLayout&gt;</div></pre></td></tr></table></figure>
<h1 id="在线语音识别"><a href="#在线语音识别" class="headerlink" title="在线语音识别"></a>在线语音识别</h1><p>在线语音听写和<a href="http://blog.csdn.net/q4878802/article/details/47834601" target="_blank" rel="external">离线语音听写</a>基本一样，只要修改一下识别引擎即可。（就可以不用语记了）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 设置听写引擎</span></div><div class="line">mIat.setParameter(SpeechConstant.ENGINE_TYPE, SpeechConstant.TYPE_CLOUD);</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/20/2015-08-20-科大讯飞离线命令词+语义识别/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/20/2015-08-20-科大讯飞离线命令词+语义识别/" itemprop="url">科大讯飞离线命令词+语义识别</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-20T18:46:11+08:00">
                2015-08-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/语音/" itemprop="url" rel="index">
                    <span itemprop="name">语音</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/08/20/2015-08-20-科大讯飞离线命令词+语义识别/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/08/20/2015-08-20-科大讯飞离线命令词+语义识别/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="离线命令词-语义识别"><a href="#离线命令词-语义识别" class="headerlink" title="离线命令词+语义识别"></a>离线命令词+语义识别</h1><p>意思就是先走离线命令词识别，如果离线命令词识别没有识别到结果，那么就再走语义接口，如果已开通对应场景，则转为语义，如果没有开通对应场景，则将语音转为文字</p>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><ul>
<li><strong>说的话满足本地构建的语法—-离线命令词识别</strong></li>
</ul>
<p><img src="http://img.blog.csdn.net/20150820135122158" alt="效果图"></p>
<ul>
<li><strong>说的话离线命令词无法识别，走语义识别并且满足语义场景—-将语音转为语义</strong></li>
</ul>
<p><img src="http://img.blog.csdn.net/20150820135140691" alt="效果图"></p>
<ul>
<li><strong>说话既不满足离线命令词识别也不满足语义开通的场景—-将语音转为文字</strong></li>
</ul>
<p><img src="http://img.blog.csdn.net/20150820135152206" alt="效果图"></p>
<p>程序和<strong>离线命令词识别</strong>基本一样</p>
<p><strong>离线命令词识别地址：<a href="http://blog.csdn.net/q4878802/article/details/47780485" target="_blank" rel="external">http://blog.csdn.net/q4878802/article/details/47780485</a></strong></p>
<p>只要改一个参数，将识别<strong>引擎改为混合模式</strong>即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mAsr.setParameter(SpeechConstant.ENGINE_TYPE, SpeechConstant.TYPE_MIX);</div></pre></td></tr></table></figure>
<p>因为使用的混合模式，当本地命令词没有识别到结果的时候会走在线语义（语义只有在线），所以，我们<strong>必须要先开通语义服务</strong></p>
<h1 id="程序流程"><a href="#程序流程" class="headerlink" title="程序流程"></a>程序流程</h1><p><img src="http://img.blog.csdn.net/20150820134211964" alt="流程图"></p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><ol>
<li>如果你直接用我的Demo，我用的是测试版的离线包，只有35天的试用期，而且装机量只有3个，如果大家都用，很可能是不能正常运行的</li>
<li>如果是参考我的demo自己写一个，千万不要忘记替换appid和资源文件。</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/19/2015-08-19-科大讯飞语音唤醒/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/19/2015-08-19-科大讯飞语音唤醒/" itemprop="url">科大讯飞语音唤醒</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-19T18:53:57+08:00">
                2015-08-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/语音/" itemprop="url" rel="index">
                    <span itemprop="name">语音</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/08/19/2015-08-19-科大讯飞语音唤醒/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/08/19/2015-08-19-科大讯飞语音唤醒/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="语音唤醒"><a href="#语音唤醒" class="headerlink" title="语音唤醒"></a>语音唤醒</h1><p>唤醒功能，顾名思义，通过语音，唤醒服务，做我们想做的事情。</p>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><blockquote>
<p>开启应用后说<strong>讯飞语音</strong>或者<strong>讯飞语点</strong>唤醒</p>
</blockquote>
<p><img src="http://img.blog.csdn.net/20150819120058258" alt="效果图"></p>
<h1 id="源码下载"><a href="#源码下载" class="headerlink" title="源码下载"></a>源码下载</h1><p><a href="http://download.csdn.net/detail/q4878802/9023213" target="_blank" rel="external">地址：http://download.csdn.net/detail/q4878802/9023213</a></p>
<h1 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h1><h2 id="1-创建应用，开通服务"><a href="#1-创建应用，开通服务" class="headerlink" title="1. 创建应用，开通服务"></a>1. 创建应用，开通服务</h2><p>地址：<a href="http://blog.csdn.net/q4878802/article/details/47762169" target="_blank" rel="external">http://blog.csdn.net/q4878802/article/details/47762169</a></p>
<h2 id="2-下载SDK"><a href="#2-下载SDK" class="headerlink" title="2. 下载SDK"></a>2. 下载SDK</h2><p>我们要使用的是讯飞的付费功能，选择唤醒服务，点击下载以后，会提示没有购买。点击“<strong>购买服务</strong>”</p>
<p><img src="http://img.blog.csdn.net/20150819120214697" alt="购买服务"></p>
<p>点击购买一会看到付费情况，有项目需要，就必须购买，我们写Demo，讯飞给提供了<strong>体验版的SDK</strong>，和正式版的没有功能上的区别，但是只能试用35天，装机量只有3个，唤醒词不能改，只有“<strong>讯飞语音</strong>”和“<strong>讯飞语点</strong>”两个唤醒词。</p>
<p><img src="http://img.blog.csdn.net/20150819120230403" alt="下载体验版SDK"></p>
<h2 id="3-解压SDK"><a href="#3-解压SDK" class="headerlink" title="3. 解压SDK"></a>3. 解压SDK</h2><p>assets目录下是一些图片资源文件<br>doc目录下是一些开发文档<br>libs目录下是一些jar包和so库<br>res目录下是语音的资源文件，非常重要<br>sample目录下是Demo</p>
<p><img src="http://img.blog.csdn.net/20150819120307098" alt="解压SDK"></p>
<h1 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h1><h2 id="1-添加权限"><a href="#1-添加权限" class="headerlink" title="1. 添加权限"></a>1. 添加权限</h2><p>这里用到的唤醒功能不是所有的权限都用到的，具体用到了哪些权限，可以看上面的链接，用到哪写权限就加哪些权限，这个为了快速方便测试，把讯飞用到的权限都加上了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:name=<span class="string">"android.permission.RECORD_AUDIO"</span> /&gt;</div><div class="line">&lt;uses-permission android:name=<span class="string">"android.permission.INTERNET"</span> /&gt;</div><div class="line">&lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_NETWORK_STATE"</span> /&gt;</div><div class="line">&lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_WIFI_STATE"</span> /&gt;</div><div class="line">&lt;uses-permission android:name=<span class="string">"android.permission.CHANGE_NETWORK_STATE"</span> /&gt;</div><div class="line">&lt;uses-permission android:name=<span class="string">"android.permission.READ_PHONE_STATE"</span> /&gt;</div><div class="line">&lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_FINE_LOCATION"</span> /&gt;</div><div class="line">&lt;uses-permission android:name=<span class="string">"android.permission.READ_CONTACTS"</span> /&gt;</div><div class="line">&lt;uses-permission android:name=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span> /&gt;</div></pre></td></tr></table></figure>
<h2 id="2-初始化appid"><a href="#2-初始化appid" class="headerlink" title="2. 初始化appid"></a>2. 初始化appid</h2><p>我是将appid的初始化放在的Applicaiton下，具体可以下载源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 应用程序入口处调用,避免手机内存过小,杀死后台进程后通过历史intent进入Activity造成SpeechUtility对象为null</span></div><div class="line"><span class="comment">// 如在Application中调用初始化，需要在Mainifest中注册该Applicaiton</span></div><div class="line"><span class="comment">// 注意：此接口在非主进程调用会返回null对象，如需在非主进程使用语音功能，请增加参数：SpeechConstant.FORCE_LOGIN+"=true"</span></div><div class="line"><span class="comment">// 参数间使用“,”分隔。</span></div><div class="line"><span class="comment">// 设置你申请的应用appid</span></div><div class="line">StringBuffer param = <span class="keyword">new</span> StringBuffer();</div><div class="line">param.append(<span class="string">"appid=55d33f09"</span>);</div><div class="line">param.append(<span class="string">","</span>);</div><div class="line">param.append(SpeechConstant.ENGINE_MODE + <span class="string">"="</span> + SpeechConstant.MODE_MSC);</div><div class="line"><span class="comment">// param.append(",");</span></div><div class="line"><span class="comment">// param.append(SpeechConstant.FORCE_LOGIN + "=true");</span></div><div class="line">SpeechUtility.createUtility(InitKqwSpeech.<span class="keyword">this</span>, param.toString());</div></pre></td></tr></table></figure>
<h2 id="3-工具类"><a href="#3-工具类" class="headerlink" title="3. 工具类"></a>3. 工具类</h2><p>初始化好了以后直接复制工具类就可以用了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.kqwspeechdemo.engine;</div><div class="line"><span class="keyword">import</span> org.json.JSONException;</div><div class="line"><span class="keyword">import</span> org.json.JSONObject;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechConstant;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechError;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.SpeechUtility;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.VoiceWakeuper;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.WakeuperListener;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.WakeuperResult;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.util.ResourceUtil;</div><div class="line"><span class="keyword">import</span> com.iflytek.cloud.util.ResourceUtil.RESOURCE_TYPE;</div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 语音唤醒</span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> kongqw</span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">KqwWake</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * 唤醒的回调</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">kqwWake</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">	<span class="comment">// Log标签</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"KqwWake"</span>;</div><div class="line"></div><div class="line">	<span class="comment">// 上下文</span></div><div class="line">	<span class="keyword">private</span> Context mContext;</div><div class="line">	<span class="comment">// 语音唤醒对象</span></div><div class="line">	<span class="keyword">private</span> VoiceWakeuper mIvw;</div><div class="line"></div><div class="line">	<span class="comment">/*</span></div><div class="line"><span class="comment">	 * TODO 设置门限值 ： 门限值越低越容易被唤醒，需要自己反复测试，根据不同的使用场景，设置一个比较合适的唤醒门限</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="comment">// private final static int MAX = 60;</span></div><div class="line">	<span class="comment">// private final static int MIN = -20;</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> curThresh = <span class="number">40</span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">KqwWake</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">		mContext = context;</div><div class="line"></div><div class="line">		<span class="comment">// 加载识唤醒地资源，resPath为本地识别资源路径</span></div><div class="line">		StringBuffer param = <span class="keyword">new</span> StringBuffer();</div><div class="line">		String resPath = ResourceUtil.generateResourcePath(context, RESOURCE_TYPE.assets, <span class="string">"ivw/55d33f09.jet"</span>);</div><div class="line">		param.append(ResourceUtil.IVW_RES_PATH + <span class="string">"="</span> + resPath);</div><div class="line">		param.append(<span class="string">","</span> + ResourceUtil.ENGINE_START + <span class="string">"="</span> + SpeechConstant.ENG_IVW);</div><div class="line">		<span class="keyword">boolean</span> ret = SpeechUtility.getUtility().setParameter(ResourceUtil.ENGINE_START, param.toString());</div><div class="line">		<span class="keyword">if</span> (!ret) &#123;</div><div class="line">			Log.d(TAG, <span class="string">"启动本地引擎失败！"</span>);</div><div class="line">		&#125;</div><div class="line">		<span class="comment">// 初始化唤醒对象</span></div><div class="line">		mIvw = VoiceWakeuper.createWakeuper(context, <span class="keyword">null</span>);</div><div class="line"></div><div class="line">	&#125;;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * 唤醒</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">wake</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// 非空判断，防止因空指针使程序崩溃</span></div><div class="line">		mIvw = VoiceWakeuper.getWakeuper();</div><div class="line">		<span class="keyword">if</span> (mIvw != <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="comment">// textView.setText(resultString);</span></div><div class="line">			<span class="comment">// 清空参数</span></div><div class="line">			mIvw.setParameter(SpeechConstant.PARAMS, <span class="keyword">null</span>);</div><div class="line">			<span class="comment">// 唤醒门限值，根据资源携带的唤醒词个数按照“id:门限;id:门限”的格式传入</span></div><div class="line">			mIvw.setParameter(SpeechConstant.IVW_THRESHOLD, <span class="string">"0:"</span> + curThresh);</div><div class="line">			<span class="comment">// 设置唤醒模式</span></div><div class="line">			mIvw.setParameter(SpeechConstant.IVW_SST, <span class="string">"wakeup"</span>);</div><div class="line">			<span class="comment">// 设置持续进行唤醒</span></div><div class="line">			mIvw.setParameter(SpeechConstant.KEEP_ALIVE, <span class="string">"1"</span>);</div><div class="line">			mIvw.startListening(mWakeuperListener);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			Toast.makeText(mContext, <span class="string">"唤醒未初始化"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopWake</span><span class="params">()</span> </span>&#123;</div><div class="line">		mIvw = VoiceWakeuper.getWakeuper();</div><div class="line">		<span class="keyword">if</span> (mIvw != <span class="keyword">null</span>) &#123;</div><div class="line">			mIvw.stopListening();</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			Toast.makeText(mContext, <span class="string">"唤醒未初始化"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	String resultString = <span class="string">""</span>;</div><div class="line">	<span class="keyword">private</span> WakeuperListener mWakeuperListener = <span class="keyword">new</span> WakeuperListener() &#123;</div><div class="line"></div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResult</span><span class="params">(WakeuperResult result)</span> </span>&#123;</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				String text = result.getResultString();</div><div class="line">				JSONObject object;</div><div class="line">				object = <span class="keyword">new</span> JSONObject(text);</div><div class="line">				StringBuffer buffer = <span class="keyword">new</span> StringBuffer();</div><div class="line">				buffer.append(<span class="string">"【RAW】 "</span> + text);</div><div class="line">				buffer.append(<span class="string">"\n"</span>);</div><div class="line">				buffer.append(<span class="string">"【操作类型】"</span> + object.optString(<span class="string">"sst"</span>));</div><div class="line">				buffer.append(<span class="string">"\n"</span>);</div><div class="line">				buffer.append(<span class="string">"【唤醒词id】"</span> + object.optString(<span class="string">"id"</span>));</div><div class="line">				buffer.append(<span class="string">"\n"</span>);</div><div class="line">				buffer.append(<span class="string">"【得分】"</span> + object.optString(<span class="string">"score"</span>));</div><div class="line">				buffer.append(<span class="string">"\n"</span>);</div><div class="line">				buffer.append(<span class="string">"【前端点】"</span> + object.optString(<span class="string">"bos"</span>));</div><div class="line">				buffer.append(<span class="string">"\n"</span>);</div><div class="line">				buffer.append(<span class="string">"【尾端点】"</span> + object.optString(<span class="string">"eos"</span>));</div><div class="line">				resultString = buffer.toString();</div><div class="line">				stopWake();</div><div class="line">				kqwWake();</div><div class="line">			&#125; <span class="keyword">catch</span> (JSONException e) &#123;</div><div class="line">				resultString = <span class="string">"结果解析出错"</span>;</div><div class="line">				e.printStackTrace();</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(SpeechError error)</span> </span>&#123;</div><div class="line">			Log.i(TAG, error.getPlainDescription(<span class="keyword">true</span>));</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBeginOfSpeech</span><span class="params">()</span> </span>&#123;</div><div class="line">			Log.i(TAG, <span class="string">"开始说话"</span>);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(<span class="keyword">int</span> eventType, <span class="keyword">int</span> isLast, <span class="keyword">int</span> arg2, Bundle obj)</span> </span>&#123;</div><div class="line"></div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.kqwspeechdemo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.example.kqwspeechdemo.engine.KqwWake;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Activity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> TextView mTvLog;</div><div class="line">	<span class="keyword">private</span> TextView mTvResult;</div><div class="line">	<span class="keyword">private</span> KqwWake kqwWake;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">		setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">		mTvLog = (TextView) findViewById(R.id.tv_log);</div><div class="line">		mTvResult = (TextView) findViewById(R.id.tv_result);</div><div class="line"></div><div class="line">		kqwWake = <span class="keyword">new</span> KqwWake(<span class="keyword">this</span>) &#123;</div><div class="line">			<span class="meta">@Override</span></div><div class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">kqwWake</span><span class="params">()</span> </span>&#123;</div><div class="line">				Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"Debug:\n唤醒成功"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">				<span class="comment">// 开启唤醒</span></div><div class="line">				kqwWake.wake();</div><div class="line">			&#125;</div><div class="line">		&#125;;</div><div class="line">		<span class="comment">// 开启唤醒</span></div><div class="line">		kqwWake.wake();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="页面布局"><a href="#页面布局" class="headerlink" title="页面布局"></a>页面布局</h2><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">&lt;LinearLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    android:layout_width=<span class="string">"match_parent"</span></div><div class="line">    android:layout_height=<span class="string">"match_parent"</span></div><div class="line">    android:orientation=<span class="string">"vertical"</span></div><div class="line">    tools:context=<span class="string">"com.example.kqwspeechdemo.MainActivity"</span> &gt;</div><div class="line"></div><div class="line">    &lt;TextView</div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">        android:background=<span class="string">"#FF000000"</span></div><div class="line">        android:gravity=<span class="string">"center"</span></div><div class="line">        android:padding=<span class="string">"10dp"</span></div><div class="line">        android:text=<span class="string">"唤醒词：讯飞语音、讯飞语点"</span></div><div class="line">        android:textColor=<span class="string">"#FFFFFFFF"</span></div><div class="line">        android:textSize=<span class="string">"20dp"</span> /&gt;</div><div class="line"></div><div class="line">    &lt;View</div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"1dp"</span></div><div class="line">        android:background=<span class="string">"#FFFFFFFF"</span> /&gt;</div><div class="line"></div><div class="line">    &lt;TextView</div><div class="line">        android:id=<span class="string">"@+id/tv_log"</span></div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">        android:background=<span class="string">"#FF000000"</span></div><div class="line">        android:gravity=<span class="string">"center"</span></div><div class="line">        android:padding=<span class="string">"10dp"</span></div><div class="line">        android:text=<span class="string">"录音信息"</span></div><div class="line">        android:textColor=<span class="string">"#FFFFFFFF"</span></div><div class="line">        android:textSize=<span class="string">"10dp"</span> /&gt;</div><div class="line"></div><div class="line">    &lt;View</div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"1dp"</span></div><div class="line">        android:background=<span class="string">"#FFFFFFFF"</span> /&gt;</div><div class="line"></div><div class="line">    &lt;TextView</div><div class="line">        android:id=<span class="string">"@+id/tv_result"</span></div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"match_parent"</span></div><div class="line">        android:background=<span class="string">"#FF000000"</span></div><div class="line">        android:padding=<span class="string">"10dp"</span></div><div class="line">        android:text=<span class="string">"返回结果"</span></div><div class="line">        android:textColor=<span class="string">"#FFFFFFFF"</span></div><div class="line">        android:textSize=<span class="string">"10dp"</span> /&gt;</div><div class="line"></div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><ol>
<li>如果你直接用我的Demo，我用的是测试版的离线包，只有35天的试用期，而且装机量只有3个，如果大家都用，很可能是不能正常运行的</li>
<li>如果是参考我的demo自己写一个，千万不要忘记替换appid和资源文件。</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="kongqw" />
          <p class="site-author-name" itemprop="name">kongqw</p>
           
              <p class="site-description motion-element" itemprop="description">Android Developer</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">51</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/kongqw" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.csdn.net/q4878802" target="_blank" title="CSDN">
                  
                    <i class="fa fa-fw fa-home"></i>
                  
                  CSDN
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://gank.io" title="干货集中营" target="_blank">干货集中营</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.xfyun.cn" title="讯飞开放平台" target="_blank">讯飞开放平台</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.easemob.com" title="环信" target="_blank">环信</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://tongji.baidu.com" title="百度统计" target="_blank">百度统计</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://kongqw.disqus.com/admin/" title="DISQUS评论" target="_blank">DISQUS评论</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://wallet.btc.com/" title="BTC Wallet" target="_blank">BTC Wallet</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.okcoin.cn/" title="OKCoin中国站" target="_blank">OKCoin中国站</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.okcoin.com/" title="OKCoin国际站" target="_blank">OKCoin国际站</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://btc.com/" title="BTC.com" target="_blank">BTC.com</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kongqw</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://kongqw.disqus.com/count.js" async></script>
    

    

  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
