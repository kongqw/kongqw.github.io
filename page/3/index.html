<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="Android Developer">
<meta property="og:type" content="website">
<meta property="og:title" content="孔庆威的博客">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="孔庆威的博客">
<meta property="og:description" content="Android Developer">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="孔庆威的博客">
<meta name="twitter:description" content="Android Developer">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/"/>





  <title>孔庆威的博客</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?e8ad05f02e13a412b09b2e8a632634af";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>











  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">孔庆威的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">精于心，简于形</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/26/2016-08-26-Android左右声道的控制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/26/2016-08-26-Android左右声道的控制/" itemprop="url">Android左右声道的控制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-26T15:36:50+08:00">
                2016-08-26
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/08/26/2016-08-26-Android左右声道的控制/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/08/26/2016-08-26-Android左右声道的控制/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20160826164630772" alt="效果图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="https://github.com/kongqw/AndroidSoundManagerDemo" target="_blank" rel="external">AndroidSoundManagerDemo</a></p>
<hr>
<p>我这里主要是用到了<a href="https://developer.android.com/reference/android/media/AudioTrack.html" target="_blank" rel="external">AudioTrack</a>实现的左右声道的控制，手机一般都只有两个声道，即左声道和右声道，我们在输出的时候可以选择单声道，也可以选择双声道（立体声）。</p>
<p>查看了<code>AudioTrack</code>的API，提供了<code>play()</code>、<code>pause()</code>、<code>stop()</code>、<code>write()</code>等一系列的方法。<br>通过<code>write()</code>方法，可以实现将音频数据发送出去（播放出来）。</p>
<h1 id="AudioTrack对象的构造"><a href="#AudioTrack对象的构造" class="headerlink" title="AudioTrack对象的构造"></a>AudioTrack对象的构造</h1><p>有三个构造方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">AudioTrack (<span class="keyword">int</span> streamType, <span class="keyword">int</span> sampleRateInHz, <span class="keyword">int</span> channelConfig, <span class="keyword">int</span> audioFormat, <span class="keyword">int</span> bufferSizeInBytes, <span class="keyword">int</span> mode)</div><div class="line">AudioTrack (<span class="keyword">int</span> streamType, <span class="keyword">int</span> sampleRateInHz, <span class="keyword">int</span> channelConfig, <span class="keyword">int</span> audioFormat, <span class="keyword">int</span> bufferSizeInBytes, <span class="keyword">int</span> mode, <span class="keyword">int</span> sessionId)</div><div class="line">AudioTrack (AudioAttributes attributes, AudioFormat format, <span class="keyword">int</span> bufferSizeInBytes, <span class="keyword">int</span> mode, <span class="keyword">int</span> sessionId)</div></pre></td></tr></table></figure>
<p>主要参数有如下几个</p>
<ul>
<li><p>streamType：以什么形式播放</p>
<ul>
<li>STREAM_VOICE_CALL</li>
<li>STREAM_SYSTEM</li>
<li>STREAM_RING</li>
<li>STREAM_MUSIC</li>
<li>STREAM_ALARM</li>
<li>STREAM_NOTIFICATION</li>
</ul>
</li>
<li><p>sampleRateInHz：采样率</p>
</li>
<li><p>channelConfig：声道</p>
<ul>
<li>AudioFormat.CHANNEL_OUT_MONO：输出单声道音频数据</li>
<li>AudioFormat.CHANNEL_OUT_STEREO：输出双声道音频数据（立体声）</li>
</ul>
</li>
<li><p>audioFormat：音频数据格式</p>
</li>
<li><p>mode：缓冲模式</p>
<ul>
<li>MODE_STATIC：一次性将音频载入以后再播放</li>
<li>MODE_STREAM：以流的形式，加载一点就播放一点</li>
</ul>
</li>
</ul>
<p>把channelConfig的相关参数都看了一遍，没发现有可以指定向某声道发送数据的，只能通过<code>AudioFormat.CHANNEL_OUT_MONO</code>和<code>AudioFormat.CHANNEL_OUT_STEREO</code>选择是输出单声道的音频数据还是双声道的音频数据。</p>
<h1 id="左右声道控制"><a href="#左右声道控制" class="headerlink" title="左右声道控制"></a>左右声道控制</h1><p>构造的时候不能选择指定声道输出音频，但是有这样一个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">setStereoVolume(<span class="keyword">float</span> leftGain, <span class="keyword">float</span> rightGain)</div></pre></td></tr></table></figure>
<p>可以通过把某一个声道的音量设置到最小，达到只向某个声道输出音频的效果。<br>我自己也有点”呵呵“，但是也没有发现还有别的方法可以实现这样的效果。</p>
<blockquote>
<p>这个方法还有一点小问题，在个别手机上，即使将某个声道的声音设置到了最小，也还是会有一点声音，这个我也还没有搞清楚为什么，个人猜测可能和手机硬件有关系。</p>
</blockquote>
<h1 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h1><p>我这里的缓冲模式使用的<code>MODE_STREAM</code>的形式，以流的形式播放，因为这个逻辑要稍微复杂一点，尤其是暂停以后再继续播放的位置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> kong.qingwei.androidsoundmanagerdemo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Activity;</div><div class="line"><span class="keyword">import</span> android.media.AudioFormat;</div><div class="line"><span class="keyword">import</span> android.media.AudioManager;</div><div class="line"><span class="keyword">import</span> android.media.AudioTrack;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Created by kqw on 2016/8/26.</span></div><div class="line"><span class="comment"> * 播放音乐的线程</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PlayThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 采样率</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mSampleRateInHz = <span class="number">16000</span>;</div><div class="line">    <span class="comment">// 单声道</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mChannelConfig = AudioFormat.CHANNEL_OUT_MONO;</div><div class="line">    <span class="comment">// 双声道（立体声）</span></div><div class="line">    <span class="comment">// private int mChannelConfig = AudioFormat.CHANNEL_OUT_STEREO;</span></div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"PlayThread"</span>;</div><div class="line">    <span class="keyword">private</span> Activity mActivity;</div><div class="line">    <span class="keyword">private</span> AudioTrack mAudioTrack;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] data;</div><div class="line">    <span class="keyword">private</span> String mFileName;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PlayThread</span><span class="params">(Activity activity, String fileName)</span> </span>&#123;</div><div class="line">        mActivity = activity;</div><div class="line">        mFileName = fileName;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> bufferSize = AudioTrack.getMinBufferSize(mSampleRateInHz, mChannelConfig, AudioFormat.ENCODING_PCM_16BIT);</div><div class="line">        mAudioTrack = <span class="keyword">new</span> AudioTrack(</div><div class="line">                AudioManager.STREAM_MUSIC,</div><div class="line">                mSampleRateInHz,</div><div class="line">                mChannelConfig,</div><div class="line">                AudioFormat.ENCODING_PCM_16BIT,</div><div class="line">                bufferSize,</div><div class="line">                AudioTrack.MODE_STREAM);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.run();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != mAudioTrack)</div><div class="line">                mAudioTrack.play();</div><div class="line"></div><div class="line">            ByteArrayOutputStream byteArrayOutputStream = <span class="keyword">new</span> ByteArrayOutputStream();</div><div class="line">            InputStream inputStream = mActivity.getResources().getAssets().open(mFileName);</div><div class="line"></div><div class="line">            <span class="comment">// 缓冲区</span></div><div class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</div><div class="line">            <span class="comment">// 播放进度</span></div><div class="line">            <span class="keyword">int</span> playIndex = <span class="number">0</span>;</div><div class="line">            <span class="comment">// 是否缓冲完成</span></div><div class="line">            <span class="keyword">boolean</span> isLoaded = <span class="keyword">false</span>;</div><div class="line">            <span class="comment">// 缓冲 + 播放</span></div><div class="line">            <span class="keyword">while</span> (<span class="keyword">null</span> != mAudioTrack &amp;&amp; AudioTrack.PLAYSTATE_STOPPED != mAudioTrack.getPlayState()) &#123;</div><div class="line">                <span class="comment">// 字符长度</span></div><div class="line">                <span class="keyword">int</span> len;</div><div class="line">                <span class="keyword">if</span> (-<span class="number">1</span> != (len = inputStream.read(buffer))) &#123;</div><div class="line">                    byteArrayOutputStream.write(buffer, <span class="number">0</span>, len);</div><div class="line">                    data = byteArrayOutputStream.toByteArray();</div><div class="line">                    Log.i(TAG, <span class="string">"run: 已缓冲 : "</span> + data.length);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="comment">// 缓冲完成</span></div><div class="line">                    isLoaded = <span class="keyword">true</span>;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (AudioTrack.PLAYSTATE_PAUSED == mAudioTrack.getPlayState()) &#123;</div><div class="line">                    <span class="comment">// TODO 已经暂停</span></div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (AudioTrack.PLAYSTATE_PLAYING == mAudioTrack.getPlayState()) &#123;</div><div class="line">                    Log.i(TAG, <span class="string">"run: 开始从 "</span> + playIndex + <span class="string">" 播放"</span>);</div><div class="line">                    playIndex += mAudioTrack.write(data, playIndex, data.length - playIndex);</div><div class="line">                    Log.i(TAG, <span class="string">"run: 播放到了 : "</span> + playIndex);</div><div class="line">                    <span class="keyword">if</span> (isLoaded &amp;&amp; playIndex == data.length) &#123;</div><div class="line">                        Log.i(TAG, <span class="string">"run: 播放完了"</span>);</div><div class="line">                        mAudioTrack.stop();</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="keyword">if</span> (playIndex &lt; <span class="number">0</span>) &#123;</div><div class="line">                        Log.i(TAG, <span class="string">"run: 播放出错"</span>);</div><div class="line">                        mAudioTrack.stop();</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            Log.i(TAG, <span class="string">"run: play end"</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 设置左右声道平衡</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> max     最大值</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> balance 当前值</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBalance</span><span class="params">(<span class="keyword">int</span> max, <span class="keyword">int</span> balance)</span> </span>&#123;</div><div class="line">        <span class="keyword">float</span> b = (<span class="keyword">float</span>) balance / (<span class="keyword">float</span>) max;</div><div class="line">        Log.i(TAG, <span class="string">"setBalance: b = "</span> + b);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mAudioTrack)</div><div class="line">            mAudioTrack.setStereoVolume(<span class="number">1</span> - b, b);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 设置左右声道是否可用</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> left  左声道</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> right 右声道</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setChannel</span><span class="params">(<span class="keyword">boolean</span> left, <span class="keyword">boolean</span> right)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mAudioTrack) &#123;</div><div class="line">            mAudioTrack.setStereoVolume(left ? <span class="number">1</span> : <span class="number">0</span>, right ? <span class="number">1</span> : <span class="number">0</span>);</div><div class="line">            mAudioTrack.play();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pause</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mAudioTrack)</div><div class="line">            mAudioTrack.pause();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mAudioTrack)</div><div class="line">            mAudioTrack.play();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopp</span><span class="params">()</span> </span>&#123;</div><div class="line">        releaseAudioTrack();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">releaseAudioTrack</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mAudioTrack) &#123;</div><div class="line">            mAudioTrack.stop();</div><div class="line">            mAudioTrack.release();</div><div class="line">            mAudioTrack = <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="从头开始播放"><a href="#从头开始播放" class="headerlink" title="从头开始播放"></a>从头开始播放</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mPlayThread = <span class="keyword">new</span> PlayThread(<span class="keyword">this</span>, <span class="string">"tts1.pcm"</span>);</div><div class="line">mPlayThread.start();</div></pre></td></tr></table></figure>
<h2 id="暂停"><a href="#暂停" class="headerlink" title="暂停"></a>暂停</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mPlayThread.pause();</div></pre></td></tr></table></figure>
<h2 id="暂停后继续播放"><a href="#暂停后继续播放" class="headerlink" title="暂停后继续播放"></a>暂停后继续播放</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mPlayThread.play();</div></pre></td></tr></table></figure>
<h2 id="停止播放"><a href="#停止播放" class="headerlink" title="停止播放"></a>停止播放</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mPlayThread.stopp();</div><div class="line">mPlayThread = <span class="keyword">null</span>;</div></pre></td></tr></table></figure>
<h2 id="左右声道控制-1"><a href="#左右声道控制-1" class="headerlink" title="左右声道控制"></a>左右声道控制</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 禁用左声道（右声道同理）</span></div><div class="line">mPlayThread.setChannel(<span class="keyword">false</span>, <span class="keyword">true</span>);</div></pre></td></tr></table></figure>
<h1 id="向左右声道单独输出不同的音频数据"><a href="#向左右声道单独输出不同的音频数据" class="headerlink" title="向左右声道单独输出不同的音频数据"></a>向左右声道单独输出不同的音频数据</h1><p>也是一个很”呵呵“的做法，但是依然还没有找到更好的方法。<br>构造两个<code>AudioTrack</code>对象，分别输出两个音频，一个禁用左声道，一个禁用右声道，达到预期效果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mChannelLeftPlayer = <span class="keyword">new</span> PlayThread(<span class="keyword">this</span>, <span class="string">"tts1.pcm"</span>);</div><div class="line">mChannelRightPlayer = <span class="keyword">new</span> PlayThread(<span class="keyword">this</span>, <span class="string">"tts2.pcm"</span>);</div><div class="line"></div><div class="line">mChannelLeftPlayer.setChannel(<span class="keyword">true</span>, <span class="keyword">false</span>);</div><div class="line">mChannelRightPlayer.setChannel(<span class="keyword">false</span>, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">mChannelLeftPlayer.start();</div><div class="line">mChannelRightPlayer.start();</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/22/2016-08-22-环信即时通讯在Android平台的部署/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/22/2016-08-22-环信即时通讯在Android平台的部署/" itemprop="url">环信即时通讯在Android平台的部署</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-22T18:36:12+08:00">
                2016-08-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IM/" itemprop="url" rel="index">
                    <span itemprop="name">IM</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/08/22/2016-08-22-环信即时通讯在Android平台的部署/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/08/22/2016-08-22-环信即时通讯在Android平台的部署/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h1><p><a href="http://www.easemob.com/" target="_blank" rel="external">环信</a></p>
<p><a href="http://www.easemob.com/download" target="_blank" rel="external">下载SDK</a></p>
<h1 id="创建一个工程"><a href="#创建一个工程" class="headerlink" title="创建一个工程"></a>创建一个工程</h1><p>如果想要封装性好一点，也可以在工程里再创建一个环信的Library，然后将SDK里的<code>jar</code>和<code>.so</code>，都导入到工程</p>
<p><img src="http://img.blog.csdn.net/20160822185314139" alt="导入SDK"></p>
<h1 id="清单文件"><a href="#清单文件" class="headerlink" title="清单文件"></a>清单文件</h1><p>下面是环信Library库里面的清单文件，包含了权限的设置、APPKEY的设置和服务的声明等。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">&lt;manifest xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="keyword">package</span>=<span class="string">"……"</span>&gt;</div><div class="line"></div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.VIBRATE"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.INTERNET"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.RECORD_AUDIO"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.CAMERA"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_NETWORK_STATE"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.MOUNT_UNMOUNT_FILESYSTEMS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_FINE_LOCATION"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.GET_TASKS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_WIFI_STATE"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.CHANGE_WIFI_STATE"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.WAKE_LOCK"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.MODIFY_AUDIO_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.READ_PHONE_STATE"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.RECEIVE_BOOT_COMPLETED"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.USE_CREDENTIALS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.android.launcher.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.BROADCAST_STICKY"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS"</span> /&gt;</div><div class="line"></div><div class="line"></div><div class="line">    &lt;application</div><div class="line">        android:allowBackup=<span class="string">"true"</span></div><div class="line">        android:label=<span class="string">"@string/app_name"</span></div><div class="line">        android:supportsRtl=<span class="string">"true"</span>&gt;</div><div class="line"></div><div class="line">        &lt;!-- 设置环信应用的AppKey --&gt;</div><div class="line">        &lt;meta-data</div><div class="line">            android:name=<span class="string">"EASEMOB_APPKEY"</span></div><div class="line">            android:value=<span class="string">"你的APPKEY"</span> /&gt;</div><div class="line">        &lt;!-- 声明SDK所需的service SDK核心功能--&gt;</div><div class="line">        &lt;service</div><div class="line">            android:name=<span class="string">"com.hyphenate.chat.EMChatService"</span></div><div class="line">            android:exported=<span class="string">"true"</span> /&gt;</div><div class="line">        &lt;!-- 声明SDK所需的receiver --&gt;</div><div class="line">        &lt;receiver android:name=<span class="string">"com.hyphenate.chat.EMMonitorReceiver"</span>&gt;</div><div class="line">            &lt;intent-filter&gt;</div><div class="line">                &lt;action android:name=<span class="string">"android.intent.action.PACKAGE_REMOVED"</span> /&gt;</div><div class="line">                &lt;data android:scheme=<span class="string">"package"</span> /&gt;</div><div class="line">            &lt;/intent-filter&gt;</div><div class="line">            &lt;!-- 可选filter --&gt;</div><div class="line">            &lt;intent-filter&gt;</div><div class="line">                &lt;action android:name=<span class="string">"android.intent.action.BOOT_COMPLETED"</span> /&gt;</div><div class="line">                &lt;action android:name=<span class="string">"android.intent.action.USER_PRESENT"</span> /&gt;</div><div class="line">            &lt;/intent-filter&gt;</div><div class="line">        &lt;/receiver&gt;</div><div class="line"></div><div class="line">    &lt;/application&gt;</div><div class="line"></div><div class="line">&lt;/manifest&gt;</div></pre></td></tr></table></figure>
<h1 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h1><p>创建一个<code>InitApplication</code>类，继承<code>Application</code>，用来初始化应用的一些信息。</p>
<p>在主工程的清单文件下声明</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</div><div class="line">&lt;manifest xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="keyword">package</span>=<span class="string">"……"</span>&gt;</div><div class="line"></div><div class="line">    &lt;application</div><div class="line">        android:name=<span class="string">".InitApplication"</span></div><div class="line">        ……&gt;</div><div class="line">        ……</div><div class="line">    &lt;/application&gt;</div><div class="line"></div><div class="line">&lt;/manifest&gt;</div></pre></td></tr></table></figure>
<p>初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> ……;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Application;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.hyphenate.chat.EMClient;</div><div class="line"><span class="keyword">import</span> com.hyphenate.chat.EMOptions;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Created by kqw on 2016/8/22.</span></div><div class="line"><span class="comment"> * 初始化应用</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InitApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line"></div><div class="line">        EMOptions options = <span class="keyword">new</span> EMOptions();</div><div class="line">        <span class="comment">// 默认添加好友时，是不需要验证的，改成需要验证</span></div><div class="line">        options.setAcceptInvitationAlways(<span class="keyword">false</span>);</div><div class="line">        <span class="comment">// 初始化</span></div><div class="line">        EMClient.getInstance().init(<span class="keyword">this</span>, options);</div><div class="line">        <span class="comment">// 在做打包混淆时，关闭debug模式，避免消耗不必要的资源</span></div><div class="line">        EMClient.getInstance().setDebugMode(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"已经初始化"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>部署完成</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/22/2016-08-22-OpenCV检测图像轮廓/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/22/2016-08-22-OpenCV检测图像轮廓/" itemprop="url">OpenCV检测图像轮廓</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-22T11:35:23+08:00">
                2016-08-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenCV/" itemprop="url" rel="index">
                    <span itemprop="name">OpenCV</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/08/22/2016-08-22-OpenCV检测图像轮廓/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/08/22/2016-08-22-OpenCV检测图像轮廓/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<p><strong>轮廓</strong>只不过是图像中连接的曲线，或者图像中连通部分的边界，轮廓通常以图像中的边缘来计算，但是，边缘和轮廓的区别在于轮廓是闭合的，而边缘可以是任意的。边缘的概念局限于点及其邻域像素，轮廓将目标作为整体进行处理。</p>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20160822114857928" alt="效果图"></p>
<p><img src="http://img.blog.csdn.net/20160822114912492" alt="原图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="https://github.com/kongqw/KqwOpenCVFeaturesDemo" target="_blank" rel="external">KqwOpenCVFeaturesDemo</a></p>
<h1 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h1><ol>
<li>将图像置灰</li>
<li>使用Canny边缘检测检测出图像的边缘</li>
<li>调用<code>Imgproc.findContours()</code>方法检测图像轮廓</li>
<li>在新的图像上画出轮廓</li>
</ol>
<h1 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 找出轮廓</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> bitmap 要检测的图片</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findContours</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != mSubscriber)</div><div class="line">        Observable</div><div class="line">                .just(bitmap)</div><div class="line">                <span class="comment">// 检测边缘</span></div><div class="line">                .map(<span class="keyword">new</span> Func1&lt;Bitmap, Mat&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> Mat <span class="title">call</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">                        Mat grayMat = <span class="keyword">new</span> Mat();</div><div class="line">                        Mat cannyEdges = <span class="keyword">new</span> Mat();</div><div class="line"></div><div class="line">                        <span class="comment">// Bitmap转为Mat</span></div><div class="line">                        Mat src = <span class="keyword">new</span> Mat(bitmap.getHeight(), bitmap.getWidth(), CvType.CV_8UC4);</div><div class="line">                        Utils.bitmapToMat(bitmap, src);</div><div class="line"></div><div class="line">                        <span class="comment">// 原图置灰</span></div><div class="line">                        Imgproc.cvtColor(src, grayMat, Imgproc.COLOR_BGR2GRAY);</div><div class="line">                        <span class="comment">// Canny边缘检测器检测图像边缘</span></div><div class="line">                        Imgproc.Canny(grayMat, cannyEdges, <span class="number">10</span>, <span class="number">100</span>);</div><div class="line"></div><div class="line">                        <span class="keyword">return</span> cannyEdges;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                <span class="comment">// 找出轮廓</span></div><div class="line">                .map(<span class="keyword">new</span> Func1&lt;Mat, Bitmap&gt;() &#123;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">call</span><span class="params">(Mat cannyEdges)</span> </span>&#123;</div><div class="line"></div><div class="line">                        Mat hierarchy = <span class="keyword">new</span> Mat();</div><div class="line">                        <span class="comment">// 保存轮廓</span></div><div class="line">                        ArrayList&lt;MatOfPoint&gt; contourList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">                        <span class="comment">// 检测轮廓</span></div><div class="line">                        Imgproc.findContours(cannyEdges, contourList, hierarchy, Imgproc.RETR_LIST, Imgproc.CHAIN_APPROX_SIMPLE);</div><div class="line"></div><div class="line">                        <span class="comment">// 画出轮廓</span></div><div class="line">                        Mat contours = <span class="keyword">new</span> Mat();</div><div class="line">                        contours.create(cannyEdges.rows(), cannyEdges.cols(), CvType.CV_8UC3);</div><div class="line">                        Random r = <span class="keyword">new</span> Random();</div><div class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; contourList.size(); i++) &#123;</div><div class="line">                            Imgproc.drawContours(contours, contourList, i, <span class="keyword">new</span> Scalar(r.nextInt(<span class="number">255</span>), r.nextInt(<span class="number">255</span>), r.nextInt(<span class="number">255</span>), -<span class="number">1</span>));</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="comment">// Mat转Bitmap</span></div><div class="line">                        Bitmap processedImage = Bitmap.createBitmap(contours.cols(), contours.rows(), Bitmap.Config.ARGB_8888);</div><div class="line">                        Utils.matToBitmap(contours, processedImage);</div><div class="line"></div><div class="line">                        <span class="keyword">return</span> processedImage;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .subscribeOn(Schedulers.io())</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(mSubscriber);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 图片特征提取的工具类</span></div><div class="line">mFeaturesUtil = <span class="keyword">new</span> FeaturesUtil(<span class="keyword">new</span> Subscriber&lt;Bitmap&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理完成</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理异常</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">        <span class="comment">// 获取到处理后的图片</span></div><div class="line">        mImageView.setImageBitmap(bitmap);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 找出轮廓</span></div><div class="line">mFeaturesUtil.findContours(mSelectImage);</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/22/2016-08-22-OpenCV使用霍夫变换检测图像中的形状/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/22/2016-08-22-OpenCV使用霍夫变换检测图像中的形状/" itemprop="url">OpenCV使用霍夫变换检测图像中的形状</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-22T10:34:41+08:00">
                2016-08-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenCV/" itemprop="url" rel="index">
                    <span itemprop="name">OpenCV</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/08/22/2016-08-22-OpenCV使用霍夫变换检测图像中的形状/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/08/22/2016-08-22-OpenCV使用霍夫变换检测图像中的形状/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<p><strong>霍夫变换</strong>是一种被广泛使用的利用数学等式的参数形式在图像中检测形状的技术。<br>例如直线、椭圆、圆等形状。</p>
<p>霍夫变换可以检测任何能以参数形式表示的形状，随着形状的复杂（维数的增加，例如球体），计算的消耗也会增加。<br>我们通常只考虑简单的霍夫形状，例如直线和圆。</p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="https://github.com/kongqw/KqwOpenCVFeaturesDemo" target="_blank" rel="external">KqwOpenCVFeaturesDemo</a></p>
<h1 id="霍夫直线"><a href="#霍夫直线" class="headerlink" title="霍夫直线"></a>霍夫直线</h1><h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img src="http://img.blog.csdn.net/20160822110917692" alt="效果图"></p>
<p><img src="http://img.blog.csdn.net/20160822110941942" alt="原图"></p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li>将图像置灰</li>
<li><p>调用<code>Imgproc.HoughLinesP(cannyEdges, lines, 1, Math.PI / 180, 50, 20, 20)</code> 方法获取直线的数据</p>
<ul>
<li>第一个参数：图像输入</li>
<li>第二个参数：图像输出</li>
<li>第三个参数：图像指定像素中<code>r</code>的解析度</li>
<li>第四个参数：图像指定像素中<code>θ</code>的解析度</li>
<li>第五个参数：直线上点数的阈值</li>
<li>第六个参数：直线上点数的最小值</li>
</ul>
</li>
<li><p>在图像上绘制直线</p>
</li>
</ol>
<h2 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 霍夫直线</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> bitmap 要检测的图片</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">houghLines</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != mSubscriber)</div><div class="line">        Observable</div><div class="line">                .just(bitmap)</div><div class="line">                <span class="comment">// 检测边缘</span></div><div class="line">                .map(<span class="keyword">new</span> Func1&lt;Bitmap, Mat&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> Mat <span class="title">call</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">                        Mat grayMat = <span class="keyword">new</span> Mat();</div><div class="line">                        Mat cannyEdges = <span class="keyword">new</span> Mat();</div><div class="line"></div><div class="line">                        <span class="comment">// Bitmap转为Mat</span></div><div class="line">                        Mat src = <span class="keyword">new</span> Mat(bitmap.getHeight(), bitmap.getWidth(), CvType.CV_8UC4);</div><div class="line">                        Utils.bitmapToMat(bitmap, src);</div><div class="line"></div><div class="line">                        <span class="comment">// 原图置灰</span></div><div class="line">                        Imgproc.cvtColor(src, grayMat, Imgproc.COLOR_BGR2GRAY);</div><div class="line">                        <span class="comment">// Canny边缘检测器检测图像边缘</span></div><div class="line">                        Imgproc.Canny(grayMat, cannyEdges, <span class="number">10</span>, <span class="number">100</span>);</div><div class="line"></div><div class="line">                        <span class="keyword">return</span> cannyEdges;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                <span class="comment">// 霍夫直线</span></div><div class="line">                .map(<span class="keyword">new</span> Func1&lt;Mat, Bitmap&gt;() &#123;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">call</span><span class="params">(Mat cannyEdges)</span> </span>&#123;</div><div class="line"></div><div class="line">                        Mat lines = <span class="keyword">new</span> Mat();</div><div class="line"></div><div class="line">                        Imgproc.HoughLinesP(cannyEdges, lines, <span class="number">1</span>, Math.PI / <span class="number">180</span>, <span class="number">50</span>, <span class="number">20</span>, <span class="number">20</span>);</div><div class="line"></div><div class="line">                        Mat houghLines = <span class="keyword">new</span> Mat();</div><div class="line">                        houghLines.create(cannyEdges.rows(), cannyEdges.cols(), CvType.CV_8UC1);</div><div class="line"></div><div class="line">                        <span class="comment">// 在图像上画直线</span></div><div class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lines.cols(); i++) &#123;</div><div class="line">                            <span class="keyword">double</span>[] points = lines.get(<span class="number">0</span>, i);</div><div class="line">                            <span class="keyword">double</span> x1, y1, x2, y2;</div><div class="line">                            x1 = points[<span class="number">0</span>];</div><div class="line">                            y1 = points[<span class="number">1</span>];</div><div class="line">                            x2 = points[<span class="number">2</span>];</div><div class="line">                            y2 = points[<span class="number">3</span>];</div><div class="line"></div><div class="line">                            Point pt1 = <span class="keyword">new</span> Point(x1, y1);</div><div class="line">                            Point pt2 = <span class="keyword">new</span> Point(x2, y2);</div><div class="line"></div><div class="line">                            <span class="comment">// 绘制直线</span></div><div class="line">                            Core.line(houghLines, pt1, pt2, <span class="keyword">new</span> Scalar(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">1</span>);</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="comment">// Mat转Bitmap</span></div><div class="line">                        Bitmap processedImage = Bitmap.createBitmap(houghLines.cols(), houghLines.rows(), Bitmap.Config.ARGB_8888);</div><div class="line">                        Utils.matToBitmap(houghLines, processedImage);</div><div class="line"></div><div class="line">                        <span class="keyword">return</span> processedImage;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .subscribeOn(Schedulers.io())</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(mSubscriber);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 图片特征提取的工具类</span></div><div class="line">mFeaturesUtil = <span class="keyword">new</span> FeaturesUtil(<span class="keyword">new</span> Subscriber&lt;Bitmap&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理完成</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理异常</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">        <span class="comment">// 获取到处理后的图片</span></div><div class="line">        mImageView.setImageBitmap(bitmap);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 霍夫直线</span></div><div class="line">mFeaturesUtil.houghLines(mSelectImage);</div></pre></td></tr></table></figure>
<h1 id="霍夫圆"><a href="#霍夫圆" class="headerlink" title="霍夫圆"></a>霍夫圆</h1><h2 id="效果图-1"><a href="#效果图-1" class="headerlink" title="效果图"></a>效果图</h2><p><img src="http://img.blog.csdn.net/20160822111007317" alt="效果图"></p>
<p><img src="http://img.blog.csdn.net/20160822111022661" alt="原图"></p>
<h2 id="步骤-1"><a href="#步骤-1" class="headerlink" title="步骤"></a>步骤</h2><p>霍夫圆与霍夫直线类似，只是等式改变了，调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Imgproc.HoughCircles(cannyEdges, circles, Imgproc.CV_HOUGH_GRADIENT, <span class="number">1</span>, cannyEdges.rows() / <span class="number">15</span>);</div></pre></td></tr></table></figure>
<p>获取圆的数据</p>
<h2 id="封装-1"><a href="#封装-1" class="headerlink" title="封装"></a>封装</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 霍夫圆</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> bitmap 要检测的图片</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">houghCircles</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != mSubscriber)</div><div class="line">        Observable</div><div class="line">                .just(bitmap)</div><div class="line">                <span class="comment">// 检测边缘</span></div><div class="line">                .map(<span class="keyword">new</span> Func1&lt;Bitmap, Mat&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> Mat <span class="title">call</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">                        Mat grayMat = <span class="keyword">new</span> Mat();</div><div class="line">                        Mat cannyEdges = <span class="keyword">new</span> Mat();</div><div class="line"></div><div class="line">                        <span class="comment">// Bitmap转为Mat</span></div><div class="line">                        Mat src = <span class="keyword">new</span> Mat(bitmap.getHeight(), bitmap.getWidth(), CvType.CV_8UC4);</div><div class="line">                        Utils.bitmapToMat(bitmap, src);</div><div class="line"></div><div class="line">                        <span class="comment">// 原图置灰</span></div><div class="line">                        Imgproc.cvtColor(src, grayMat, Imgproc.COLOR_BGR2GRAY);</div><div class="line">                        <span class="comment">// Canny边缘检测器检测图像边缘</span></div><div class="line">                        Imgproc.Canny(grayMat, cannyEdges, <span class="number">10</span>, <span class="number">100</span>);</div><div class="line"></div><div class="line">                        <span class="keyword">return</span> cannyEdges;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                <span class="comment">// 霍夫圆</span></div><div class="line">                .map(<span class="keyword">new</span> Func1&lt;Mat, Bitmap&gt;() &#123;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">call</span><span class="params">(Mat cannyEdges)</span> </span>&#123;</div><div class="line"></div><div class="line">                        Mat circles = <span class="keyword">new</span> Mat();</div><div class="line">                        Imgproc.HoughCircles(cannyEdges, circles, Imgproc.CV_HOUGH_GRADIENT, <span class="number">1</span>, cannyEdges.rows() / <span class="number">15</span>);</div><div class="line"></div><div class="line">                        Mat houghCircles = <span class="keyword">new</span> Mat();</div><div class="line">                        houghCircles.create(cannyEdges.rows(), cannyEdges.cols(), CvType.CV_8UC1);</div><div class="line"></div><div class="line">                        <span class="comment">// 在图像上画圆</span></div><div class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; circles.cols(); i++) &#123;</div><div class="line">                            <span class="keyword">double</span>[] parameters = circles.get(<span class="number">0</span>, i);</div><div class="line">                            <span class="keyword">double</span> x, y;</div><div class="line">                            <span class="keyword">int</span> r;</div><div class="line"></div><div class="line">                            x = parameters[<span class="number">0</span>];</div><div class="line">                            y = parameters[<span class="number">1</span>];</div><div class="line">                            r = (<span class="keyword">int</span>) parameters[<span class="number">2</span>];</div><div class="line"></div><div class="line">                            <span class="comment">// 绘制圆</span></div><div class="line">                            Point center = <span class="keyword">new</span> Point(x, y);</div><div class="line">                            Core.circle(houghCircles, center, r, <span class="keyword">new</span> Scalar(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">1</span>);</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="comment">// Mat转Bitmap</span></div><div class="line">                        Bitmap processedImage = Bitmap.createBitmap(houghCircles.cols(), houghCircles.rows(), Bitmap.Config.ARGB_8888);</div><div class="line">                        Utils.matToBitmap(houghCircles, processedImage);</div><div class="line"></div><div class="line">                        <span class="keyword">return</span> processedImage;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .subscribeOn(Schedulers.io())</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(mSubscriber);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 图片特征提取的工具类</span></div><div class="line">mFeaturesUtil = <span class="keyword">new</span> FeaturesUtil(<span class="keyword">new</span> Subscriber&lt;Bitmap&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理完成</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理异常</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">        <span class="comment">// 获取到处理后的图片</span></div><div class="line">        mImageView.setImageBitmap(bitmap);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 霍夫圆</span></div><div class="line">mFeaturesUtil.houghCircles(mSelectImage);</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/19/2016-08-19-OpenCV使用Harris算法实现角点检测/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/19/2016-08-19-OpenCV使用Harris算法实现角点检测/" itemprop="url">OpenCV使用Harris算法实现角点检测</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-19T19:32:39+08:00">
                2016-08-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenCV/" itemprop="url" rel="index">
                    <span itemprop="name">OpenCV</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/08/19/2016-08-19-OpenCV使用Harris算法实现角点检测/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/08/19/2016-08-19-OpenCV使用Harris算法实现角点检测/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20160819194926871" alt="效果图"></p>
<p><img src="http://img.blog.csdn.net/20160819194937262" alt="原图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="https://github.com/kongqw/KqwOpenCVFeaturesDemo" target="_blank" rel="external">KqwOpenCVFeaturesDemo</a></p>
<p><strong>角点</strong>是两条边缘的交点或者在局部邻域中有多个显著边缘方向的点。Harris角点检测是一种在角点检测中最常见的技术。</p>
<p>Harris角点检测器在图像上使用滑动窗口计算亮度的变化。</p>
<h1 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h1><p>这里用到了RxJava。主要是因为图片处理是耗时操作，会阻塞线程，为了防止界面卡顿，这里使用RxJava进行了线程切换。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Harris角点检测</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> bitmap 要检测的图片</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">harris</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != mSubscriber)</div><div class="line">        Observable</div><div class="line">                .just(bitmap)</div><div class="line">                <span class="comment">// 检测边缘</span></div><div class="line">                .map(<span class="keyword">new</span> Func1&lt;Bitmap, Mat&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> Mat <span class="title">call</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">                        Mat grayMat = <span class="keyword">new</span> Mat();</div><div class="line">                        Mat cannyEdges = <span class="keyword">new</span> Mat();</div><div class="line"></div><div class="line">                        <span class="comment">// Bitmap转为Mat</span></div><div class="line">                        Mat src = <span class="keyword">new</span> Mat(bitmap.getHeight(), bitmap.getWidth(), CvType.CV_8UC4);</div><div class="line">                        Utils.bitmapToMat(bitmap, src);</div><div class="line"></div><div class="line">                        <span class="comment">// 原图置灰</span></div><div class="line">                        Imgproc.cvtColor(src, grayMat, Imgproc.COLOR_BGR2GRAY);</div><div class="line">                        <span class="comment">// Canny边缘检测器检测图像边缘</span></div><div class="line">                        Imgproc.Canny(grayMat, cannyEdges, <span class="number">10</span>, <span class="number">100</span>);</div><div class="line"></div><div class="line">                        <span class="keyword">return</span> cannyEdges;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                <span class="comment">// Harris对角检测</span></div><div class="line">                .map(<span class="keyword">new</span> Func1&lt;Mat, Bitmap&gt;() &#123;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">call</span><span class="params">(Mat cannyEdges)</span> </span>&#123;</div><div class="line">                        Mat corners = <span class="keyword">new</span> Mat();</div><div class="line">                        Mat tempDst = <span class="keyword">new</span> Mat();</div><div class="line"></div><div class="line">                        <span class="comment">// 找出角点</span></div><div class="line">                        Imgproc.cornerHarris(cannyEdges, tempDst, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0.04</span>);</div><div class="line"></div><div class="line">                        <span class="comment">// 归一化Harris角点的输出</span></div><div class="line">                        Mat tempDstNorm = <span class="keyword">new</span> Mat();</div><div class="line">                        Core.normalize(tempDst, tempDstNorm, <span class="number">0</span>, <span class="number">255</span>, Core.NORM_MINMAX);</div><div class="line">                        Core.convertScaleAbs(tempDstNorm, corners);</div><div class="line"></div><div class="line">                        <span class="comment">// 在新的图像上绘制角点</span></div><div class="line">                        Random r = <span class="keyword">new</span> Random();</div><div class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tempDstNorm.cols(); i++) &#123;</div><div class="line">                            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; tempDstNorm.rows(); j++) &#123;</div><div class="line">                                <span class="keyword">double</span>[] value = tempDstNorm.get(j, i);</div><div class="line">                                <span class="keyword">if</span> (value[<span class="number">0</span>] &gt; <span class="number">150</span>) &#123;</div><div class="line">                                    Core.circle(corners, <span class="keyword">new</span> Point(i, j), <span class="number">5</span>, <span class="keyword">new</span> Scalar(r.nextInt(<span class="number">255</span>), <span class="number">2</span>));</div><div class="line">                                &#125;</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="comment">// Mat转Bitmap</span></div><div class="line">                        Bitmap processedImage = Bitmap.createBitmap(corners.cols(), corners.rows(), Bitmap.Config.ARGB_8888);</div><div class="line">                        Utils.matToBitmap(corners, processedImage);</div><div class="line"></div><div class="line">                        <span class="keyword">return</span> processedImage;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .subscribeOn(Schedulers.io())</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(mSubscriber);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 图片特征提取的工具类</span></div><div class="line">mFeaturesUtil = <span class="keyword">new</span> FeaturesUtil(<span class="keyword">new</span> Subscriber&lt;Bitmap&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理完成</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理异常</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">        <span class="comment">// 获取到处理后的图片</span></div><div class="line">        mImageView.setImageBitmap(bitmap);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Harris角点检测</span></div><div class="line">mFeaturesUtil.harris(mSelectImage);</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/19/2016-08-19-OpenCV使用Sobel滤波器实现图像边缘检测/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/19/2016-08-19-OpenCV使用Sobel滤波器实现图像边缘检测/" itemprop="url">OpenCV使用Sobel滤波器实现图像边缘检测</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-19T17:35:55+08:00">
                2016-08-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenCV/" itemprop="url" rel="index">
                    <span itemprop="name">OpenCV</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/08/19/2016-08-19-OpenCV使用Sobel滤波器实现图像边缘检测/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/08/19/2016-08-19-OpenCV使用Sobel滤波器实现图像边缘检测/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20160819175140742" alt="效果图"></p>
<p><img src="http://img.blog.csdn.net/20160819175154258" alt="原图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="https://github.com/kongqw/KqwOpenCVFeaturesDemo" target="_blank" rel="external">KqwOpenCVFeaturesDemo</a></p>
<p><strong>Sobel滤波器</strong>也叫<strong>Sobel算子</strong>，与Canny边缘检测一样，需要计算像素的灰度梯度，只不过是换用另一种方式。</p>
<h1 id="使用Sobel算子计算边缘的步骤"><a href="#使用Sobel算子计算边缘的步骤" class="headerlink" title="使用Sobel算子计算边缘的步骤"></a>使用Sobel算子计算边缘的步骤</h1><ol>
<li><p>将图像转为灰度图像</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 原图置灰</span></div><div class="line">Imgproc.cvtColor(src, grayMat, Imgproc.COLOR_BGR2GRAY);</div></pre></td></tr></table></figure>
</li>
<li><p>计算水平方向灰度梯度的绝对值</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Imgproc.Sobel(grayMat, grad_x, CvType.CV_16S, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span>);</div><div class="line">Core.convertScaleAbs(grad_x, abs_grad_x);</div></pre></td></tr></table></figure>
</li>
<li><p>计算垂直方法灰度梯度的绝对值</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Imgproc.Sobel(grayMat, grad_y, CvType.CV_16S, <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span>);</div><div class="line">Core.convertScaleAbs(grad_y, abs_grad_y);</div></pre></td></tr></table></figure>
</li>
<li><p>计算最终梯度</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 计算结果梯度</span></div><div class="line">Core.addWeighted(abs_grad_x, <span class="number">0.5</span>, abs_grad_y, <span class="number">0.5</span>, <span class="number">1</span>, sobel);</div></pre></td></tr></table></figure>
</li>
</ol>
<p>最终的梯度实质上就是边缘。</p>
<p>这里用到了两个<code>3 * 3</code>的核对图像做卷积来近似地计算水平和垂直方向的灰度梯度</p>
<p><img src="http://img.blog.csdn.net/20160819183329090" alt="核"></p>
<h1 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h1><p>这里用到了RxJava。主要是因为图片处理是耗时操作，会阻塞线程，为了防止界面卡顿，这里使用RxJava进行了线程切换。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Sobel滤波器</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> bitmap 要检测的图片</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sobel</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != mSubscriber)</div><div class="line">        Observable</div><div class="line">                .just(bitmap)</div><div class="line">                .map(<span class="keyword">new</span> Func1&lt;Bitmap, Bitmap&gt;() &#123;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">call</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line"></div><div class="line">                        Mat grayMat = <span class="keyword">new</span> Mat();</div><div class="line">                        Mat sobel = <span class="keyword">new</span> Mat();</div><div class="line">                        Mat grad_x = <span class="keyword">new</span> Mat();</div><div class="line">                        Mat grad_y = <span class="keyword">new</span> Mat();</div><div class="line">                        Mat abs_grad_x = <span class="keyword">new</span> Mat();</div><div class="line">                        Mat abs_grad_y = <span class="keyword">new</span> Mat();</div><div class="line"></div><div class="line">                        <span class="comment">// Bitmap转为Mat</span></div><div class="line">                        Mat src = <span class="keyword">new</span> Mat(bitmap.getHeight(), bitmap.getWidth(), CvType.CV_8UC4);</div><div class="line">                        Utils.bitmapToMat(bitmap, src);</div><div class="line">                        <span class="comment">// 原图置灰</span></div><div class="line">                        Imgproc.cvtColor(src, grayMat, Imgproc.COLOR_BGR2GRAY);</div><div class="line"></div><div class="line">                        <span class="comment">// 计算水平方向梯度</span></div><div class="line">                        Imgproc.Sobel(grayMat, grad_x, CvType.CV_16S, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span>);</div><div class="line">                        <span class="comment">// 计算垂直方向梯度</span></div><div class="line">                        Imgproc.Sobel(grayMat, grad_y, CvType.CV_16S, <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span>);</div><div class="line">                        <span class="comment">// 计算两个方向上的梯度的绝对值</span></div><div class="line">                        Core.convertScaleAbs(grad_x, abs_grad_x);</div><div class="line">                        Core.convertScaleAbs(grad_y, abs_grad_y);</div><div class="line">                        <span class="comment">// 计算结果梯度</span></div><div class="line">                        Core.addWeighted(abs_grad_x, <span class="number">0.5</span>, abs_grad_y, <span class="number">0.5</span>, <span class="number">1</span>, sobel);</div><div class="line"></div><div class="line">                        <span class="comment">// Mat转Bitmap</span></div><div class="line">                        Bitmap processedImage = Bitmap.createBitmap(sobel.cols(), sobel.rows(), Bitmap.Config.ARGB_8888);</div><div class="line">                        Utils.matToBitmap(sobel, processedImage);</div><div class="line"></div><div class="line">                        <span class="keyword">return</span> processedImage;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .subscribeOn(Schedulers.io())</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(mSubscriber);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 图片特征提取的工具类</span></div><div class="line">mFeaturesUtil = <span class="keyword">new</span> FeaturesUtil(<span class="keyword">new</span> Subscriber&lt;Bitmap&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理完成</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理异常</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">        <span class="comment">// 获取到处理后的图片</span></div><div class="line">        mImageView.setImageBitmap(bitmap);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Sobel滤波器检测图像边缘</span></div><div class="line">mFeaturesUtil.sobel(mSelectImage);</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/19/2016-08-19-OpenCV使用Canny边缘检测器实现图像边缘检测/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/19/2016-08-19-OpenCV使用Canny边缘检测器实现图像边缘检测/" itemprop="url">OpenCV使用Canny边缘检测器实现图像边缘检测</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-19T16:31:02+08:00">
                2016-08-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenCV/" itemprop="url" rel="index">
                    <span itemprop="name">OpenCV</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/08/19/2016-08-19-OpenCV使用Canny边缘检测器实现图像边缘检测/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/08/19/2016-08-19-OpenCV使用Canny边缘检测器实现图像边缘检测/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20160819171248584" alt="边缘检测结果"></p>
<p><img src="http://img.blog.csdn.net/20160819171257725" alt="原图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="https://github.com/kongqw/KqwOpenCVFeaturesDemo" target="_blank" rel="external">KqwOpenCVFeaturesDemo</a></p>
<p><strong>Canny边缘检测器</strong>是一种被广泛使用的算法，并被认为是边缘检测最优的算法，该方法使用了比高斯差分算法更复杂的技巧，如多向灰度梯度和滞后阈值化。</p>
<h1 id="Canny边缘检测器算法基本步骤"><a href="#Canny边缘检测器算法基本步骤" class="headerlink" title="Canny边缘检测器算法基本步骤"></a>Canny边缘检测器算法基本步骤</h1><ol>
<li><strong>平滑图像</strong>：通过使用合适的模糊半径执行高斯模糊来减少图像内的噪声。</li>
<li><strong>计算图像的梯度</strong>：这里计算图像的梯度，并将梯度分类为垂直、水平和斜对角。这一步的输出用于在下一步中计算真正的边缘。</li>
<li><strong>非最大值抑制</strong>：利用上一步计算出来的梯度方向，检测某一像素在梯度的正方向和负方向上是否是局部最大值，如果是，则抑制该像素（像素不属于边缘）。这是一种边缘细化技术，用最急剧的变换选出边缘点。</li>
<li><strong>用滞后阈值化选择边缘</strong>：最后一步，检查某一条边缘是否明显到足以作为最终输出，最后去除所有不明显的边缘。</li>
</ol>
<p>算法比较复杂，但是使用很简单，首先将图像灰度化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 原图置灰</span></div><div class="line">Imgproc.cvtColor(src, grayMat, Imgproc.COLOR_BGR2GRAY);</div></pre></td></tr></table></figure>
<p>然后调用<code>Imgproc.Canny()</code>方法即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Canny边缘检测器检测图像边缘</span></div><div class="line">Imgproc.Canny(grayMat, cannyEdges, <span class="number">10</span>, <span class="number">100</span>);</div></pre></td></tr></table></figure>
<ul>
<li>第一个参数表示图像输入</li>
<li>第二个参数表述图像输出</li>
<li>第三个参数表示<strong>低阈值</strong></li>
<li>第四个参数表示<strong>高阈值</strong></li>
</ul>
<p>在Canny边缘检测算法中，将图像中的点归为三类：</p>
<ul>
<li><p>被抑制点</p>
<p>  灰度梯度值 &lt; 低阈值</p>
</li>
<li><p>弱边缘点</p>
<p>  低阈值 &lt;= 灰度梯度值 &lt;= 高阈值</p>
</li>
<li><p>强边缘点</p>
<p>  高阈值 &lt; 灰度梯度值</p>
</li>
</ul>
<h1 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h1><p>这里用到了RxJava。主要是因为图片处理是耗时操作，会阻塞线程，为了防止界面卡顿，这里使用RxJava进行了线程切换。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Canny边缘检测算法</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> bitmap 要检测的图片</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">canny</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != mSubscriber)</div><div class="line">        Observable</div><div class="line">                .just(bitmap)</div><div class="line">                .map(<span class="keyword">new</span> Func1&lt;Bitmap, Bitmap&gt;() &#123;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">call</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line"></div><div class="line">                        Mat grayMat = <span class="keyword">new</span> Mat();</div><div class="line">                        Mat cannyEdges = <span class="keyword">new</span> Mat();</div><div class="line"></div><div class="line">                        <span class="comment">// Bitmap转为Mat</span></div><div class="line">                        Mat src = <span class="keyword">new</span> Mat(bitmap.getHeight(), bitmap.getWidth(), CvType.CV_8UC4);</div><div class="line">                        Utils.bitmapToMat(bitmap, src);</div><div class="line"></div><div class="line">                        <span class="comment">// 原图置灰</span></div><div class="line">                        Imgproc.cvtColor(src, grayMat, Imgproc.COLOR_BGR2GRAY);</div><div class="line">                        <span class="comment">// Canny边缘检测器检测图像边缘</span></div><div class="line">                        Imgproc.Canny(grayMat, cannyEdges, <span class="number">10</span>, <span class="number">100</span>);</div><div class="line"></div><div class="line">                        <span class="comment">// Mat转Bitmap</span></div><div class="line">                        Bitmap processedImage = Bitmap.createBitmap(cannyEdges.cols(), cannyEdges.rows(), Bitmap.Config.ARGB_8888);</div><div class="line">                        Utils.matToBitmap(cannyEdges, processedImage);</div><div class="line"></div><div class="line">                        <span class="keyword">return</span> processedImage;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .subscribeOn(Schedulers.io())</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(mSubscriber);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 图片特征提取的工具类</span></div><div class="line">mFeaturesUtil = <span class="keyword">new</span> FeaturesUtil(<span class="keyword">new</span> Subscriber&lt;Bitmap&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理完成</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理异常</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">        <span class="comment">// 获取到处理后的图片</span></div><div class="line">        mImageView.setImageBitmap(bitmap);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Canny边缘检测器检测图像边缘</span></div><div class="line">mFeaturesUtil.canny(mSelectImage);</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/19/2016-08-19-OpenCV高斯差分技术实现图像边缘检测/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/19/2016-08-19-OpenCV高斯差分技术实现图像边缘检测/" itemprop="url">OpenCV高斯差分技术实现图像边缘检测</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-19T11:42:04+08:00">
                2016-08-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenCV/" itemprop="url" rel="index">
                    <span itemprop="name">OpenCV</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/08/19/2016-08-19-OpenCV高斯差分技术实现图像边缘检测/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/08/19/2016-08-19-OpenCV高斯差分技术实现图像边缘检测/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20160819120419353" alt="边缘检测结果"></p>
<p><img src="http://img.blog.csdn.net/20160819120428374" alt="原图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="https://github.com/kongqw/KqwOpenCVFeaturesDemo" target="_blank" rel="external">KqwOpenCVFeaturesDemo</a></p>
<p><strong>边缘</strong>是图像中像素亮度变化明显的点。</p>
<h1 id="高斯差分算法步骤"><a href="#高斯差分算法步骤" class="headerlink" title="高斯差分算法步骤"></a>高斯差分算法步骤</h1><ol>
<li><p>将图像转为灰度图像</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 原图置灰</span></div><div class="line">Imgproc.cvtColor(src, grayMat, Imgproc.COLOR_BGR2GRAY);</div></pre></td></tr></table></figure>
</li>
<li><p>用两个不同的模糊半径对灰度图像执行高斯模糊（取得两幅高斯模糊图像）</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 以两个不同的模糊半径对图像做模糊处理</span></div><div class="line">Imgproc.GaussianBlur(grayMat, blur1, <span class="keyword">new</span> Size(<span class="number">15</span>, <span class="number">15</span>), <span class="number">5</span>);</div><div class="line">Imgproc.GaussianBlur(grayMat, blur2, <span class="keyword">new</span> Size(<span class="number">21</span>, <span class="number">21</span>), <span class="number">5</span>);</div></pre></td></tr></table></figure>
</li>
<li><p>将两幅高斯模糊图像做减法，得到一幅包含边缘点的结果图像</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 将两幅模糊后的图像相减</span></div><div class="line">Mat diff = <span class="keyword">new</span> Mat();</div><div class="line">Core.absdiff(blur1, blur2, diff);</div></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>该方法只对图像做了高斯模糊，这是计算图像边缘最快的方法之一，但是，该方法的结果也不是很理想，这种方式对某些图像效果很好，但是在某些情况下可能会完全失效。</strong></p>
<h1 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h1><p>这里用到了RxJava。主要是因为图片处理是耗时操作，会阻塞线程，为了防止界面卡顿，这里使用RxJava进行了线程切换。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 高斯差分算法边缘检测</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> bitmap 要检测的图片</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">differenceOfGaussian</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != mSubscriber)</div><div class="line">        Observable</div><div class="line">                .just(bitmap)</div><div class="line">                .map(<span class="keyword">new</span> Func1&lt;Bitmap, Bitmap&gt;() &#123;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">call</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line"></div><div class="line">                        Mat grayMat = <span class="keyword">new</span> Mat();</div><div class="line">                        Mat blur1 = <span class="keyword">new</span> Mat();</div><div class="line">                        Mat blur2 = <span class="keyword">new</span> Mat();</div><div class="line"></div><div class="line">                        <span class="comment">// Bitmap转为Mat</span></div><div class="line">                        Mat src = <span class="keyword">new</span> Mat(bitmap.getHeight(), bitmap.getWidth(), CvType.CV_8UC4);</div><div class="line">                        Utils.bitmapToMat(bitmap, src);</div><div class="line"></div><div class="line">                        <span class="comment">// 原图置灰</span></div><div class="line">                        Imgproc.cvtColor(src, grayMat, Imgproc.COLOR_BGR2GRAY);</div><div class="line"></div><div class="line">                        <span class="comment">// 以两个不同的模糊半径对图像做模糊处理</span></div><div class="line">                        Imgproc.GaussianBlur(grayMat, blur1, <span class="keyword">new</span> Size(<span class="number">15</span>, <span class="number">15</span>), <span class="number">5</span>);</div><div class="line">                        Imgproc.GaussianBlur(grayMat, blur2, <span class="keyword">new</span> Size(<span class="number">21</span>, <span class="number">21</span>), <span class="number">5</span>);</div><div class="line"></div><div class="line">                        <span class="comment">// 将两幅模糊后的图像相减</span></div><div class="line">                        Mat diff = <span class="keyword">new</span> Mat();</div><div class="line">                        Core.absdiff(blur1, blur2, diff);</div><div class="line"></div><div class="line">                        <span class="comment">// 反转二值阈值化</span></div><div class="line">                        Core.multiply(diff, <span class="keyword">new</span> Scalar(<span class="number">100</span>), diff);</div><div class="line">                        Imgproc.threshold(diff, diff, <span class="number">50</span>, <span class="number">255</span>, Imgproc.THRESH_BINARY_INV);</div><div class="line"></div><div class="line">                        <span class="comment">// Mat转Bitmap</span></div><div class="line">                        Bitmap processedImage = Bitmap.createBitmap(grayMat.cols(), grayMat.rows(), Bitmap.Config.ARGB_8888);</div><div class="line">                        Utils.matToBitmap(diff, processedImage);</div><div class="line"></div><div class="line">                        <span class="keyword">return</span> processedImage;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .subscribeOn(Schedulers.io())</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(mSubscriber);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 图片特征提取的工具类</span></div><div class="line">mFeaturesUtil = <span class="keyword">new</span> FeaturesUtil(<span class="keyword">new</span> Subscriber&lt;Bitmap&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理完成</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理异常</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">        <span class="comment">// 获取到处理后的图片</span></div><div class="line">        mImageView.setImageBitmap(bitmap);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 高斯差分技术检测图像边缘</span></div><div class="line">mFeaturesUtil.differenceOfGaussian(mSelectImage);</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/18/2016-08-18-OpenCV实现图像阈值化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/18/2016-08-18-OpenCV实现图像阈值化/" itemprop="url">OpenCV实现图像阈值化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-18T18:59:50+08:00">
                2016-08-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenCV/" itemprop="url" rel="index">
                    <span itemprop="name">OpenCV</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/08/18/2016-08-18-OpenCV实现图像阈值化/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/08/18/2016-08-18-OpenCV实现图像阈值化/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20160818193140495" alt="效果图"></p>
<p><img src="http://img.blog.csdn.net/20160818193148727" alt="效果图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="https://github.com/kongqw/KqwOpenCVBlurDemo" target="_blank" rel="external">KqwOpenCVBlurDemo</a></p>
<p><strong>阈值化</strong>是一种将我们想要在图像中分析的区域分割出来的方法。<br>我们把每个像素值都与一个预设的阈值做比较，再根据比较的结果调整像素值。</p>
<p>类似这样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Imgproc.threshold(src, src, <span class="number">100</span>, <span class="number">255</span>, Imgproc.THRESH_BINARY);</div></pre></td></tr></table></figure>
<p>其中100是阈值，255是最大值（纯白色的值）。</p>
<h1 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h1><table>
<thead>
<tr>
<th>名称</th>
<th>常量</th>
</tr>
</thead>
<tbody>
<tr>
<td>二值阈值化</td>
<td>Imgproc.THRESH_BINARY</td>
</tr>
<tr>
<td>阈值化到零</td>
<td>Imgproc.THRESH_TOZERO</td>
</tr>
<tr>
<td>截断阈值化</td>
<td>Imgproc.THRESH_TRUNC</td>
</tr>
<tr>
<td>反转二值阈值化</td>
<td>Imgproc.THRESH_BINARY_INV</td>
</tr>
<tr>
<td>反转阈值化到零</td>
<td>Imgproc.THRESH_TOZERO_INV</td>
</tr>
</tbody>
</table>
<h1 id="自适应阈值"><a href="#自适应阈值" class="headerlink" title="自适应阈值"></a>自适应阈值</h1><p>上述的阈值化是全局性的，我们也可以根据邻域像素为任意像素计算阈值。</p>
<p>自适应阈值用到的3个参数</p>
<ol>
<li><p><strong>自适应方法</strong></p>
<ul>
<li>Imgproc.ADAPTIVE_THRESH_MEAN_C：阈值是邻域像素的值</li>
<li>Imgproc.ADAPTIVE_THRESH_GAUSSIAN_C：阈值是领域像素的加权和，权重来自高斯核</li>
</ul>
</li>
<li><p><strong>块尺寸</strong>：邻域的大小    </p>
</li>
<li><strong>常量C</strong>：从对每个像素计算得到的均值或加权均值减去的常量</li>
</ol>
<p>图像置灰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Imgproc.cvtColor(src, src, Imgproc.COLOR_BGR2GRAY);</div></pre></td></tr></table></figure>
<p>自适应阈值化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Imgproc.adaptiveThreshold(src, src, <span class="number">255</span>, Imgproc.ADAPTIVE_THRESH_MEAN_C, Imgproc.THRESH_BINARY, <span class="number">3</span>, <span class="number">0</span>);</div></pre></td></tr></table></figure>
<h1 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h1><p>这里我用到了RxJava。主要是因为图片处理是耗时操作，会阻塞线程，为了防止界面卡顿，这里使用RxJava进行了线程切换。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 自适应阈值</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> bitmap 要处理的图片</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">adaptiveThreshold</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">    <span class="comment">// 使用RxJava处理图片</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != mSubscriber)</div><div class="line">        Observable</div><div class="line">                .just(bitmap)</div><div class="line">                .map(<span class="keyword">new</span> Func1&lt;Bitmap, Bitmap&gt;() &#123;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">call</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">                        <span class="comment">// Bitmap转为Mat</span></div><div class="line">                        Mat src = <span class="keyword">new</span> Mat(bitmap.getHeight(), bitmap.getWidth(), CvType.CV_8UC4);</div><div class="line">                        Utils.bitmapToMat(bitmap, src);</div><div class="line"></div><div class="line">                        <span class="comment">// 图像置灰</span></div><div class="line">                        Imgproc.cvtColor(src, src, Imgproc.COLOR_BGR2GRAY);</div><div class="line">                        <span class="comment">// 自适应阈值化</span></div><div class="line">                        Imgproc.adaptiveThreshold(src, src, <span class="number">255</span>, Imgproc.ADAPTIVE_THRESH_MEAN_C, Imgproc.THRESH_BINARY, <span class="number">3</span>, <span class="number">0</span>);</div><div class="line"></div><div class="line">                        <span class="comment">// 二值阈值化</span></div><div class="line">                        <span class="comment">// Imgproc.threshold(src,src,100,255,Imgproc.THRESH_BINARY);</span></div><div class="line">                        <span class="comment">// 阈值化到零</span></div><div class="line">                        <span class="comment">// Imgproc.threshold(src,src,100,255,Imgproc.THRESH_TOZERO);</span></div><div class="line">                        <span class="comment">// 截断阈值化</span></div><div class="line">                        <span class="comment">// Imgproc.threshold(src,src,100,255,Imgproc.THRESH_TRUNC);</span></div><div class="line">                        <span class="comment">// 反转二值阈值化</span></div><div class="line">                        <span class="comment">// Imgproc.threshold(src,src,100,255,Imgproc.THRESH_BINARY_INV);</span></div><div class="line">                        <span class="comment">// 反转阈值化到零</span></div><div class="line">                        <span class="comment">// Imgproc.threshold(src,src,100,255,Imgproc.THRESH_TOZERO_INV);</span></div><div class="line"></div><div class="line">                        <span class="comment">// Mat转Bitmap</span></div><div class="line">                        Bitmap processedImage = Bitmap.createBitmap(src.cols(), src.rows(), Bitmap.Config.ARGB_8888);</div><div class="line">                        Utils.matToBitmap(src, processedImage);</div><div class="line"></div><div class="line">                        <span class="keyword">return</span> processedImage;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .subscribeOn(Schedulers.io())</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(mSubscriber);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 图片处理的工具类</span></div><div class="line">mBlurUtil = <span class="keyword">new</span> BlurUtil(<span class="keyword">new</span> Subscriber&lt;Bitmap&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理完成</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理异常</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">        <span class="comment">// 获取到处理后的图片</span></div><div class="line">        mIvImageProcessed.setImageBitmap(bitmap);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 自适应阈值</span></div><div class="line">mBlurUtil.adaptiveThreshold(mSelectImage);</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/18/2016-08-18-OpenCV实现图像暗区扩张（腐蚀图片）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kongqw">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孔庆威的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/18/2016-08-18-OpenCV实现图像暗区扩张（腐蚀图片）/" itemprop="url">OpenCV实现图像暗区扩张（腐蚀图片）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-18T18:19:08+08:00">
                2016-08-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenCV/" itemprop="url" rel="index">
                    <span itemprop="name">OpenCV</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/08/18/2016-08-18-OpenCV实现图像暗区扩张（腐蚀图片）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/08/18/2016-08-18-OpenCV实现图像暗区扩张（腐蚀图片）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>转载请说明出处！<br>作者：<a href="http://kongqw.github.io/about/index.html" target="_blank" rel="external">kqw攻城狮</a><br>出处：<a href="http://kongqw.github.io" target="_blank" rel="external">个人站</a> | <a href="http://blog.csdn.net/q4878802/" target="_blank" rel="external">CSDN</a></p>
<hr>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://img.blog.csdn.net/20160818183028684" alt="效果图"></p>
<p><img src="http://img.blog.csdn.net/20160818183043668" alt="效果图"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p><a href="https://github.com/kongqw/KqwOpenCVBlurDemo" target="_blank" rel="external">KqwOpenCVBlurDemo</a></p>
<p>暗区扩张，也叫<strong>腐蚀</strong>，要实现这样的效果，我们可以选取一个合适大小的<strong>核</strong>，用被核覆盖的最小值代替锚点像素。</p>
<p><img src="http://img.blog.csdn.net/20160818183059450" alt="原始图像（左）和腐蚀后的图像（右）"></p>
<p>我们首先定义一个合适大小的核</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Mat kernelErode = Imgproc.getStructuringElement(Imgproc.MORPH_ELLIPSE, <span class="keyword">new</span> Size(<span class="number">5</span>, <span class="number">5</span>));</div></pre></td></tr></table></figure>
<p>然后调用<code>Imgproc.erode()</code>方法把图像的暗区放大</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 扩大暗区（腐蚀）</span></div><div class="line">Imgproc.erode(src, src, kernelErode);</div></pre></td></tr></table></figure>
<h1 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h1><p>这里我用到了RxJava。主要是因为图片处理是耗时操作，会阻塞线程，为了防止界面卡顿，这里使用RxJava进行了线程切换。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 扩大图片暗区（腐蚀图片）</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> bitmap 要处理的图片</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">erode</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">    <span class="comment">// 使用RxJava处理图片</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != mSubscriber)</div><div class="line">        Observable</div><div class="line">                .just(bitmap)</div><div class="line">                .map(<span class="keyword">new</span> Func1&lt;Bitmap, Bitmap&gt;() &#123;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">call</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">                        <span class="comment">// Bitmap转为Mat</span></div><div class="line">                        Mat src = <span class="keyword">new</span> Mat(bitmap.getHeight(), bitmap.getWidth(), CvType.CV_8UC4);</div><div class="line">                        Utils.bitmapToMat(bitmap, src);</div><div class="line"></div><div class="line">                        <span class="comment">// 定义一个合适大小的核</span></div><div class="line">                        Mat kernelErode = Imgproc.getStructuringElement(Imgproc.MORPH_ELLIPSE, <span class="keyword">new</span> Size(<span class="number">5</span>, <span class="number">5</span>));</div><div class="line">                        <span class="comment">// 扩大暗区（腐蚀）</span></div><div class="line">                        Imgproc.erode(src, src, kernelErode);</div><div class="line"></div><div class="line">                        <span class="comment">// Mat转Bitmap</span></div><div class="line">                        Bitmap processedImage = Bitmap.createBitmap(src.cols(), src.rows(), Bitmap.Config.ARGB_8888);</div><div class="line">                        Utils.matToBitmap(src, processedImage);</div><div class="line"></div><div class="line">                        <span class="keyword">return</span> processedImage;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .subscribeOn(Schedulers.io())</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(mSubscriber);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 图片处理的工具类</span></div><div class="line">mBlurUtil = <span class="keyword">new</span> BlurUtil(<span class="keyword">new</span> Subscriber&lt;Bitmap&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理完成</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">        <span class="comment">// 图片处理异常</span></div><div class="line">        dismissProgressDialog();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">        <span class="comment">// 获取到处理后的图片</span></div><div class="line">        mIvImageProcessed.setImageBitmap(bitmap);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 扩大图片暗区</span></div><div class="line">mBlurUtil.erode(mSelectImage);</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="kongqw" />
          <p class="site-author-name" itemprop="name">kongqw</p>
           
              <p class="site-description motion-element" itemprop="description">Android Developer</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">54</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/kongqw" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.csdn.net/q4878802" target="_blank" title="CSDN">
                  
                    <i class="fa fa-fw fa-home"></i>
                  
                  CSDN
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://gank.io" title="干货集中营" target="_blank">干货集中营</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.xfyun.cn" title="讯飞开放平台" target="_blank">讯飞开放平台</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.easemob.com" title="环信" target="_blank">环信</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://tongji.baidu.com" title="百度统计" target="_blank">百度统计</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://kongqw.disqus.com/admin/" title="DISQUS评论" target="_blank">DISQUS评论</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://wallet.btc.com/" title="BTC Wallet" target="_blank">BTC Wallet</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.okcoin.cn/" title="OKCoin中国站" target="_blank">OKCoin中国站</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.okcoin.com/" title="OKCoin国际站" target="_blank">OKCoin国际站</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://btc.com/" title="BTC.com" target="_blank">BTC.com</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kongqw</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://kongqw.disqus.com/count.js" async></script>
    

    

  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
