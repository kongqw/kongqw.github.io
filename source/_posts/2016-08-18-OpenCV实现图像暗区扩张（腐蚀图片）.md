---
title: OpenCV实现图像暗区扩张（腐蚀图片）
date: 2016-08-18 18:19:08
categories: OpenCV
tags: [OpenCV]
---

---
转载请说明出处！
作者：[kqw攻城狮](http://kongqw.github.io/about/index.html)
出处：[个人站](http://kongqw.github.io) | [CSDN](http://blog.csdn.net/q4878802/)

---

# 效果图

![效果图](http://img.blog.csdn.net/20160818183028684)

![效果图](http://img.blog.csdn.net/20160818183043668)

# 源码

[KqwOpenCVBlurDemo](https://github.com/kongqw/KqwOpenCVBlurDemo)

暗区扩张，也叫**腐蚀**，要实现这样的效果，我们可以选取一个合适大小的**核**，用被核覆盖的最小值代替锚点像素。

![原始图像（左）和腐蚀后的图像（右）](http://img.blog.csdn.net/20160818183059450)

我们首先定义一个合适大小的核

``` java
Mat kernelErode = Imgproc.getStructuringElement(Imgproc.MORPH_ELLIPSE, new Size(5, 5));
```

然后调用`Imgproc.erode()`方法把图像的暗区放大

``` java
// 扩大暗区（腐蚀）
Imgproc.erode(src, src, kernelErode);
```

# 封装

这里我用到了RxJava。主要是因为图片处理是耗时操作，会阻塞线程，为了防止界面卡顿，这里使用RxJava进行了线程切换。

``` java
/**
 * 扩大图片暗区（腐蚀图片）
 *
 * @param bitmap 要处理的图片
 */
public void erode(Bitmap bitmap) {
    // 使用RxJava处理图片
    if (null != mSubscriber)
        Observable
                .just(bitmap)
                .map(new Func1<Bitmap, Bitmap>() {

                    @Override
                    public Bitmap call(Bitmap bitmap) {
                        // Bitmap转为Mat
                        Mat src = new Mat(bitmap.getHeight(), bitmap.getWidth(), CvType.CV_8UC4);
                        Utils.bitmapToMat(bitmap, src);

                        // 定义一个合适大小的核
                        Mat kernelErode = Imgproc.getStructuringElement(Imgproc.MORPH_ELLIPSE, new Size(5, 5));
                        // 扩大暗区（腐蚀）
                        Imgproc.erode(src, src, kernelErode);

                        // Mat转Bitmap
                        Bitmap processedImage = Bitmap.createBitmap(src.cols(), src.rows(), Bitmap.Config.ARGB_8888);
                        Utils.matToBitmap(src, processedImage);

                        return processedImage;
                    }
                })
                .subscribeOn(Schedulers.io())
                .observeOn(AndroidSchedulers.mainThread())
                .subscribe(mSubscriber);
}
```

# 调用

``` java
// 图片处理的工具类
mBlurUtil = new BlurUtil(new Subscriber<Bitmap>() {
    @Override
    public void onCompleted() {
        // 图片处理完成
        dismissProgressDialog();
    }

    @Override
    public void onError(Throwable e) {
        // 图片处理异常
        dismissProgressDialog();
    }

    @Override
    public void onNext(Bitmap bitmap) {
        // 获取到处理后的图片
        mIvImageProcessed.setImageBitmap(bitmap);
    }
});

// 扩大图片暗区
mBlurUtil.erode(mSelectImage);
```
