---
title: App启动优化最佳实践
date: 2016-11-14 17:43:17
categories:
tags:
---

---
转载请说明出处！
作者：[kqw攻城狮](http://kongqw.github.io/about/index.html)
出处：[个人站](http://kongqw.com/2016/11/14/2016-11-14-App%E5%90%AF%E5%8A%A8%E4%BC%98%E5%8C%96%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/) | [CSDN](http://blog.csdn.net/q4878802/article/details/53162188)

---

> 看了医生写的文章[一触即发——App启动优化最佳实践](http://mp.weixin.qq.com/s?__biz=MzAxNzMxNzk5OQ==&mid=2649484847&idx=1&sn=39ebb7b2444bee53224246d8f26dce36&chksm=83f8272fb48fae392300dbe011f624a0981286b66c9a7b9508e49b95eee80b2ea86568366564&scene=4#wechat_redirect)，收获是有的。


做Android开发，一定写给过启动页，在这里做一些初始化的操作，还有就是显示推广信息。

很普通的一个页面，以前测试也给我提出过bug，应用在启动的时候，有时候有白屏/黑屏。当时能做的就是尽量较少耗时操作，上面医生的文章里也有提到，但是通过主题的方式优化这个问题之前还真是不知道的。

下面主要总结一下通过主题的方式优化启动页（医生还提到了在子线程初始化和使用IntentService初始化，都是属于异步初始化，还有延迟初始化，就不说了）

# 效果图

![优化前](http://img.blog.csdn.net/20161114183258615)

![优化后](http://img.blog.csdn.net/20161114183329516)

# 通过修改主题优化启动时白屏/黑屏

> 原理请移步到医生的文章，我就不复述了，之所以会看到白屏或者黑屏，是和我们的主题有关系的，因为系统默认使用的主题，背景色就是白色/黑色。那么我们自定义一个主题，让默认的样式就是我们想要的，就优化了白屏/黑屏的问题。

首先，我们自定义一个主题,设置一个我们想要的背景

``` xml
<!-- 启动页主题 -->
<style name="SplashTheme" parent="@style/Theme.AppCompat.Light.NoActionBar">
	<item name="android:windowBackground">@drawable/start_window</item>
</style>
```

自定义背景`start_window.xml`

``` xml
<layer-list xmlns:android="http://schemas.android.com/apk/res/android"
    android:opacity="opaque">
    <!-- The background color, preferably the same as your normal theme -->
    <item android:drawable="@android:color/holo_blue_dark" />
    <!-- Your product logo - 144dp color version of your app icon -->
    <item>
        <bitmap
            android:gravity="center"
            android:src="@mipmap/ic_launcher" />
    </item>
</layer-list>
```

最后，在清单文件设置启动页使用我们自定义的主题

``` xml
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.bitmain.launchtimedemo">

    <application
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:supportsRtl="true"
        android:theme="@style/AppTheme">
        <!-- 启动页 -->
        <activity
            android:name=".SplashActivity"
            android:theme="@style/SplashTheme">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />

                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
        <!-- 主页 -->
        <activity android:name=".MainActivity" />
    </application>

</manifest>
```

到此大功告成，为了体现出效果，在启动页加载之前，我们模拟一个白屏/黑屏的延时操作

``` java
public class SplashActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        // 模拟系统初始化  白屏、黑屏
        SystemClock.sleep(1000);
        setContentView(R.layout.activity_splash);
		// 启动后 停留2秒进入到主页面
        new Handler().postDelayed(new Runnable() {
            @Override
            public void run() {
                Intent intent = new Intent(SplashActivity.this, MainActivity.class);
                startActivity(intent);
                finish();
            }
        }, 2000);
    }
}
```





